#Include "PROTHEUS.CH"
#INCLUDE "GPER040.CH"
Static lPrimeira	:= .T.

/*
Funcao      : PGpeR040
Parametros  : Nenhum
Retorno     : cBar
Objetivos   : Folha de Pagamento 
Autor    	: Customizado pela RASS CONSULTORIA para uso exclusid da PRYOR CONSULTING 
Data     	: 17/05/2010.
TDN         : 
Revisão     : Tiago Luiz Mendonça 
Data/Hora   : 08/02/2012
Módulo      : Gestão de Pessoal.
*/ 

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³ GPER040  ³ Autor ³ R.H. - Ze Maria       ³ Data ³ 03.03.95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Folha de Pagamento                                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ GpeR040(void)                                              ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ Generico                                                   ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³         ATUALIZACOES SOFRIDAS DESDE A CONSTRU€AO INICIAL.             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Programador ³ Data   ³ BOPS ³  Motivo da Alteracao                     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Mauro       ³11/12/01³011677³ Func. c/Retorno Afast. e Demissao no mes ³±±
±±³            ³        ³      ³ contava como afastado no mes.            ³±±
±±³Andreia     ³26/04/01³------³ Inclusao da funcao fCalcCompl para calcu-³±±
±±³            ³        ³      ³ lar os Valores cadastrados no parametro  ³±±
±±³            ³        ³      ³ 15.                                      ³±± 
±±³Andreia     ³12/08/02³014341³ Tratamento da quebra de pagina por funci-³±±
±±³            ³        ³      ³ onario atraves do parametro MV_QUEBFUN.  ³±±
±±³Andreia     ³12/08/02³014955³ Aumento da mascara de impressao do campo ³±±
±±³            ³        ³      ³ horas na impressao dos totais.           ³±±
±±³Emerson     ³15/08/02³Meta  ³ Se RC_QTDSEM maior que 0, sera impresso  ³±±
±±³            ³        ³      ³ como referencia, caso contrario RC_HORAS.³±±
±±³Andreia     ³17/10/02³------³ Tratamento do tipo de afastamento "1","W"³±±
±±³            ³        ³      ³ "8","2","3" e "4" na totalizacao da quan-³±±
±±³            ³        ³      ³ tidade de funcionarios.                  ³±±
±±³Emerson     ³27/12/02³------³ Passar a deduzir percentuais de terceiros³±±
±±³            ³        ³      ³ a partir das definicoes no parametro 15. ³±±
±±³Silvia      ³20/02/03³Locali³ Localizacao do relatorio para utilizacao ³±±
±±³            ³        ³zacao ³ no Uruguai e Argentina                   ³±±
±±³Marinaldo   ³15/04/03³062671³Alterada fCalcInss() para, na   composicao³±±
±±³            ³        ³------³da Base do Pis, Somar os Proventos e Bases³±±
±±³            ³        ³------³que Incidem PIS e subtrair os    Descontos³±±
±±³            ³        ³------³que Incicem PIS                           ³±±
±±³Natie       ³28/04/03³062585³Acerto Pict do vlr Referencia de Proventos³±±
±±³Emerson     ³09/05/03³------³Calc. Acid.Trabalho p/ Pro-Labore/Autonomo³±±
±±³Emerson     ³19/05/03³------³Ajuste em fCalcInss p/nao calcular o % do ³±±
±±³            ³        ³------³autonomo se o % da verba e da empresa == 0³±±
±±³Mauro       ³01/10/03³------³Troca da funcao de busca de salario meses ³±±
±±³            ³        ³------³anteriores e impressao do rodape no final.³±±
±±³Silvia      ³17/10/03³Locali³Localizacao Cuota Mutual -Uruguai         ³±±
±±³Natie       ³16/03/04³F01027³Acerto p/trazer Funcao do mes de Referec. ³±±
±±³Emerson     ³08/04/04³070857³Se semana = "99" imprimir mes por extenso ³±±
±±³            ³        ³------³no relatorio(imprimia apenas folha Pagto).³±±
±±³Pedro       ³18/06/04³068275³Tratar montagem dos niveis em MontaMasc().³±±
±±³Emerson     ³28/10/04³075658³Checar parametro MV_IREFSEM para imprimir ³±±
±±³            ³        ³------³referencias em Semanas ou Horas.		  ³±±
±±³Emerson     ³02/12/04³------³Selecionar area SRZ p/ checar cpo RZ_MAT. ³±±
±±³Ricardo D.  ³03/02/05³071931³Incluir tratamento para o tipo de contrato³±±
±±³            ³        ³------³na chamada da funcao fGpsVal().           ³±±
±±³Emerson     ³11/03/05³079619³Se folha 13o buscar mes 13 no paramtro 15.³±±
±±³Ricardo D.  ³18/05/05³------³Ajuste na estrutura do array gravado em   ³±±
±±³            ³        ³------³fSoma() p/utilizacao no ponto de entrada  ³±±
±±³            ³        ³------³GP040SRZ() p/alteracao de valores dos fun-³±±
±±³            ³        ³------³cionarios antes da contabilizacao.        ³±±
±±³Natie       ³05/07/05³081755³Ajuste na quebra (mv_quebfun="S")         ³±±
±±³Natie       ³11/07/05³078594³Considera vlr dif.dissidio na fImpGerFol  ³±±
±±³Natie       ³26/12/05³090622³ajuste na gravacao dos totais p/empresa   ³±±
±±³Silvia      ³05/05/06³095901³Ajuste no calculo BSE - Uruguai           ³±±
±±³Ricardo D.  ³17/10/06³093770³Retirada a totalizacao das transferencias ³±±
±±³            ³        ³------³do resumo de centro de custos e filiais.  ³±±
±±³Renata      ³10/07/07³128481³Inclusao Ponto de Entrada "GP040Det" em   ³±±
±±³            ³        ³------³fImprime.                                 ³±±
±±³ Alexandre  ³21/11/07³104793³ Implemntado Querys para trazer a quanti- ³±±
±±³ Conselvan  ³        ³      ³ dade de registros que serão processados  ³±±
±±³            ³        ³      ³ assim a regua progriderá corretamente    ³±±
±±³            ³        ³      ³ ate o final							  ³±±
±±³Jonatas     ³11/04/08³142420³Alterado tamanho maximo dos campos total. ³±±
±±³            ³        ³------³de funcionarios.                          ³±±
±±³Raphael Z.  ³09/05/08³136327³Ajustada funcao fCalcInss para Sescoop.   ³±±
±±³Bruno       ³05/06/08³145634³Ajustada as pictures da rotina para que   ³±±
±±³   		   ³		³	   ³aprensente inteiramente as totalizacoes   ³±±
±±³   		   ³		³	   ³no relatorio.                             ³±±
±±³Marcelo     ³15/07/08³148784³As pictures ajustadas no BOPS 145634 sao  ³±±
±±³   		   ³		³	   ³validas apenas p/ os paises que trabalham ³±±
±±³   		   ³		³	   ³com valores altos.                        ³±±
±±³Jonatas     |31/07/08|105440|Incluido tratamento dos campos _ITEM e    ³±±
±±|            |        |      |_CLVL.                                    ³±±
±±³Marcelo     ³05/08/08³150674³Ajuste p/tratar o parametro MV_MASCCUS com³±±
±±³   		   ³		³	   ³mais de 9 caracteres. E redefinicao das   ³±±
±±³   		   ³		³	   ³pictures dos totalizadores.               ³±±
±±³Andreia     ³08/08/08³150868³Tratamento da contabilizacao da primeira  ³±±
±±³   		   ³		³	   ³parcela do decimo terceiro para Argentina ³±±
±±³Marcelo     ³15/09/08³147109³Criacao da Static Function Desccc e       ³±±
±±³   		   ³		³	   ³ajustes na funcao fImprime para imprimir a³±±
±±³   		   ³		³	   ³descricaoo de CC com ate 40 caracteres.   ³±±
±±³   		   ³		³	   ³Ajuste no Ponto de Entrada "GP040Det" para³±±
±±³            ³        ³      ³tratar retorno do tipo array.             ³±±
±±³Marcelo     ³01/10/08³147109³Ajuste na funcao fImpGerFol para imprimir ³±±
±±³   		   ³		³	   ³os dados do C.Custo corretamente a cada   ³±±
±±³   		   ³		³	   ³funcionario processado.                   ³±±
±±³Marcelo     ³30/10/08³004916³Retirada a alteracao de 01/10 -BOPS 147109³±±
±±³Leandro Dr  ³05/11/08³005542³Ajuste para impressao do percentual de    ³±±
±±³   		   ³		³	   ³deducao do parametro 15 de forma correta  ³±±
±±³   		   ³		³	   ³nas ordens 1,4,5 e 6.                     ³±±
±±³Luciana     ³13/11/08³144823³Melhoria de performance. Desenvolvimento  ³±±
±±³            ³        ³------³de procedure para gravacao dos registros  ³±±
±±³            ³        ³------³no SRZ                                    ³±±
±±³Luciana     ³15/01/09³927/09³Ajuste na Ordem do Relatório de Resumo da ³±±
±±³            ³        ³------³Folha por Matrícula                       ³±±
±±³Luciana     ³16/01/09³865/09³Tratamento para considerar os campos      ³±±
±±³            ³        ³------³RC_VALORBA, RC_PLNUCO, RC_CODB1T na query ³±±
±±³            ³        ³------³apenas quando os mesmos existirem.        ³±±
±±³            ³16/01/09³648/09³Ajuste na rotina de contabilização da     ³±±
±±³            ³        ³------³folha para gravar os campos de Item e     ³±±
±±³            ³        ³------³Classe em branco para as verbas           ³±± 
±±³            ³        ³------³cadastradas no parâmetro 15               ³±± 
±±³Luciana     ³26/01/09³1606  ³Ajuste na geração relatório de Resumo da  ³±±
±±³            ³        ³/2009 ³Folha com a opção de Níveis de Centro de  ³±± 
±±³            ³        ³------³Custo como "Sim"                          ³±± 
±±ÀÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
USER Function PGpeR040()
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Define Variaveis Locais (Basicas)                            ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Local cDesc1 	:= STR0001		//"Folha de Pagamento"
Local cDesc2 	:= STR0002		//"Ser  impresso de acordo com os parametros solicitados pelo usuario."
Local cDesc3 	:= STR0003		//"Obs. Dever  ser impressa uma Folha/Resumo para cada Tipo de Contrato."
Local cString	:= "SRA"        				// alias do arquivo principal (Base)
Local aOrd      := {STR0004,STR0005,STR0006,STR0007,STR0008}		//"C.Custo do Cadastro"###"Matricula"###"Nome"###"C.Custo do Movto."###"C.Custo + Nome"###"C.Custo + Item + Classe"
Local cMesAnoRef

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Define Variaveis Private(Basicas)                            ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Private aReturn := { STR0009, 1,STR0010, 2, 2, 1,"",1 }	//"Zebrado"###"Administra‡„o"
Private nomeprog:= "GPER040"
Private aLinha  := {},nLastKey := 0
Private cPerg   := "GPR040"

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Variaveis Utilizadas na funcao IMPR                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Private Titulo	:= STR0011		//"IMPRESSŽO DA FOLHA DE PAGAMENTO"
Private AT_PRG  := "GPER040"
Private wCabec0 := 1
Private wCabec1 := ""
Private CONTFL  := 1
Private LI      := 0
Private nTamanho:= "M"
Private cCabec
Private nOrdem
Private aInfo   := {}
Private aOldInfo:= {}
Private cTipCC, cRefOco

Private lTemItemRA   := SRA->( FieldPos( "RA_ITEM" ) # 0 )
Private lTemClVlRA	 := SRA->( FieldPos( "RA_CLVL" ) # 0 )
Private lTemItemRI   := SRI->( FieldPos( "RI_ITEM" ) # 0 )
Private lTemClVlRI	 := SRI->( FieldPos( "RI_CLVL" ) # 0 )
Private lTemItemRC   := SRC->( FieldPos( "RC_ITEM" ) # 0 )
Private lTemClVlRC	 := SRC->( FieldPos( "RC_CLVL" ) # 0 )

if SRV->(FieldPos("RV_XDESCIN")) = 0
	msgInfo("Special field for English Version has been not created.","Warning")
	return
end

AjustaSX1()

If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	aAdd( aOrd, "C.Center + Item + Class" ) // "C.Custo + Item + Classe"
	//aAdd( aOrd, STR0072 ) // "C.Custo + Item + Classe"
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica as perguntas selecionadas                           ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
pergunte("GPR040",.F.)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Envia controle para a funcao SETPRINT                        ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
wnrel:="GPER040"            //Nome Default do relatorio em Disco
wnrel:=SetPrint(cString,wnrel,cPerg,@Titulo,cDesc1,cDesc2,cDesc3,.F.,aOrd,,nTamanho)

If nLastKey = 27
	Return
Endif

SetDefault(aReturn,cString)

If nLastKey = 27
	Return
Endif

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Variaveis utilizadas para parametros                         ³
//³ mv_par01        //  Data de Referencia para a impressao      ³
//³ mv_par02        //  Adto / Folha / 1¦ Parc. / 2¦ Parc.       ³
//³ mv_par03        //  Numero da Semana                         ³
//³ mv_par04        //  Filial  De                               ³
//³ mv_par05        //  Filial  Ate                              ³
//³ mv_par06        //  Centro de Custo De                       ³
//³ mv_par07        //  Centro de Custo Ate                      ³
//³ mv_par08        //  Matricula De                             ³
//³ mv_par09        //  Matricula Ate                            ³
//³ mv_par10        //  Nome De                                  ³
//³ mv_par11        //  Nome Ate                                 ³
//³ mv_par12        //  Situacao                                 ³
//³ mv_par13        //  Categoria                                ³
//³ mv_par14        //  Imprime C.C em outra Pagina              ³
//³ mv_par15        //  Folha Sintetica ou Analitica             ³
//³ mv_par16        //  Imprime Total Filial                     ³
//³ mv_par17        //  Imprime Total Empresa                    ³
//³ mv_par18        //  Imprime Niveis C.Custo                   ³
//³ mv_par19        //  Imprime Unico Nivel                      ³
//³ mv_par20        //  Imprime Apenas Totais Filial/Empresa     ³
//³ mv_par21        //  Imprime Codigo ou Descricao C.Custo      ³
//³ mv_par22        //  Imprime Referencia ou Ocorrencias        ³
//³ mv_par23        //  Tp Contrato                              ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Carregando variaveis mv_par?? para Variaveis do Sistema.     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
nOrdem   := aReturn[8]
dDataRef := mv_par01
nRelat   := mv_par02
Semana   := mv_par03
cFilDe   := mv_par04
cFilAte  := mv_par05
cCcDe    := mv_par06
cCcAte   := mv_par07
cMatDe   := mv_par08
cMatAte  := mv_par09
cNomDe   := mv_par10
cNomAte  := mv_par11
cSit     := mv_par12
cCat     := mv_par13
lSalta   := If(mv_par14 == 1,.T.,.F.)
cSinAna  := If(mv_par15 == 1,"A","S")
lImpFil  := If(mv_par16 == 1,.T.,.F.)
lImpEmp  := If(mv_par17 == 1,.T.,.F.)
lImpNiv  := If(mv_par18 == 1,.T.,.F.)
lUnicNV  := If(mv_par19 == 1,.T.,.F.)
lImpTot  := If(mv_par20 == 1,.T.,.F.)
cTipCC   := mv_par21
cRefOco  := mv_par22
nTpContr := mv_par23

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³  Pega descricao da semana                                    ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
cDesOrdem:=If(nOrdem == 1,STR0012,If(nOrdem==2,STR0013,If(nOrdem==3,STR0014,If(nOrdem==4,STR0015,If(nOrdem==5,STR0016,"C.Center + Item + Class")))))		//"  ORDEM: C.C. DO CADASTRO"###"  ORDEM: MATRICULA"###"  ORDEM: NOME"###"  C.C. DO MOVTO."###"  C.CUSTO + NOME"
//cDesOrdem:=If(nOrdem == 1,STR0012,If(nOrdem==2,STR0013,If(nOrdem==3,STR0014,If(nOrdem==4,STR0015,If(nOrdem==5,STR0016,STR0072)))))		//"  ORDEM: C.C. DO CADASTRO"###"  ORDEM: MATRICULA"###"  ORDEM: NOME"###"  C.C. DO MOVTO."###"  C.CUSTO + NOME"

If Semana # Space(2) .And. Semana # "99"
	cCabec := fRetPer( Semana,dDataRef )
Else
	cCabec := " / "+Upper(MesExtenso(Month(dDataRef)))+STR0017+STR(YEAR(dDataRef),4) + cDesOrdem	//" DE "
Endif

Titulo := STR0018+If(nRelat==1,STR0019,;				//"FOLHA "###"DO ADIANTAMENTO "
Iif(nRelat==2,STR0020,If(nRelat==3,STR0021,;	//"DE PAGAMENTO "###"DA 1a. PARCELA 13o SAL. "
STR0022))) + cCabec 							//"DA 2a. PARCELA 13o SAL."

NewHead    := Nil

cMesAnoRef := StrZero(Month(dDataRef),2) + StrZero(Year(dDataRef),4)

RptStatus({|lEnd| PGR040Imp(@lEnd,wnRel,cString,cMesAnoRef,nTpContr,.F.)},Capital(Titulo))

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³ GPR040Imp³ Autor ³ R.H. - Ze Maria       ³ Data ³ 03.03.95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Folha de Pagamanto                                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe e ³ GPR040Imp(lEnd,wnRel,cString)                              ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ lEnd        - A‡ao do Codelock                             ³±±
±±³          ³ wnRel       - T¡tulo do relat¢rio                          ³±±
±±³          ³ cString     - Mensagem                                     ³±±
±±³          ³ lGeraLanc   - Indica se deve gerar o INSS (SRZ)            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ Esta funcao tambem e utilizada a partir da impressao da GPS³±±
±±³          ³ e Contabilizacao(para gerar lancamentos), queira,ao altera-³±±
±±³          ³ la, testar ambas as rotinas.                               ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
STATIC Function PGR040Imp(lEnd,WnRel,cString,cMesAnoRef,nTpContr,lGeraLanc,lExecProc)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Define Variaveis Locais (Basicas)                            ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Local cMapa       := 0
Local nLaco       := 0
Local nByte := 0
Local aOrdBag     := {}
Local cArqMov     := ""
Local cMesArqRef  
Local dChkDtRef   := CTOD("01/"+Left(cMesAnoRef,2)+"/"+Right(cMesAnoRef,4),"DDMMYY")
Local nQ
Local nNumCasas := 1
Local cArqSRC
Private lSPGP110		:= .F.

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Define Variaveis Private			                         ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Private cMascCus  := GetMv("MV_MASCCUS")
Private cCalcInf  := GetMv("MV_CALCINF")
Private cEncInss  := GetMv("MV_ENCINSS",,"N")
Private cQuebFun  := GetMv("MV_QUEBFUN",,"S") //quando for igual a nao, imprime funcionario sem quebrar pagina 
Private cIRefSem  := GetMv("MV_IREFSEM",,"S")
Private aNiveis   := {}
Private nDed      := 0.00   // Deducoes Inss
Private aCodFol   := {}
Private	cTpC      := ""
Private	cTpC1     := ""
Private aInssEmp[24][2]
Private aEmpP     := {}  // Empresa
Private aEmpD     := {}
Private aEmpB     := {}
Private aFilP     := {}  // Filial
Private aFilD     := {}
Private aFilB     := {}
Private aCcP      := {}  // Centro de Custo
Private aCcD      := {}
Private aCcB      := {}

//definicao para identificar item e classe na gravação do SRZ
Private lTemItemRA   := SRA->( FieldPos( "RA_ITEM" ) # 0 )
Private lTemClVlRA	 := SRA->( FieldPos( "RA_CLVL" ) # 0 )
Private lTemItemRI   := SRI->( FieldPos( "RI_ITEM" ) # 0 )
Private lTemClVlRI	 := SRI->( FieldPos( "RI_CLVL" ) # 0 )
Private lTemItemRC   := SRC->( FieldPos( "RC_ITEM" ) # 0 )
Private lTemClVlRC	 := SRC->( FieldPos( "RC_CLVL" ) # 0 )
Private lTemItemRZ	 := SRZ->( FieldPos( "RZ_ITEM" ) # 0 )
Private lTemClVlRZ	 := SRZ->( FieldPos( "RZ_CLVL" ) # 0 )
Private cContribuicao := cContrProAuto := ""
Private cAnoMesRef    := Right(cMesAnoRef,4) + Left(cMesAnoRef,2)
Private cAliasMov     := ""                                      
Private	cItAnt        := ""
Private	cClAnt		  := ""
Private	cItCt         := ""
Private	cClVl		  := ""
Private lQuery			:= .F.
Private lRelQuery		:= .F.
Private lGeraSRZ 	 	:= lGeraLanc   
Private lGerouSRZ		:= .T. 

If cPaisLoc == "URU"
	Private cCCCuota
Endif
lSPGP110 := SuperGetMv("MV_SPGP110",,.F.)
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//| Verifica Paramentro Calculo INSS com Existencia campo SR->RZ_MAT |
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea( "SRZ" )
If cEncInss == "S" .and. Type("SRZ->RZ_MAT") == "U"
	AVISO("Aviso","Quando o parametro MV_ENCINSS estiver com 'S' e necessario a criacao do campo RZ_MAT no arquivo SRZ",{"Enter"} ) 
   return
Endif   
If cPaisLoc $ "URU|ARG|PAR"
	If nRelat == 3
		cMesArqRef := "13" + Right(cMesAnoRef,4)	
	ElseIf nRelat == 4
		cMesArqRef := "23" + Right(cMesAnoRef,4)		
	Else
		cMesArqRef := cMesAnoRef
	Endif		
Else
	If nRelat == 4  
		cMesArqRef := "13" + Right(cMesAnoRef,4)
	Else
		cMesArqRef := cMesAnoRef
	Endif	              
Endif			

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//| Verifica se existe o arquivo de fechamento do mes informado  |
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If !OpenSrc( cMesArqRef, @cAliasMov, @aOrdBag, @cArqMov, dChkDtRef, lGeraSRZ )
	Return .f.
Endif

#IFDEF TOP
If !Empty(cAliasMov)
	cArqSRC := cArqMov
Else
	If nRelat == 4  
		cArqSRC := RetSqlName("SRI")
	Else
		cArqSRC := RetSqlName("SRC")
	Endif
Endif
#ELSE
	lSPGP110	:= .F.		// So utiliza procedure em ambiente TOPCONNECT
#ENDIF

If lGeraSRZ .And. ( TcGetDb() $ "MSSQL_MSSQL7_ORACLE_INFORMIX_DB2" ) .AND. lSPGP110 
	If cPaisLoc == "URU" .And.nTpContr == 3
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Imprime folha ou gera SRZ para ambos tipos de contrato       ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		cTpC  := " *12"
		cTpC1 := " *12"
	Else
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Imprime folha ou gera SRZ para tipo de contrato INDETERMINADO³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	 	If nTpContr == 1 .Or. nTpContr == 3 
			cTpC  := "1"
			cTpC1 := " *1"
		EndIf
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Imprime folha ou gera SRZ para tipo de contrato DETERMINADO  ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If nTpContr == 2 .Or. nTpContr == 3 
			cTpC  := "2"
			cTpC1 := "2"
		EndIf
	Endif
	bBlkProc := { || lExecProc := fProcGravaSrz(nRelat, cEncInss,cMesAnoRefProc, @lGerouSRZ, cArqSRC, @nTpContr) }  // Gera Arquivo SRZ via procedure	
	If lPrimeira
		//MsAguarde( bBlkProc,, STR0077 ) 
		MsAguarde( bBlkProc,, "wait..." ) 
	EndIf
Else    
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ aNiveis -  Armazena as chaves de quebra.                     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lImpNiv

	aNiveis:= MontaMasc(cMascCus)
	
	//--Criar os Arrays com os Niveis de Quebras
	For nQ = 1 to Len(aNiveis)
		If nQ > 9
			nNumCasas := 2
		EndIf
	
		cQ := STR(NQ,nNumCasas)
		Private aCcP&cQ := {}    // Centro de Custo
		Private aCcD&cQ := {}
		Private aCcB&cQ := {}
		cCcAnt&cQ       := ""    //Variaveis c.custo dos niveis de quebra
		//--Totais dos Funcionarios dos Niveis de quebra
		nCnor&cQ := nCafa&cQ := nCdem&cQ := nCfer&cQ := 0
		nCexc&cQ := nCadm&cQ := nCtot&cQ := 0
	Next nQ
Endif

If cPaisLoc == "URU" .And.nTpContr == 3
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Imprime folha ou gera SRZ para ambos tipos de contrato       ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	cTpC  := " *12"
	cTpC1 := " *12"
		fImpGerFol(lEnd,cAnoMesRef,cArqSRC)
Else
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Imprime folha ou gera SRZ para tipo de contrato INDETERMINADO³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If nTpContr == 1 .Or. nTpContr == 3
		cTpC  := "1"
		cTpC1 := " *1"
			fImpGerFol(lEnd,cAnoMesRef,cArqSRC)
	EndIf
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Imprime folha ou gera SRZ para tipo de contrato DETERMINADO  ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If nTpContr == 2 .Or. nTpContr == 3
		cTpC  := "2"
		cTpC1 := "2"
			fImpGerFol(lEnd,cAnoMesRef,cArqSRC)
	EndIf
Endif
Endif 
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Seleciona arq. defaut do Siga caso Imp. Mov. Anteriores      ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If !Empty( cAliasMov )
	fFimArqMov( cAliasMov , aOrdBag , cArqMov )
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Retorna ordem 1 dos arquivos processados                     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea("SRC")
dbSetOrder(1)
dbSelectArea("SRI")
dbSetOrder(1)
dbSelectArea("SRA")
DbClearFilter()
dbSetOrder(1)
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Termino do relatorio                                         ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If !lGeraSRZ
	//--Gerar Rodape no filnal da Impressão
	Li := 58
	Impr("","F")
	Set Device To Screen
	If aReturn[5] = 1
		Set Printer To
		Commit
		ourspool(wnrel)
	Endif
	MS_FLUSH()
EndIf

Return ( lGerouSRZ )

*---------------------------------------------*
Static Function fSoma(aMatriz,cArq,cCod,nValor)
*---------------------------------------------*
// 1- Matriz onde os dados estao sendo armazenados
// 2- Tipo de Arquivo "C" ou "I"
// 3- Prov/Desc/Base a ser gravado

Local nRet
Local nVal1 := nVal2 := nVal3 := 0

If	cCod == Nil                  // Caso o Codigo nao seja passado
	If	cArq == "C"               // o tratamento e feito de acordo
		cCod := ( cAliasQSRC ) -> RC_PD        // com o cArq (Arquivo usado).
	Elseif cArq == "I"
		cCod := ( cAliasQSRI )->RI_PD
	Endif
Endif

If nValor == Nil
	If	cArq == "C"               // o tratamento e feito de acordo
		nValor := ( cAliasQSRC )->RC_VALOR        // com o cArq (Arquivo usado).
	Elseif cArq == "I"
		nValor := ( cAliasQSRI )->RI_VALOR
	Endif
Endif

If	cArq == "C"
	nVal1 := If(( cAliasQSRC )->RC_QTDSEM > 0 .And. cIRefSem == "S", ( cAliasQSRC )->RC_QTDSEM, ( cAliasQSRC )->RC_HORAS)
	nVal2 := nValor
	nVal3 := ( cAliasQSRC )->RC_PARCELA
Elseif cArq == "I"                   // Carregando nVars de acordo
	nVal1 := If(( cAliasQSRI )->RI_QTDSEM > 0, ( cAliasQSRI )->RI_QTDSEM, ( cAliasQSRI )->RI_HORAS)
	nVal2 := nValor
	nVal3 := 0
Endif

nRet := Ascan( aMatriz,{|X| x[1] == cCod } )   // Testa se ja existe
If	nRet == 0
	Aadd (aMatriz,{cCod,nVal1,nVal2,nVal3,1,cItCt,cClVl})  // se nao cria elemento
Else
	aMatriz[nRet,2] += nVal1                   // se ja so adiciona
	aMatriz[nRet,3] += nVal2
	aMatriz[nRet,4] += nVal3
	aMatriz[nRet,5] ++
Endif
Return Nil

*---------------------------*
Static Function fTestaTotal()      // Executa Quebras
*---------------------------*
Local cCusto
Local cItem
Local cClasse
Local nQ
Local nNumCasas := 1
Local cRelFil
cFilAnterior := cFil
If nOrdem == 4 
	dbSelectArea( cAliasQSRA )
    dbSkip()
	cCcAnt := cCcto
	cItAnt := cItCt
	cClAnt := cClVl
	cCusto  := if(ifDefTop(), ( cAliasQSRA )-> RC_CC, SRC->RC_CC)

ElseIf nOrdem == 6 
    dbSelectArea( cAliasQSRA )   
	dbSkip()
	If nRelat == 4 .or. If(cPaisLoc $ "URU|ARG|PAR",nRelat==3,.F.) 
		dbSelectArea("SRI")
	Else
	  	dbSelectArea("SRC") 
	EndIf 

	cCcAnt := cCcto
	cItAnt := cItCt
	cClAnt := cClVl
	cCusto  := if(ifDefTop(), ( cAliasQSRA )-> RC_CC, SRC->RC_CC)
Else
   	cCcAnt := cRelCC
	If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
		cItAnt := ( cAliasQSRA )->RA_ITEM
		cClAnt := ( cAliasQSRA )->RA_CLVL
   	Else
   		cItAnt := ""
   		cClAnt := ""	
    EndIf
    dbSelectArea( cAliasQSRA )
	dbSkip()	
	cCusto  := if(ifDefTop(), ( cAliasQSRA )-> RA_CC, SRA->RA_CC) 

Endif

If lImpNiv .And. Len(aNiveis) > 0
	For nQ = 1 TO Len(aNiveis)
		If nQ > 9
			nNumCasas := 2
		EndIf			
		cQ        := Str(nQ,nNumCasas)
		cCcAnt&cQ := Subs(cCcAnt,1,aNiveis[nQ])
	Next nQ
Endif

If ( cAliasQSRA )->( Eof() ) .Or. (cAliasQSRA)->(&cInicio) > cFim
	cCusto := Quebra( nOrdem, nRelat, 'CC' )
	cItem  := Quebra( nOrdem, nRelat, 'IT' )
	cClasse:= Quebra( nOrdem, nRelat, 'CL' )
	fImpCc()
	fImpNiv(cCcAnt,.T.,cItAnt,cClAnt)
	fImpFil()
	fImpEmp()
	
Elseif cFilAnterior # If (nOrdem == 4 .or. nOrdem == 6,if(nRelat==4 , ( cAliasQSRA )->RI_FILIAL, (cAliasQSRA) ->RC_FILIAL),( cAliasQSRA )->RA_FILIAL) 
	fImpCc()
	fImpNiv(cCcAnt,.T.,cItAnt,cClAnt)
	fImpFil()

Elseif nOrdem == 6 .And. !( cAliasQSRA )->( Eof() ) .And. cCcAnt+cItAnt+cClAnt # ;
		Quebra( nOrdem, nRelat, 'CC' )+Quebra( nOrdem, nRelat, 'IT' )+Quebra( nOrdem, nRelat, 'CL' )
	cCusto := Quebra( nOrdem, nRelat, 'CC' )  
	cItem  := Quebra( nOrdem, nRelat, 'IT' )
	cClasse:= Quebra( nOrdem, nRelat, 'CL' )
	fImpCc()
	fImpNiv(cCusto,.F.,cItem,cClasse)

ElseIf ( StrZero(nOrdem,1) $ "1/4/5" .And. Quebra( nOrdem, nRelat, 'CC' ) # cCcAnt )
	fImpCc()
   	fImpNiv(cCusto,.F.,cItAnt,cClAnt)
Endif


If nOrdem # 4 .and. nOrdem # 6
	dbSelectArea( cAliasQSRA )
Endif

Return Nil

*---------------------------------*
Static Function fImpFun(aFunP,aFunD,aFunB)            // Imprime um Funcionario
*---------------------------------*
Local cFil
If	Len(aFunP) == 0 .And. Len(aFunD) == 0 .And. Len(aFunB) == 0
	Return Nil
Endif

//-- Calculo % Acid. Trab. por Funcionario

If cEncInss == "N" .And. cPaisLoc == "BRA"
   fCalcAci(aFunB,aFunP,cFil)
End   

If !lGeraSRZ .And. !lImpTot
	If cSinAna == "A"
		fImprime(aFunP,aFunD,aFunB,1)
	Endif              
EndIf

If lGeraSRZ .and. cEncInss == "S" 
	#IFNDEF TOP
		fGrava(aFunP,aFunD,aFunB,1,SRA->RA_MAT) // Gera Arquivo SRZ
	#ELSE
		fGrava(aFunP,aFunD,aFunB,1,cRelMat)    // Gera Arquivo SRZ passando como matrícula a variável definida na query
	#ENDIF
Endif

aFunP := {}
aFunD := {}
aFunB := {}
Return Nil

*------------------*
Static Function fImpCc()             // Imprime Centro de Custo
*------------------*
Local nValBas := 0.00
Local nValAut := 0.00
Local nValPro := 0.00
Local nNumCasas := 1
Local nQ

If (Len(aCcP) == 0 .And. Len(aCcD) == 0 .And. Len(aCcB) == 0)
	
	// Zera variaveis do c.c. anterior
	aCcP := {}
	aCcD := {}
	aCcB := {}
	nCnor := nCafa := nCdem := nCfer := nCexc := nCtot := nCinss := cCadm := 0
	
	Return Nil
Endif

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Resgata os valores utilizados na GPS         ³
//³que foram informados no parametro 15.        ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If cPaisLoc == "BRA"
	fCalcCompl("2",cCcAnt,.F.,nOrdem)
Endif

if cEncInss == "N" .And. cPaisLoc == "BRA"
	If nOrdem == 1 .Or. nOrdem == 4 .Or. nOrdem == 5 .OR. nOrdem == 6
     	fCalcInss("2",cFilAnterior,cCcAnt)
	Endif
Endif
//--SomaToria para os Niveis de Quebra
If lImpNiv .And. Len(aNiveis) > 0
	For nQ:=1 To Len(aNiveis)
		If nQ > 9
			nNumCasas := 2
		EndIf		
		cQ := Str(nQ,nNumCasas)
		aEval(aCcP , { |X| fSomaNiv(aCcP&cQ,x[1],x[2],x[3],x[4],x[5]) } )
		aEval(aCcD , { |X| fSomaNiv(aCcD&cQ,x[1],x[2],x[3],x[4],x[5]) } )
		aEval(aCcB , { |X| fSomaNiv(aCcB&cQ,x[1],x[2],x[3],x[4],x[5]) } )
		nCnor&cQ  += nCnor
		nCafa&cQ  += nCafa
		nCdem&cQ  += nCdem
		nCfer&cQ  += nCfer
		nCexc&cQ  += nCexc
		nCtot&cQ  += nCtot
		nCadm&cQ  += nCadm		
	Next nQ
Endif
If cPaisLoc == "URU"       
	//So calcular se teve lanzada verba de salario mensal ou horista (se trabalhou) 
	//ou se esteve de ferias
	If aScan(aCcP,{|x| x[1] $ aCodFol[31,1]+"*"+aCodFol[32,1]+"*"+aCodFol[72,1]+"*"+aCodFol[22,1]+"*"+aCodFol[24,1]}) > 0
		LocBSEUru(@aCcB)
	Endif
Endif

If lGeraSRZ
	fGrava(aCcP,aCcD,aCcB,2,"zzzzzz")           // Gera Arquivo SRZ
Else
	If !lUnicNV .And. !lImpTot
		If nOrdem == 1 .Or. nOrdem == 4 .Or. nOrdem == 5 .Or. nOrdem == 6
			fImprime(aCcP,aCcD,aCcB,2) // Imprime
		Endif
	Endif
EndIf
aCcP := {}
aCcD := {}
aCcB := {}
nCnor := nCafa := nCdem := nCfer := nCexc := nCtot := nCinss := nCadm := 0
Return Nil

*-----------------------------*
Static Function fImpNiv(cCusto,lGeral,cItem,cClasse)     // Imprime Centro de Custo
*-----------------------------*
Local nNumCasas := 2
Local nQ
//-- Verifica se houve quebra dos Niveis de C.Custo
If nOrdem == 1 .Or. nOrdem == 4 .Or. nOrdem == 5 .Or. nOrdem == 6
	If !lGeraSRZ .And. lImpNiv .And. Len(aNiveis) > 0
		For nQ := Len(aNiveis) to 1 Step -1
			If nQ < 10
				nNumCasas := 1
			EndIf		
			cQ := Str(nQ,nNumCasas)
			//-- Verifica se houve quebra dos Niveis de C.Custo
			If Subs(cCusto,1,aNiveis[nQ]) # cCcAnt&cQ .Or. lGeral
				If (Len(aCcP&cQ) # 0 .Or. Len(aCcD&cQ) # 0 .Or. Len(aCcB&cQ) # 0)
					fImprime(aCcP&cQ,aCcD&cQ,aCcB&cQ,5,cCcAnt&cQ,cQ,cItAnt,cClAnt)
					aCcP&cQ   := {}
					aCcD&cQ   := {}
					aCcB&cQ   := {}
					nCnor&cQ  := 0
					nCafa&cQ  := 0
					nCdem&cQ  := 0
					nCfer&cQ  := 0
					nCexc&cQ  := 0
					nCtot&cQ  := 0
					nCadm&cQ  := 0 
				Endif
			Endif
		Next nQ
	Endif
Endif

Return Nil

*-----------------------*
Static Function fImpFil()            // Imprime Filial
*-----------------------*
If	Len(aFilP) == 0 .And. Len(aFilD) == 0 .And. Len(aFilB) == 0
	Return Nil
Endif
               
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Resgata os valores utilizados na GPS         ³
//³que foram informados no parametro 15.        ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If cPaisLoc == "BRA"
	fCalcCompl("1","",.T.,nOrdem)
Endif

if cEncInss == "N" .And. cPaisLoc == "BRA"

	If nOrdem # 1 .And. nOrdem # 4 .And. nOrdem # 5 .And. nOrdem # 6
		fCalcInss("1",cFilAnterior)
	Endif
Endif
If cPaisLoc == "URU"
	LocCMcUru("1")
Endif
If lGeraSRZ
	fGrava(aFilP,aFilD,aFilB,3,"zzzzzz")
Else
	If lImpFil
		fImprime(aFilP,aFilD,aFilB,3)
	Endif
EndIf
aFilP := {}
aFilD := {}
aFilB := {}
nFnor := nFafa := nFdem := nFfer := nFexc := nFtot := nFinss := nFAdm := 0
Return Nil

*------------------*
Static Function fImpEmp()            // Imprime Empresa
*------------------*
If Len(aEmpP) == 0 .And. Len(aEmpD) == 0 .And. Len(aEmpB) == 0
	Return Nil
Endif
If cPaisLoc == "URU"
	LocCMcUru("1")
Endif
If lGeraSRZ
	fGrava(aEmpP,aEmpD,aEmpB,4,"zzzzzz")
Else
	If lImpEmp
		fImprime(aEmpP,aEmpD,aEmpB,4)
	Endif
EndIf
aEmpP := {}
aEmpD := {}
aEmpB := {}
nEnor := nEafa := nEdem := nEfer := nEexc := nEtot := nEinss := 0
nFuncs := 0
Return Nil

*-----------------------------------------------*
Static Function fImprime(aProv,aDesc,aBase,nTipo,cCt,cN,cIt,cCl)
*-----------------------------------------------*
// nTipo: 1- Funcionario
//        2- Centro de Custo
//        3- Filial
//        4- Empresa

Local nMaximo
Local nConta,nCon
Local nTVP := nTVD := nLIQ := 0   // Totais dos Valores
Local nTHP := nTHD := 0 		    // Referencias
Local cFil,cCc,cPd,nHrs,nVal,nOco
Local cCodFunc	:= ""
Local cDescFunc	:= ""
Local nRefOco   := 1 
Local nBasDes   := 0
Local nLinAtu      := 0
Local nTotalLinhas := 0

Private cNv := cN

aProv := ASort (aProv,,,{|x,y| x[1] < y[1] }) // Sorteando Arrays
aDesc := ASort (aDesc,,,{|x,y| x[1] < y[1] })
aBase := ASort (aBase,,,{|x,y| x[1] < y[1] })

nMaximo:= MAX(MAX(Len(aProv),Len(aDesc)),Len(aBase))
If	nTipo == 1
	If cQuebFun == "S"
	    If Li + nMaximo + 6 >= 58  // Testa somente quando e funcionario
			Impr("","P")            // Salta Pagina caso nao caiba
		EndIf	
	Endif
Elseif nTipo == 2
	If lSalta
		Impr("","P")
	Endif
Else
	Impr("","P")
Endif

If cPaisLoc == "URU"
	WCabec1 := STR0023+aInfo[3]+" "+If(nTipo#4,STR0027+cFilAnterior+" - "+aInfo[1],Space(26))+Space(23)	//"Empresa: "
Else
	WCabec1 := STR0023+aInfo[3]+" "+If(nTipo#4,STR0027+cFilAnterior+" - "+aInfo[1],Space(26))+Space(23)+STR0024+If(cTpC$' *1',STR0025,STR0026)	//"Empresa: "###" Contrato do Tipo : "###"Indeterminado"###"Determinado"
Endif
If nTipo == 1 

	/*ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	  ³ Carrega Funcao do Funcion. de acordo com a Dt Referencia     ³
	  ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ*/
	fBuscaFuncRel(dDataRef,@cCodFunc, @cDescFunc ) 

	DET:= ALLTRIM(STR0028)		 //" C.CUSTO: "
	If cTipCC == 1              //-- Codigo
		Det:= Det + If (nOrdem # 4 .and. nOrdem # 6,Subs(cRelCC+Space(20),1,20),Subs(cCcto+Space(20),1,20))
	ElseIf cTipCC == 2          //-- Descricao
		Det:= Det + DescCc(If(nOrdem # 4 .and. nOrdem # 6,cRelCC,cCcto),cFilAnterior,18)
	ElseIf cTipCC == 3          //-- Ambos
		Det:= Det + AllTrim(Subs(If(nOrdem # 4 .and. nOrdem # 6,cRelCC,cCcto)+Space(20),1,20))+"-"+DescCc(If(nOrdem # 4 .and. nOrdem # 6,cRelCC,cCcto),cFilAnterior,20)  
	ElseIf cTipCC == 4          //-- Dados Tomador
	   	If(Alltrim(POSICIONE("CTT",1,xFilial("CTT")+cRelCC ,"CTT->CTT_NOME")) != "")
		  		Det:= Det + If (nOrdem # 4 .and. nOrdem # 6,Subs(cRelCC+Space(20),1,20),Subs(cCcto+Space(20),1,20));
				+"C Center "+POSICIONE("CTT",1,xFilial("CTT")+cRelCC ,"CTT->CTT_NOME");
				+"CNPJ "+POSICIONE("CTT",1,xFilial("CTT")+cRelCC ,"CTT->CTT_CEI")

//				+STR0073+POSICIONE("CTT",1,xFilial("CTT")+cRelCC ,"CTT->CTT_NOME");
//				+STR0074+POSICIONE("CTT",1,xFilial("CTT")+cRelCC ,"CTT->CTT_CEI")
				IMPR(DET,"C")
				Det := ""                                                           
		Else
		   		Det:= Det + If (nOrdem # 4 .and. nOrdem # 6,Subs(cRelCC+Space(20),1,20),Subs(cCcto+Space(20),1,20))
		EndIf		
	Endif
		Det:= Det+STR0029+cRelMat+STR0030+Subs((cAliasQSRA)->RA_NOME,1,30)+;	
	      STR0031 + cCodFunc + " " + cDescFunc															 //" FUNCAO: "

	 If ExistBlock("GP040Det")
     cDetAux	:= ExecBlock( "GP040Det" , .F. , .F. , { "1", DET } , .F. )
     	If !empty(cDetAux) .and. valtype(cDetAux) == "C"
 			DET      := cDetAux
 		ElseIf !empty(cDetAux) .and. valtype(cDetAux) == "A"
 			nTotalLinhas := Len(cDetAux)
 			For nLinAtu := 1 To nTotalLinhas
 				DET := cDetAux[nLinAtu]
 				If nLinAtu < nTotalLinhas
		 			IMPR(DET,"C")
		 		EndIf
	 		Next nLinAtu 		
     	Endif
     EndIf     
Elseif nTipo == 2
	DET:= STR0032+cFilAnterior+STR0035+cCcAnt+" - "+AllTrim(DescCc(cCcAnt,cFilAnterior,40))//"Filial: "###" C.CUSTO: "
	//--Descricao Item e Classe
	If nOrdem==6
		cDescIt := AllTrim(fDesc( "CTD", cItAnt , "CTD_DESC01" ))
		cDescCl := AllTrim(fDesc( "CTH", cClAnt , "CTH_DESC01" ))
        DET += " - "+ "Item: " +cItAnt + cDescIt +  " - "+ "Class: " + cClAnt + cDescCl //"ITEM: "##"CLASSE: " 
//        DET += " - "+ STR0080 +cItAnt + cDescIt +  " - "+ STR0081 + cClAnt + cDescCl //"ITEM: "##"CLASSE: " 
	EndIf
Elseif nTipo == 3
	DET:= STR0033+cFilAnterior+" - "+aInfo[1]		//"Filial: "
Elseif nTipo == 4
	DET:= STR0034+aInfo[3]		//"Empresa: "
Elseif nTipo == 5
	If cCt # Nil
		DET:= STR0033+cFilAnterior+STR0035+cCt+" - "+DescCc(cCt,cFilAnterior)+If(nOrdem==6," - "+cIt+cCl,'')//"Filial: "###" C.CUSTO: "
	Else
		DET:= STR0033+cFilAnterior+STR0035+cCcAnt+" - "+DescCc(cCcAnt,cFilAnterior)+If(nOrdem==6," - "+cItAnt+cClAnt,'')	//"Filial: "###" C.CUSTO: "
	Endif
Endif
IMPR(DET,"C")

If	nTipo == 1
	//--vERIFICA SE EXISTEW O CAMPO PARA IMPRESSAO
		If Type("(cAliasQSRA)->RA_NOMECOM") # "U" .And. ! Empty((cAliasQSRA)->RA_NOMECOM)
		Det := 	STR0067+" "+(cAliasQSRA)->RA_NOMECOM
		IMPR(DET,"C")	
	Endif	
	   	DET:= STR0036+Dtoc((cAliasQSRA)->RA_ADMISSA)+STR0037+fDesc("SX5","28"+(cAliasQSRA)->RA_CATFUNC,"X5DESCRI()",12,cFil)+" "
	If !Empty( cAliasMov )
		nValSal := 0
		nValSal := fBuscaSal(dDataRef,,,.f.)
		If nValSal ==0
		  	nValSal := (cAliasQSRA)->RA_SALARIO
		EndIf
	Else
	  	nValSal := (cAliasQSRA)->RA_SALARIO
	EndIf
	DET+= STR0043+TRANSFORM(nValSal,"@E 999,999,999.99")+STR0044		//"SAL.: "###"  DEP.I.R.: "
	DET+= (cAliasQSRA)->RA_DEPIR+STR0045+(cAliasQSRA)->RA_DEPSF+Iif(nRelat<4,STR0046+StrZero((cAliasQSRA)->RA_PERCADT,3) + " %","")+" HR.MES: "	//"  DEP.SAL.FAM.: "###"  PERC.ADTO: "
	DET+= STR((cAliasQSRA)->RA_HRSMES,6,2)
	 If ExistBlock("GP040Det")
     cDetAux	:= ExecBlock( "GP040Det" , .F. , .F. , { "2", DET } , .F. )
     	If !empty(cDetAux) .and. valtype(cDetAux) == "C"
 			DET      := cDetAux
 		ElseIf !empty(cDetAux) .and. valtype(cDetAux) == "A"
 			nTotalLinhas := Len(cDetAux)
 			For nLinAtu := 1 To nTotalLinhas
 				DET := cDetAux[nLinAtu]
 				If nLinAtu < nTotalLinhas
		 			IMPR(DET,"C")
		 		EndIf
	 		Next nLinAtu 		
     	Endif
     EndIf     
Else
	Det:=" "
Endif
IMPR(DET,"C")
DET:= SPACE(15)+STR0047+SPACE(30)+STR0048+SPACE(30)+STR0049	//"P R O V E N T O S"###"D E S C O N T O S"###"B A S E S"
IMPR(DET,"C")

If cRefOco == 2 .And. cSinAna == "S"   //-- Ocorrencia
	Det := STR0050					//"COD DESCRICAO         OCOR.          VALOR PC|"
	Det += space(1)+STR0050		//"COD DESCRICAO         OCOR.          VALOR PC|"
	Det += space(1)+STR0051		//"COD DESCRICAO              VALOR OCOR."
Else
	Det := STR0052				//"COD DESCRICAO          REF.          VALOR PC|"
	Det += space(1)+STR0052		//"COD DESCRICAO          REF.          VALOR PC|"
	Det += space(1)+STR0053		//"COD DESCRICAO                VALOR"
Endif

IMPR(DET,"C")

If cPaisLoc $ "PAR|CHI" //Impressao especifica para moedas de valores altos

	If cRefOco == 2 .And. cSinAna == "S"   //-- Ocorrencia
		For nConta :=1 TO nMaximo
		       	Det:= If (nConta > Len(aProv),Space(45),aProv[nConta,1]+" "+Left(DescPd(aProv[nConta,1],If(nTipo = 1,(cAliasQSRA)->RA_FILIAL,cFilAnterior)),14)+" "+;
			Transform(aProv[nConta,5],'99999999')+" "+Transform(aProv[nConta,3],'@E 99999999999.99')+" "+StrZero(aProv[nConta,4],2))+"| "
			   	Det +=If (nConta > Len(aDesc),Space(45),aDesc[nConta,1]+" "+Left(DescPd(aDesc[nConta,1],If(nTipo = 1,(cAliasQSRA)->RA_FILIAL,cFilAnterior)),14)+" "+;
			Transform(aDesc[nConta,5],'99999999')+" "+Transform(aDesc[nConta,3],'@E 99999999999.99')+" "+StrZero(aDesc[nConta,4],2))+"| "
			   	Det +=If (nConta > Len(aBase),Space(36),aBase[nConta,1]+" "+Left(DescPd(aBase[nConta,1],If(nTipo = 1,(cAliasQSRA)->RA_FILIAL,cFilAnterior)),14)+" "+;
			Transform(aBase[nConta,3],'@E 9999999999.99')+" "+Transform(aBase[nConta,5],'@E 99999'))
			Impr(Det,"C")
		Next nConta
	Else
		For nConta :=1 TO nMaximo
			Det:= If (nConta > Len(aProv),Space(46),aProv[nConta,1]+" "+Left(DescPd(aProv[nConta,1],If(nTipo = 1,cFil,cFilAnterior)),14)+" "+;
					Transform(aProv[nConta,2],'999999.99')+" "+Transform(aProv[nConta,3],'@E 99999999999.99')+" "+StrZero(aProv[nConta,4],2))+"| "
			Det +=If (nConta > Len(aDesc),Space(46),aDesc[nConta,1]+" "+Left(DescPd(aDesc[nConta,1],If(nTipo = 1,cFil,cFilAnterior)),14)+" "+;
					Transform(aDesc[nConta,2],'999999.99')+" "+Transform(aDesc[nConta,3],'@E 99999999999.99')+" "+StrZero(aDesc[nConta,4],2))+"| "
			Det +=If (nConta > Len(aBase),Space(37),aBase[nConta,1]+" "+Left(DescPd(aBase[nConta,1],If(nTipo = 1,cFil,cFilAnterior)),14)+"  "+;
					Transform(aBase[nConta,3],'@E 99999999999.99'))
			Impr(Det,"C")
		Next nConta
	Endif

Else

	If cRefOco == 2 .And. cSinAna == "S"   //-- Ocorrencia
		For nConta :=1 TO nMaximo
			Det:= If (nConta > Len(aProv),Space(45),aProv[nConta,1]+" "+Left(DescPd(aProv[nConta,1],If(nTipo = 1,(cAliasQSRA)->RA_FILIAL,cFilAnterior)),14)+" "+;
			Transform(aProv[nConta,5],'99999999')+" "+Transform(aProv[nConta,3],'@E 999,999,999.99')+" "+StrZero(aProv[nConta,4],2))+"| "
			Det +=If (nConta > Len(aDesc),Space(45),aDesc[nConta,1]+" "+Left(DescPd(aDesc[nConta,1],If(nTipo = 1,(cAliasQSRA)->RA_FILIAL,cFilAnterior)),14)+" "+;
			Transform(aDesc[nConta,5],'99999999')+" "+Transform(aDesc[nConta,3],'@E 999,999,999.99')+" "+StrZero(aDesc[nConta,4],2))+"| "
			Det +=If (nConta > Len(aBase),Space(36),aBase[nConta,1]+" "+Left(DescPd(aBase[nConta,1],If(nTipo = 1,(cAliasQSRA)->RA_FILIAL,cFilAnterior)),14)+"  "+;
			Transform(aBase[nConta,3],'@E 99,999,999.99')+" "+Transform(aBase[nConta,5],'@E 99999'))
			Impr(Det,"C")
		Next nConta
	Else
		For nConta :=1 TO nMaximo
			Det:= If (nConta > Len(aProv),Space(46),aProv[nConta,1]+" "+Left(DescPd(aProv[nConta,1],If(nTipo = 1,cFil,cFilAnterior)),14)+" "+;
					Transform(aProv[nConta,2],'999999.99')+" "+Transform(aProv[nConta,3],'@E 999,999,999.99')+" "+StrZero(aProv[nConta,4],2))+"| "
			Det +=If (nConta > Len(aDesc),Space(46),aDesc[nConta,1]+" "+Left(DescPd(aDesc[nConta,1],If(nTipo = 1,cFil,cFilAnterior)),14)+" "+;
					Transform(aDesc[nConta,2],'999999.99')+" "+Transform(aDesc[nConta,3],'@E 999,999,999.99')+" "+StrZero(aDesc[nConta,4],2))+"| "
			Det +=If (nConta > Len(aBase),Space(37),aBase[nConta,1]+" "+Left(DescPd(aBase[nConta,1],If(nTipo = 1,cFil,cFilAnterior)),14)+"  "+;
					Transform(aBase[nConta,3],'@E 999,999,999.99'))
			Impr(Det,"C")
		Next nConta
	Endif 
	
EndIf

AeVal(aProv,{ |X| nTHP += X[2]})	// Acumula Referencias
AeVal(aDesc,{ |X| nTHD += X[2]})
AeVal(aProv,{ |X| nTVP += X[3]})	// Acumula Valores
AeVal(aDesc,{ |X| nTVD += X[3]})

nLIQ := nTVP - nTVD
DET  := REPLICATE("-",132)
IMPR(DET,"C")
             
nRefOco := If(cRefOco==2 .And. cSinAna=="S",0,1)	//Determinar o espaco do valor no Provento
nBasDes := If(nRefOco==0,2,0)	//Determinar o espaco do valor na Base

If cPaisLoc $ "PAR|CHI" //Impressao especifica para moedas de valores altos                              
	DET := STR0054 + If(cSinAna=="A" .Or. cRefOco==1,SPACE(6),SPACE(5)) + TRANSFORM(nTHP,"999999999.99") + " " + TRANSFORM(nTVP,"@E 999999999999.99")+;
			SPACE(20 + nRefOco) + TRANSFORM(nTHD,"999999999.99") + " " + TRANSFORM(nTVD,"@E 999,999,999.99")+;
			SPACE(5) + STR0062 + SPACE(4-nBasDes) + TRANSFORM(nLIQ,"@E 999,999,999,999.99")				//"SALARIO LIQ."			
	IMPR(DET,"C")                                                                                            
Else
	DET := STR0054 + If(cSinAna=="A" .Or. cRefOco==1,SPACE(7),SPACE(6)) + TRANSFORM(nTHP,"999999999.99") + " " + TRANSFORM(nTVP,"@E 999,999,999.99")+;
			SPACE(20 + nRefOco) + TRANSFORM(nTHD,"999999999.99") + " " + TRANSFORM(nTVD,"@E 999,999,999.99")+;
			SPACE(9) + STR0062 + SPACE(4-nBasDes) + TRANSFORM(nLIQ,"@E 999,999,999.99")					//"SALARIO LIQ."			
	IMPR(DET,"C")                                                                                            
EndIf

DET:=REPLICATE("-",132)
IMPR(DET,"C")

If nTipo # 1
	Det:=STR0055+Strzero(If(nTipo==2,nCnor,If(nTipo==3,nFnor,If (nTipo==4,nEnor,nCnor&cNv))),7)		//"Sit.Normal: "
	Det+=STR0068+Strzero(If(nTipo==2,nCadm,If(nTipo==3,nFadm,If (nTipo==4,nEadm,nCadm&cNv))),7)		//" Admitidos: "	
	Det+=STR0056+Strzero(If(nTipo==2,nCafa,If(nTipo==3,nFafa,If (nTipo==4,nEafa,nCafa&cNv))),7)		//" Afastados: "
	Det+=STR0057+Strzero(If(nTipo==2,nCdem,If(nTipo==3,nFdem,If (nTipo==4,nEdem,nCdem&cNv))),7)		//" Demitidos:"
	Det+=STR0058+Strzero(If(nTipo==2,nCfer,If(nTipo==3,nFfer,If (nTipo==4,nEfer,nCfer&cNv))),7)		//" Ferias:"
	Det+=STR0060+Strzero(If(nTipo==2,nCexc,If(nTipo==3,nFexc,If (nTipo==4,nEexc,nCexc&cNv))),7)		//" Outros C.Custo:"
	Det+=STR0061+Strzero(If(nTipo==2,nCtot,If(nTipo==3,nFtot,If (nTipo==4,nEtot,nCtot&cNv))),8)		//" Total:"
	
	Impr (Det,"C")
	IMPR(REPL("=",132),"C")   // Salta Pagina apos Quebra Cc/Filial/Empresa
	If nTipo # 2 .Or. (nTipo == 2 .And. lSalta)
		Impr("","P")
	Else
		Impr("","C")
	Endif
Endif

Return Nil

*-----------------------------------------------*
Static Function  fBuscaFuncRel(dDataDe,cCodFunc, cDescFunc, nTamFunc, cCatFunc, cDescCateg, nTamCateg, lDataRef )
*-----------------------------------------------*

Local aRecno	:= {}
Local nPos 		:= 0 
Local lCateg	:= .F.

DEFAULT lDataRef 	:= .T.   

DEFAULT nTamFunc	:= 20
DEFAULT nTamCateg   := 25
                           
//-- Verifica se foi passado o codigo da categoria para buscar a sua descricao 
lCateg				:= (cCatFunc <> NIL) 				
DEFAULT cCatFunc	:= ""
DEFAULT cDescCateg	:= SPACE(nTamCateg)

If SR7->( dbSeek( cFil+cRelMat )  )
	While SR7->(!EOF()) .and. If(lDataRef, (MesAno(SR7->R7_DATA)	<= MesAno(dDataDe) ), ( SR7->R7_DATA	<= dDataDe) ) .AND.;
								SR7->R7_FILIAL 	== cFil .AND. ;
								SR7->R7_MAT   	== cRelMat
		AADD(aRecno, {DTOS(SR7->R7_DATA), strzero(SR7->(Recno()),10) , SR7->R7_FUNCAO, SR7->R7_DESCFUN, SR7->R7_CATFUNC }) 
		SR7->(dbSkip())
	EndDo 
	If Len(aRecno) > 0 
		aSort( aRecno,,,{ |x,y| x[1] + x[2] < y[1] + y[2]  } ) 
		nPos 		:= Len( aRecno ) 
		cCodFunc 	:=	aRecno[nPos,3]+ space(1)
		cDescFunc 	:= 	aRecno[nPos,4]									//-- 20 Bytes
		cCatFunc	:= 	aRecno[nPos,5]
	Endif
Endif

//-- Se nao encontrou a funcao na data solicitada, assume a do Cadastro de Funcionarios
If  Empty( Len(aRecno) )
	cCodFunc 	:=	(cAliasQSRA)->RA_CODFUNC + space(1)
	cDescFunc	:=  LEFT(fDesc("SRJ",(cAliasQSRA)->RA_CODFUNC,"RJ_DESC",,cFil),nTamFunc) 
	cCatFunc	:=  (cAliasQSRA)->RA_CATFUNC
Endif
	
//-- Se foi passado o Codigo de Categoria, busca a descricao 
cDescCateg	:=   If( lCateg , DescCateg(cCatFunc, nTamCateg), cDescCateg )						//-- 25 Bytes	
	
Return 
*------------------------------------*
Static Function fGrava(aProv,aDesc,aBase,nTipo,cMat) // Grava Guia de Inss
*------------------------------------*
Local  nMaximo
Local  nConta,nCon
Local lTemItemRZ		:= SRZ->( FieldPos( "RZ_ITEM" ) # 0 )
Local lTemClVlRZ		:= SRZ->( FieldPos( "RZ_CLVL" ) # 0 )
Private aArray		:={aProv,aDesc,aBase}  // Controlador de Arrays
Private nTpGravSRZ:= nTipo				  // Informa qual tipo de registro esta sendo gravado no SRZ
												  // 1=Funcionario  2=C.Custo   3=Filial   4=Empresa

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//| Ponto de Entrada para alterar o conteudo do array aArray antes |
//| da gravacao das verbas do funcionario no SRZ.                  |
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If ExistBlock("GP040SRZ")
	EXECBLOCK("GP040SRZ",.F.,.F.)
EndIf

nMaximo:= MAX(MAX(Len(aArray[1]),Len(aArray[2])),Len(aArray[3]))

FOR nConta :=1 TO nMaximo
	dbSelectArea( "SRZ" ) 
	If nOrdem ==6
		dbSetOrder(3)
	Endif
	
	If nTipo == 1                  
		M->RZ_FILIAL := cFilAnterior
		M->RZ_CC     := cCcto
		If lTemItemRZ .AND.lTemClVlRZ
			M->RZ_ITEM   := cItCt
			M->RZ_CLVL   := cClVl
		EndIf	
	Elseif nTipo == 2
		M->RZ_FILIAL := cFilAnterior
		M->RZ_CC     := cCcAnt
		If lTemItemRZ .AND.lTemClVlRZ
			M->RZ_ITEM   := cItAnt
			M->RZ_CLVL   := cClAnt
	    EndIf
	Elseif nTipo == 3
		M->RZ_FILIAL := cFilAnterior
		M->RZ_CC     := "zzzzzzzzz"
		If lTemItemRZ .AND.lTemClVlRZ
			M->RZ_ITEM   := "zzzzzzzzz"
			M->RZ_CLVL   := "zzzzzzzzz"
		EndIf
	Elseif nTipo == 4
		M->RZ_FILIAL := "zz"
		M->RZ_CC     := "zzzzzzzzz"
		If lTemItemRZ .AND.lTemClVlRZ
			M->RZ_ITEM   := "zzzzzzzzz"
			M->RZ_CLVL   := "zzzzzzzzz"
		EndIf	
	Endif
	
	For nCon := 1 To 3
		If nConta <= Len(aArray[nCon])
			If nTipo == 4             
				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//| Testa chave para os casos onde SRV for compartilhado e existir |
				//| cod.de verba iguais para eventos diferentes.                   |
				//| Teste somente necessario no total por Empresa                  |
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				If ! dbSeek(M->RZ_FILIAL + M->RZ_CC + aArray[nCon,nConta,1]  + cTpC ) 
					RecLock("SRZ",.T.,.T.)
				Else
					RecLock("SRZ",.F.,.T.)
				Endif
			Else
				RecLock("SRZ",.T.)
			Endif 
			SRZ->RZ_FILIAL  := M->RZ_FILIAL
         	If cPaisLoc == "URU" .And. aArray[nCon,nConta,1]== aCodFol[312,1]
         		SRZ->RZ_CC		:= cCCCuota
         	Else
				SRZ->RZ_CC      := M->RZ_CC
        	Endif
			SRZ->RZ_PD      := aArray[nCon,nConta,1] // usa o Controlador
			SRZ->RZ_HRS     := aArray[nCon,nConta,2]
			SRZ->RZ_VAL     := aArray[nCon,nConta,3]
			SRZ->RZ_OCORREN := aArray[nCon,nConta,5]
			SRZ->RZ_TPC     := cTpC
			SRZ->RZ_TIPO    := If(nRelat==4 .or. If(cPaisLoc $ "URU|ARG|PAR",nRelat==3,.F.),"13","FL")
			If Type("SRZ->RZ_MAT") # "U"
				SRZ->RZ_MAT     := cMat
			Endif		
			If cPaisLoc == "DOM"
				SRZ->RZ_SEMANA := cSemana
			Endif	
			If lTemItemRZ
				SRZ->RZ_ITEM	:= aArray[nCon,nConta,6]
			Endif
			If lTemClVlRZ
				SRZ->RZ_CLVL	:= aArray[nCon,nConta,7]
			Endif

			MsUnlock()
		Endif
	Next nCon
Next nConta

If nTipo <> 1
   	RecLock("SRZ",.T.) 

	If nTipo == 2
		SRZ->RZ_FILIAL  := cFilAnterior
		SRZ->RZ_CC      := cCcAnt
		SRZ->RZ_OCORREN := nCinss
		If lTemItemRZ .AND.lTemClVlRZ
			SRZ->RZ_ITEM   := cItAnt
			SRZ->RZ_CLVL   := cClAnt
	    EndIf
	Elseif nTipo == 3
		SRZ->RZ_FILIAL  := cFilAnterior
		SRZ->RZ_CC      := "zzzzzzzzz"
		SRZ->RZ_OCORREN := nFinss 
		If lTemItemRZ .AND.lTemClVlRZ
			SRZ->RZ_ITEM   := "zzzzzzzzz"
			SRZ->RZ_CLVL   := "zzzzzzzzz"
		EndIf	
	Elseif nTipo == 4
		SRZ->RZ_FILIAL  := "zz"
		SRZ->RZ_CC      := "zzzzzzzzz"
		SRZ->RZ_OCORREN := nEinss 
		If lTemItemRZ .AND.lTemClVlRZ
			SRZ->RZ_ITEM   := "zzzzzzzzz"
			SRZ->RZ_CLVL   := "zzzzzzzzz"
		EndIf	
	Endif
	SRZ->RZ_PD   := "zzz"
	SRZ->RZ_TPC  := cTpC					  // grava tipo de contrato
	SRZ->RZ_TIPO := If(nRelat==4 .or. If(cPaisLoc $ "URU|ARG|PAR",nRelat==3,.F.),"13","FL") // grava tipo de lacto contabil
	If TYPE("SRZ->RZ_MAT") # "U"
		SRZ->RZ_MAT  := cMat
	Endif	
	If cPaisLoc == "DOM"	   
		SRZ->RZ_SEMANA := cSemana
	Endif	
	MsUnlock()
Endif	
dbSelectArea( "SRA" )
Return Nil

*------------------------------------------*
Static Function fCalcInss(cTipo,cFil,cCusto)
*------------------------------------------*
Local nValBas  := 0.00
Local nValAut  := 0.00
Local nValPro  := 0.00
Local nValCus  := 0.00
Local nPercPro := 0.00
Local nPercAut := 0.00
Local lCct     := If (cCusto # Nil,.T.,.F.)
Local nPercFPAS:=0
Local nBasePis := 0.00
Local nValPis  := 0.00
Local nPerc

// Verifica o % de Acidente do C.Custo
If lCct
	dbSelectArea("SI3")
	If ( cFil # Nil .And. cFilial == "  " ) .Or. cFil == Nil
		cFil := cFilial
	Endif
	nPercFPAS := 0
	If dbSeek( cFil + cCusto )
		nPercFPAS    := SI3->I3_PERFPAS / 100
	Endif
	
	If nPercFPAS > 0
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Deducao do percentual pago por convenios                    ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		nDed := 0
		For nPerc = 9 TO 19
			nDed += aInssEmp[nPerc,Val(cTpc)]
		Next nPerc
		
		nDed += aInssEmp[22,Val(cTpc)]
		nDed += aInssEmp[23,Val(cTpc)]
		nDed += fP15Terc(cCusto,aGPSPer,"*") //Deduzir o % de terceiros do parametro 15
		
		nPercFPAS -= nDed
	Endif
	
Endif
//-- Montar a Base Total de Inss
If cTipo == "1"
	aEval(aFilB,{ |x| nValBas += If ( X[1]$ cContribuicao ,x[3],0.00) })
Else
	aEval(aCcB,{ |x| nValBas += If ( X[1]$ cContribuicao ,x[3],0.00) })
EndIf
//--Inss s/Prolabore e Autonomo
If aCodfol[221,1] # Space(3)
	If cTipo == "1"
		aEval(aFilB,{ |x| nValPro += If ( X[1]$ aCodFol[221,1] ,x[3],0.00) })
	else
		aEval(aCcB,{ |x| nValPro += If ( X[1]$ aCodFol[221,1] ,x[3],0.00) })
	EndIf
	nPercPro := PosSrv( aCodFol[221,1],cFilAnterior,"RV_PERC",,.F.) / 100
	If nPercPro = 1.00 .Or. (nPercPro = 0.00 .And. aInssemp[1,Val(cTpc)] > 0.00)
		nPercPro := 0.20
	Endif
	nValPro := Round(nValPro * nPercPro,2)
Endif
If aCodFol[225,1] # Space(3)
	If cTipo == "1"
		aEval(aFilB,{ |x| nValAut += If ( X[1]$ aCodfol[225,1] ,x[3],0.00) })
	else
		aEval(aCcB,{ |x| nValAut += If ( X[1]$ aCodfol[225,1] ,x[3],0.00) })
	EndIf	
	nPercAut	 := PosSrv( aCodFol[225,1],cFilAnterior,"RV_PERC",,.F.) / 100
	If nPercAut = 1.00 .Or. (nPercAut = 0.00 .And. aInssemp[1,Val(cTpc)] > 0.00)
		nPercAut := 0.20
	Endif
	nValAut := Round(nValAut * nPercAut,2)
Endif
//--Gravar Inss Empresa Sobre Pro-Labore/Autonomo
If nValAut+nValPro > 0
	fSomaInss(cTipo,aCodFol[148,1],nValAut+nValPro )  // Inss Emp.
Endif

//-- Montar Base de Calculo do Pis Empresa
If aCodFol[229,1] # Space(3)
	aEval(aCcP,{ |x| nBasePis += If ( PosSrv(X[1],cFilAnterior,"RV_PIS",,.F.)=="S",x[3],0.00) })
	aEval(aCcB,{ |x| nBasePis += If ( PosSrv(X[1],cFilAnterior,"RV_PIS",,.F.)=="S" .and. PosSrv(X[1],cFilAnterior,"RV_TIPOCOD",,.F.)=="3",x[3],0.00) } )
	aEval(aCcD,{ |x| nBasePis -= If ( PosSrv(X[1],cFilAnterior,"RV_PIS",,.F.)=="S",x[3],0.00) })
	If nBasePis > 0
		nPercPis  := PosSrv( aCodFol[229,1],cFilAnterior,"RV_PERC",,.F.) / 100
		nValPis   := nBasePis * nPercPis
	Endif
	//--Gerar Base e Valor Pis Empresa
	If nValPis > 0
		fSomaInss(cTipo,aCodFol[223,1],nBasePis)
		If aCodFol[229,1] # Space(3)
			fSomaInss(cTipo,aCodFol[229,1],nValPis)
		Endif
	Endif
Endif

//-- Calcular Inss Empresa
If nValBas > 0.00
	fSomaInss(cTipo,aCodFol[148,1],Round(nValBas * aInssemp[1,Val(cTpc)],2) )  // Inss Emp.
	fSomaInss(cTipo,aCodFol[149,1],Round(nValBas * If (nPercFPAS > 0, nPercFPAS ,aInssemp[2,Val(cTpc)]),2)  )  // Terceiros
	//	fSomaInss(cTipo,aCodFol[150,1],Round(nValBas * If (lCct,aInssEmp[21,Val(cTpc)],aInssEmp[3,Val(cTpc)]),2) )  // Ac.Trab.
	fSomaInss(cTipo,aCodFol[204,1],Round(nValBas * (aInssemp[09,Val(cTpc)]+fP15Terc(cCusto,aGPSPer,aCodFol[204,1])),2)  ) // Sal.Educ.
	fSomaInss(cTipo,aCodFol[184,1],Round(nValBas * (aInssemp[10,Val(cTpc)]+fP15Terc(cCusto,aGPSPer,aCodFol[184,1])),2) )  // Incra
	fSomaInss(cTipo,aCodFol[185,1],Round(nValBas * (aInssemp[11,Val(cTpc)]+fP15Terc(cCusto,aGPSPer,aCodFol[185,1])),2) )  // Senai
	fSomaInss(cTipo,aCodFol[186,1],Round(nValBas * (aInssemp[12,Val(cTpc)]+fP15Terc(cCusto,aGPSPer,aCodFol[186,1])),2) )  // Sesi
	fSomaInss(cTipo,aCodFol[187,1],Round(nValBas * (aInssemp[13,Val(cTpc)]+fP15Terc(cCusto,aGPSPer,aCodFol[187,1])),2) )  // Senac
	fSomaInss(cTipo,aCodFol[188,1],Round(nValBas * (aInssemp[14,Val(cTpc)]+fP15Terc(cCusto,aGPSPer,aCodFol[188,1])),2) )  // Sesc
	fSomaInss(cTipo,aCodFol[189,1],Round(nValBas * (aInssemp[15,Val(cTpc)]+fP15Terc(cCusto,aGPSPer,aCodFol[189,1])),2) )  // Sebrae
	fSomaInss(cTipo,aCodFol[190,1],Round(nValBas * (aInssemp[16,Val(cTpc)]+fP15Terc(cCusto,aGPSPer,aCodFol[190,1])),2) )  // Dpc
	fSomaInss(cTipo,aCodFol[191,1],Round(nValBas * (aInssemp[17,Val(cTpc)]+fP15Terc(cCusto,aGPSPer,aCodFol[191,1])),2) )  // Faer
	fSomaInss(cTipo,aCodFol[192,1],Round(nValBas * (aInssemp[18,Val(cTpc)]+fP15Terc(cCusto,aGPSPer,aCodFol[192,1])),2) )  // Senab
	fSomaInss(cTipo,aCodFol[193,1],Round(nValBas * (aInssemp[19,Val(cTpc)]+fP15Terc(cCusto,aGPSPer,aCodFol[193,1])),2) )  // Seconc
	fSomaInss(cTipo,aCodFol[200,1],Round(nValBas * (aInssemp[22,Val(cTpc)]+fP15Terc(cCusto,aGPSPer,aCodFol[200,1])),2) )  // Sest
	fSomaInss(cTipo,aCodFol[201,1],Round(nValBas * (aInssemp[23,Val(cTpc)]+fP15Terc(cCusto,aGPSPer,aCodFol[201,1])),2) )  // Senat
	fSomaInss(cTipo,aCodFol[782,1],Round(nValBas * (aInssemp[26,Val(cTpc)]+fP15Terc(cCusto,aGPSPer,aCodFol[782,1])),2) )  // Sescoop
Endif

// Montar Base Para Provisao Simplificada Ferias /  13o / Rescisao
aEval(aCcP,{ |x| nValCus += If ( PosSrv( x[1],cFilAnterior,"RV_CUSTO",,.F.)='S',x[3],0.00) })
aEval(aCcD,{ |x| nValCus -= If ( PosSrv( x[1],cFilAnterior,"RV_CUSTO",,.F.)='S',x[3],0.00) })
aEval(aCcB,{ |x| nValCus += If ( PosSrv( x[1],cFilAnterior,"RV_CUSTO",,.F.)='S',x[3],0.00) })

// Calcular Provisao Simplificada
If nValCus > 0.00
	fSomaInss(cTipo,aCodFol[194,1],nValCus * aInssemp[6,Val(cTpc)] )  // Prov. Ferias
	fSomaInss(cTipo,aCodFol[195,1],nValCus * aInssemp[5,Val(cTpc)] )  // Prov. 13o.
	fSomaInss(cTipo,aCodFol[196,1],nValCus * aInssemp[20,Val(cTpc)] )  // Prov. Rescisao
Endif
Return

*-----------------------------------------*
Static Function fSomaInss(cTipo,cCod,nVal2)
*-----------------------------------------*
If cCod # Space(3) .And. nVal2 # 0
	If cTipo = "2"
		// Array Centro de Custo
		nRet := aScan( aCcB,{|X| x[1] == cCod } )   // Testa se ja existe
		If nRet == 0
			Aadd(aCcB,{cCod,0.00,nVal2,0.00,1,"",""})      // se nao cria elemento
		Else
			aCcB[nRet,3] += nVal2
			aCcB[nRet,5] ++
		Endif
	Endif
	If cTipo = "2" .Or. cTipo = "1"
		//-- Array Filial
		nRet := aScan( aFilB,{|X| x[1] == cCod } )   // Testa se ja existe
		If nRet == 0
			Aadd(aFilB,{cCod,0.00,nVal2,0.00,1,"",""})      // se nao cria elemento
		Else
			aFilB[nRet,3] += nVal2
			aFilB[nRet,5] ++
		Endif
		//-- Array Empresa
		nRet := aScan( aEmpB,{|X| x[1] == cCod } )   // Testa se ja existe
		If nRet == 0
			Aadd(aEmpB,{cCod,0.00,nVal2,0.00,1,"",""})      // se nao cria elemento
		Else
			aEmpB[nRet,3] += nVal2
			aEmpB[nRet,5] ++
		Endif
	Endif
Endif
Return

*--------------------------------------*
STATIC Function fSomaNiv(aMatriz,cVerba,nHorCc,nValCc,nParCc,nQtdCc)
*--------------------------------------*
// 1- Matriz onde os dados estao sendo armazenados
// 2- elemrnto a ser somado

Local nRet
nRet := Ascan( aMatriz,{|X| x[1] == cVerba } )   // Testa se ja existe
If	nRet == 0
	Aadd (aMatriz,{cVerba,nHorCc,nValCc,nParCc,nQtdCc})  // se nao cria elemento
Else
	aMatriz[nRet,2] += nHorCc                   // se ja so adiciona
	aMatriz[nRet,3] += nValCc
	aMatriz[nRet,4] += nParCc
	aMatriz[nRet,5] += nQtdCc
Endif
Return Nil

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Funcao para Escolher o Arquivo Mensal                        ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
*--------------------------------*
STATIC Function fArquivoRC()
*--------------------------------*
Local MvRet,ni
Local nOpcao := 0, nOk := 2
Local oDlg, oWnd, oListbox
Local cVarq
Local nPosLis := 1
nLin1   := .5
nCol1   := 2
cFiltro := "RC*" + GetDBExtension()          //Filtro na procura do arquivo no Windows
cPesq   := "SRC"              //Arquivo de pesquisa no SX2
cPath   := ""
#IFDEF TOP
	Private aTables := {}
	Private oOk   := LoadBitmap( GetResources(), "LBOK" )  //Botao OK
	Private oNo   := LoadBitmap( GetResources(), "LBNO" )  //Botao CANCEL
#ELSE
	cAlias := Alias()
	dbSelectArea( "SX2" )
	dbSeek(cPesq)
	cPath := TRIM(Sx2->X2_PATH)
#ENDIF

MvRet:=Alltrim(ReadVar())      // Carrega Nome da Variavel do Get em Questao

#IFDEF TOP
	USE TOP_FILES ALIAS "TOP" VIA "TOPCONN" SHARED NEW
	nTables := 0
	While !Eof()
		If SubS(FNAMF1,1,4) # "TOP_" .AND. SubS(FNAMF1,1,2) == "RC"
			nTables++
			If nTables < 4096
				AADD(aTables,FNAMF1)
			Else
				Alert("Too many tables.","Attention")
				Exit
			Endif
		Endif
		dbSkip()
	EndDo
	dbCloseArea()
	ASORT(aTables,,, { |x, y| x > y })
	If Len(aTables) # 0
		DEFINE MSDIALOG oDlg FROM 5, 5 TO 16, 39 TITLE STR0065
		@ nLin1,nCol1 LISTBOX oListBox VAR cVarQ Fields HEADER STR0064 SIZE 102,60 ;
		ON DBLCLICK (nOk := 1,oDlg:End()) ENABLE OF oDlg
		oListBox:SetArray(aTables)
		oListBox:bLine := { ||{aTables[oListBox:nAt]}}
		DEFINE SBUTTON FROM 068,62 TYPE 1 ACTION (nOk := 1,nPosLis:=oListBox:nAt,oDlg:End()) ENABLE OF oDlg
		DEFINE SBUTTON FROM 068,90 TYPE 2 ACTION oDlg:End() ENABLE OF oDlg
		ACTIVATE MSDIALOG oDlg CENTERED
		If nOk == 1
			&MvRet := aTables[nPosLis]
		Else
			&MvRet := SPACE(30)  // Devolve Resultados
		EndIf
		DeleteObject(oOk)
		DeleteObject(oNo)
	Else
		Help(" " , 1 , "GPSARQM" )
		&MvRet := SPACE(30)  // Devolve Resultado
		Return .T.
	EndIf
#ELSE
	If cFiltro == Nil
		oWnd := GetWndDefault()
	Endif
	cFile := cGetFile(cFiltro,OemToAnsi(STR0065) ) //"Selecione o Arquivo"
	If Empty(cFile)
		Return(.F.)
	Elseif Len(Alltrim(cFile)) > 30
		Help(" " , 1 , "GP140TAMAN" )
	Endif
	&MvRet := cFile+SPACE(30-LEN(cFile))
	If oWnd != Nil
		GetdRefresh()
	Endif
#ENDIF

Return .T.

**************************************
Static Function fCalcAci(aFunB,aFunP,cFil)
**************************************
Local nBasAci  := 0
Local nValAci  := 0
Local lPercSRA := .F.

//-- Calculo do % Acid. de Trabalho Por Funcionario / C.Custo ou Filial
nPercAci := aInssEmp[3,Val(cTpc)]  //-- Ac.Trab.
If Type("SRA->RA_PERCSAT") # "U" .And. IF(IfDefTop(), ( cAliasQSRA )->RA_PERCSAT > 0, SRA->RA_PERCSAT > 0)
	nPercAci := IF(IfDefTop(), ( cAliasQSRA )->RA_PERCSAT / 100, SRA->RA_PERCSAT / 100)
	lPercSRA := .T.
Else
	//-- Verifica o % de Acidente do C.Custo
	dbSelectArea("SI3")
	If ( cFil # Nil .And. cFilial == "  " ) .Or. cFil == Nil
		cFil := cFilial
	Endif
	If dbSeek( cFil + cCCto ) .And. SI3->I3_PercAci > 0
		nPercAci := SI3->I3_PercAci / 100
	Endif
Endif

//--Montar a Base Total de Inss
If (IF(ifDefTop(), ( cAliasQSRA )->RA_CATFUNC $ "P*A" , SRA->RA_CATFUNC $ "P*A" )) .And. lPercSRA
	aEval(aFunP,{ |x| nBasAci += If ( X[1]$ cContrProAuto ,x[3],0.00) })
Else
	aEval(aFunB,{ |x| nBasAci += If ( X[1]$ cContribuicao ,x[3],0.00) })
EndIf
nValAci := Round(nBasAci * nPercAci,2)

If nValAci # 0
	fSoma(@aFunB,"C",aCodFol[150,1],nValAci)
	fSoma(@aCcB ,"C",aCodFol[150,1],nValAci)
	fSoma(@aFilB,"C",aCodFol[150,1],nValAci)
	fSoma(@aEmpB,"C",aCodFol[150,1],nValAci)
Endif
Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³fBuscaSlr ³ Autor ³ R.H. - Marina         ³ Data ³ 14.01.00 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Verifica se houve aumento salarial em Movimentos Anteriores³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ fBuscaSlr(Filial,Matricula,Data)                           ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
STATIC Function fBuscaSlr(nValSal,cAnoMesRef)
Local cAlias := Alias()

dbSelectArea("SR3")
If dbSeek(SRA->RA_FILIAL + SRA->RA_MAT)
	While !Eof() .And. SR3->R3_FILIAL+SR3->R3_MAT == SRA->RA_FILIAL+SRA->RA_MAT .And.;
		MesAno(SR3->R3_DATA) <= cAnoMesRef
		nValSal := SR3->R3_VALOR
		dbSkip()
	Enddo
EndIf
dbSelectArea(cAlias)
Return Nil

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³fImpGerFol³ Autor ³ R.H.                  ³ Data ³ 14.01.00 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Imprime a folha ou gera o arquivo SRZ.                     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ 	fImpGerFol(lEnd,cAnoMesRef,cArqSRC)                       ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
STATIC Function fImpGerFol(lEnd,cAnoMesRef,cArqSRC)
Local lInssFun    := .F.
Local aFunP       := {}
Local aFunD   	  := {}
Local aFunB   	  := {}
Local aCodBenef   := {}
Local cBuscaSRA   := ""
Local cBuscaSRI   := ""
Local cAcessaSRA  := &("{ || " + ChkRH("GPER040","SRA","2") + "}")
Local cAcessaSRC  := &("{ || " + ChkRH("GPER040","SRC","2") + "}")
Local cAcessaSRI  := &("{ || " + ChkRH("GPER040","SRI","2") + "}")
Local cTipAfas    := " "
Local dDtAfas
Local dDtRet
Local dDtPesqAf
Local lCotFun	  := .F.
Local nX		  := 0 
Local cOrdem	  := ""
Local cDel		  := ""
Local cRecno	  := ""
Local cTpcQry	  := cTpcQry1 := ""  
Local dDtaLimite, dtIni, cUltDiaMes
Private cRelMat	  := ""
Private cFil	  := "" 
Private cRelCC	  := ""
Private cAliasQSRC := "SRC" 
Private cAliasQSRV := "SRV"
Private cAliasQSRA := "SRA"
Private cAliasQSRI := "SRI" 

Private lExInAs400

lExInAs400 := ExeInAs400() 
If TcSrvType() == "AS/400"
	cRecno	:=  "RRN("+cRetSqlName+")"
	cDel	:=  "@DELETED@  = ' '"
Else
	cRecno	:= "R_E_C_N_O_" 
	cDel	:= "D_E_L_E_T_ = ' '"
EndIf

cUltDiaMes := f_UltDia(CTOD("01/"+Right(cAnoMesRef,2)+"/"+Left(cAnoMesRef,4) , "DDMMYY" )) 
dDtaLimite := CToD(StrZero(cUltDiaMes,2)+"/"+Right(cAnoMesRef,2)+"/"+Left(cAnoMesRef,4) , "DDMMYY" )
dtIni	   := CTOD("01/"+Right(cAnoMesRef,2)+"/"+Left(cAnoMesRef,4) , "DDMMYY" )

For nx := 1 to Len(cTPC1)
	If substr(cTPC1,nx,1) <> "*"
		If nx > 1
			cTpcQry	  += " OR "
		Endif
		cTpcQry	  += " SRA.RA_TPCONTR = '" + substr(cTPC1,nx,1) +"'"         
	Endif
Next nx
cTpcQry1 :=  "%"+cTpcQry+"%"

lQuery    := .F. 
lRelQuery := .F.

Private aGPSVal := {}
Private aGPSPer := {} // Carrega os percentuais de terceiros do parametro 15

dbSelectArea( "SRA" )
dbGoTop()

If nOrdem == 1
	dbSetOrder( 2 )
	dbSeek(cFilDe + cCcDe + cMatDe,.T.)
	cInicio  := "SRA->RA_FILIAL + SRA->RA_CC + SRA->RA_MAT"
	cFim     := cFilAte + cCcAte + cMatAte
   	cOrdem	 := "1,2,3"
ElseIf nOrdem == 2
	dbSetOrder( 1 )
	dbSeek(cFilDe + cMatDe,.T.)
	cInicio  := "RA_FILIAL + RA_MAT"
	cFim     := cFilAte + cMatAte
   	cOrdem	 := "1,3"
ElseIf nOrdem == 3
	dbSetOrder( 3 )
	dbSeek(cFilDe + cNomDe + cMatDe,.T.)
	cInicio  := "RA_FILIAL + RA_NOME + RA_MAT"
	cFim     := cFilAte + cNomAte + cMatAte
	cOrdem	 := "1,4,3" 
ElseIf nOrdem == 4
	If nRelat == 4 .or. If(cPaisLoc $ "URU|ARG|PAR",nRelat==3,.F.)
		dbSelectarea("SRI")
		dbSetOrder(2)
		dbSeek(cFilDe + cCcDe + cMatDe,.T.)
		cInicio := "RI_FILIAL + RI_CC+ RI_MAT"
		cFim    := cFilAte + cCcAte + cMatAte
	   	cOrdem	 := "1,2,3"
	 Else
		dbSelectArea("SRC")
		dbSetOrder( 2 )
		dbSeek(cFilDe + cCcDe + cMatDe,.T.)
		cInicio  := "RC_FILIAL + RC_CC + RC_MAT"
		cFim     := cFilAte + cCcAte + cMatAte
	   	cOrdem	 := "1,2,3"   
	   	#IFNDEF TOP 
	   		cAliasQSRA := "SRC" 
	   	#ENDIF
	EndIf

ElseIf nOrdem == 5
	dbSetOrder( 8 )
	dbSeek(cFilDe + cCcDe + cNomDe,.T.)
	cInicio  := "RA_FILIAL + RA_CC + RA_NOME"
	cFim     := cFilAte + cCcAte + cNomAte
   	cOrdem	 := "1,2,4" 
ElseIf nOrdem == 6
	If nRelat == 4 .or. If(cPaisLoc $ "URU|ARG|PAR",nRelat==3,.F.)
		dbSelectarea("SRI")
		dbOrderNickName("SRIITCL1  ")
		dbSeek(cFilDe + cCcDe + Space( TamSX3('RI_ITEM')[1] ) + Space( TamSX3('RI_CLVL')[1] ) + cMatDe,.T.)
		cInicio := "RI_FILIAL + RI_CC + RI_ITEM + RI_CLVL + RI_MAT"
		cFim    := cFilAte + cCcAte + Replicate('Z', TamSX3('RI_ITEM')[1] ) + Replicate('Z', TamSX3('RI_CLVL')[1] )  + cMatAte
	  	cOrdem	 := "1,2,18,19,3"  
	Else
		dbSelectArea("SRC")
		dbOrderNickName("SRCITCL1  ")
		dbSeek(cFilDe + cCcDe + Space( TamSX3('RC_ITEM')[1] ) + Space( TamSX3('RC_CLVL')[1] ) + cMatDe, .T.)
		cInicio  := "RC_FILIAL + RC_CC + RC_ITEM + RC_CLVL + RC_MAT"
		cFim     := cFilAte + cCcAte + Replicate('Z', TamSX3('RC_ITEM')[1] ) + Replicate('Z', TamSX3('RC_CLVL')[1] ) + cMatAte
		cOrdem	 := "1,2,18,19,3"  
	EndIf

Endif

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Carrega Regua Processamento	                                 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
#IFDEF TOP                  
	cAliasTMP := "QNRO"
	BeginSql alias cAliasTMP
		SELECT COUNT(*) as NROREG
		FROM %table:SRA% SRA
		WHERE      SRA.RA_FILIAL BETWEEN %exp:cFilDe% AND %exp:cFilAte% 
			   AND SRA.RA_MAT    BETWEEN %exp:cMatDe% AND %exp:cMatAte%
			   AND SRA.RA_CC     BETWEEN %exp:cCCDe%  AND %exp:cCCAte% 
			   AND SRA.%notDel%
	EndSql                
		
	nRegProc := (cAliasTMP)->(NROREG)
	( cAliasTMP )->( dbCloseArea() )	
	If lGeraSRZ
		ProcRegua(nRegProc)
	Else 
		SetRegua(nRegProc)
	Endif	
#ELSE
	dbSelectArea( "SRA" ) 
	dbGoTop()
	If lGeraSRZ
		ProcRegua(SRA->(RecCount()))
	Else
		SetRegua(SRA->(RecCount()))
	EndIf
#ENDIF 

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Cria consulta para gerar o relatorio da Folha                ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

#IFDEF TOP
		cAliasQSRA := GetNextAlias() 
		aStruSRA  := SRA->(dbStruct())  
		lQuery := .T. 
		
		If nOrdem # 4 .AND. nOrdem # 6  
	    	cQuery := " SELECT RA_FILIAL, RA_CC,RA_MAT,RA_NOME, RA_ADMISSA, RA_CATFUNC, RA_SALARIO, RA_DEPIR, "  
	       	cQuery += " RA_DEPSF, RA_PERCADT, RA_HRSMES, RA_DEMISSA,RA_TPCONTR, "
	       	
	       	cQuery += If(Type("SRA->RA_NOMECOM") # "U" ,"RA_NOMECOM,","' ' AS RA_NOMECOM,")+ " RA_CODFUNC " 
	       	If lTemItemRA .AND. lTemClVlRA
				cQuery += ",RA_ITEM, RA_CLVL "
			Endif
			cQuery += ",RA_PERCSAT "
	    	cQuery += " FROM " + RetSqlName("SRA") + " SRA "
	        cQuery += " WHERE SRA.RA_FILIAL BETWEEN '" + cFilDe + "' AND '" + cFilAte + "' AND "
	        cQuery += "       SRA.RA_MAT    BETWEEN '" + cMatDe + "' AND '" + cMatAte + "' AND "
	        cQuery += "       SRA.RA_CC     BETWEEN '" + cCcDe  + "' AND '" + cCcAte + "' AND " 
			If nRelat == 4 .or. If(cPaisLoc $ "URU|ARG|PAR",nRelat==3,.F.)
				cQuery += "       EXISTS( SELECT RI_MAT FROM " + cArqSRC + " SRI " 
	    	    cQuery += "               WHERE SRI.RI_FILIAL = SRA.RA_FILIAL AND " 
	        	cQuery += "                     SRI.RI_MAT = SRA.RA_MAT AND SRI." + cDel + " ) AND "
	   		else
				cQuery += "       EXISTS( SELECT RC_MAT FROM " + cArqSRC + " SRC " 
	    	    cQuery += "               WHERE SRC.RC_FILIAL = SRA.RA_FILIAL AND "
	        	cQuery += "                     SRC.RC_MAT = SRA.RA_MAT AND SRC." + cDel + " ) AND "
	   		Endif
	        cQuery += "SRA." + cDel
	         
	        cQuery += "UNION "
	        
	        cQuery += "SELECT RA_FILIAL, RA_CC,RA_MAT,RA_NOME, RA_ADMISSA, RA_CATFUNC, RA_SALARIO, RA_DEPIR, "  
	       	cQuery += "RA_DEPSF, RA_PERCADT, RA_HRSMES, RA_DEMISSA,RA_TPCONTR, "
	       	cQuery += If(Type("SRA->RA_NOMECOM") # "U" ,"RA_NOMECOM,","' ' AS RA_NOMECOM,")+ " RA_CODFUNC " 
	       	If lTemItemRA .AND. lTemClVlRA
				cQuery += ",RA_ITEM, RA_CLVL "
			Endif
			cQuery += ",RA_PERCSAT "
	   		cQuery += "FROM " +  RetSqlName("SR8") + " SR8, " + RetSqlName("SRA") + " SRA "
			cQuery += "WHERE SR8.R8_FILIAL = SRA.RA_FILIAL AND " 
			cQuery += "SR8.R8_MAT = SRA.RA_MAT AND " 
		    cQuery += "SRA.RA_FILIAL BETWEEN '" + cFilDe + "' AND '" + cFilAte + "' AND "
	        cQuery += "SRA.RA_MAT    BETWEEN '" + cMatDe + "' AND '" + cMatAte + "' AND "
	        cQuery += "SRA.RA_CC     BETWEEN '" + cCcDe  + "' AND '" + cCcAte + "' AND " 
	   		cQuery += "(R8_DATAINI <= '" + DtoS(dDtaLimite) + "' AND (R8_DATAFIM >= '" + DtoS(dtIni) + "' OR R8_DATAFIM = '" + Space(Len(DtoS(SR8->R8_DATAINI))) + "') ) AND " 
			cQuery += "SR8." + cDel + " AND "
			cQuery += "SRA." + cDel 
			cQuery += " AND ( " + cTpcQry + " ) "
			cQuery += "ORDER BY " + cOrdem
	    Else
	      	If nRelat # 4 .or. If(cPaisLoc $ "URU|ARG|PAR",nRelat==3,.F.) 
		      	cQuery := " SELECT DISTINCT "  
		       	cQuery += "RC_FILIAL, RC_CC,RC_MAT, RA_NOME, RA_ADMISSA, RA_CATFUNC, RA_SALARIO, RA_DEPIR,  "   	       	
		       	cQuery += "RA_DEPSF, RA_PERCADT, RA_HRSMES,RA_DEMISSA, RA_TPCONTR,' ' AS RA_NOMECOM, RA_CODFUNC,RC_SEMANA,RC_SEQ "
		       	If lTemItemRC .AND. lTemClVlRC
					cQuery += ",RC_ITEM, RC_CLVL "
				Endif
				cQuery += ",RA_PERCSAT "
		       	cQuery += "FROM " + cArqSRC + " SRC, " + RetSqlName("SRA") + " SRA "
		        cQuery += "WHERE SRC.RC_FILIAL = SRA.RA_FILIAL AND SRC.RC_MAT = SRA.RA_MAT AND "
		        cQuery += "SRC.RC_FILIAL BETWEEN '" + cFilDe + "' AND '" + cFilAte + "' AND "
		        cQuery += "SRC.RC_MAT    BETWEEN '" + cMatDe + "' AND '" + cMatAte + "' AND "
		        cQuery += "SRC.RC_CC     BETWEEN '" + cCcDe  + "' AND '" + cCcAte + "' AND " 
				cQuery += "SRC." + cDel + " AND "
				cQuery += "SRA." + cDel + " AND "
			
				cQuery += "EXISTS(	SELECT RC_MAT " 
				cQuery += "FROM " +  cArqSRC + " SRC, " + RetSqlName("SRV") + " SRV, " + RetSqlName("SI3") + " SI3 " 
				cQuery += "WHERE SRC.RC_FILIAL = SRA.RA_FILIAL AND "
				cQuery += "SRC.RC_MAT = SRA.RA_MAT AND "
				cQuery += "SRC.RC_PD = SRV.RV_COD AND "
				cQuery += "SRC.RC_CC = SI3.I3_CUSTO AND "
				If Empty(xFilial("SRV"))
					cQuery += "SRV.RV_FILIAL = '' AND "
					cQuery += "SI3.I3_FILIAL = '' AND "
				Else
					cQuery	+=	" SRC.RC_FILIAL = SRV.RV_FILIAL AND "
					cQuery	+=	" SI3.I3_FILIAL  = SRV.RV_FILIAL AND "
				EndIf
				cQuery += "SRC." + cDel + " AND "
				cQuery += "SRV." + cDel + " AND "
				cQuery += "SI3." + cDel + " ) AND "  
			   	cQuery += "( " + cTpcQry + " ) "
			   	cQuery += "UNION "
	            
	        //Query para buscar os afastados sem movimento para contagem de funcionarios
		        cQuery += "SELECT RA_FILIAL AS RC_FILIAL, RA_CC AS RC_CC,RA_MAT AS RC_MAT,RA_NOME, RA_ADMISSA, RA_CATFUNC, RA_SALARIO, RA_DEPIR, "  
		       	cQuery += "RA_DEPSF, RA_PERCADT, RA_HRSMES, RA_DEMISSA,RA_TPCONTR, "
		       	cQuery += If(Type("SRA->RA_NOMECOM") # "U" ,"RA_NOMECOM,","' ' AS RA_NOMECOM,")+ " RA_CODFUNC, ' ' AS RC_SEMANA,' ' AS RC_SEQ " 
		       	If lTemItemRA .AND. lTemClVlRA
					cQuery += ",RA_ITEM AS RC_ITEM, RA_CLVL AS RC_CLVL "
				Endif
				cQuery += ",RA_PERCSAT "
		   		cQuery += "FROM " +  RetSqlName("SR8") + " SR8, " + RetSqlName("SRA") + " SRA "
				cQuery += "WHERE SR8.R8_FILIAL = SRA.RA_FILIAL AND " 
				cQuery += "SR8.R8_MAT = SRA.RA_MAT AND " 
			    cQuery += "SRA.RA_FILIAL BETWEEN '" + cFilDe + "' AND '" + cFilAte + "' AND "
		        cQuery += "SRA.RA_MAT    BETWEEN '" + cMatDe + "' AND '" + cMatAte + "' AND "
		        cQuery += "SRA.RA_CC     BETWEEN '" + cCcDe  + "' AND '" + cCcAte + "' AND " 
		   		cQuery += "(R8_DATAINI <= '" + DtoS(dDtaLimite) + "' AND (R8_DATAFIM >= '" + DtoS(dtIni) + "' OR R8_DATAFIM = '" + Space(Len(DtoS(SR8->R8_DATAINI))) + "') ) AND " 
				cQuery += "SR8." + cDel + " AND "
				cQuery += "SRA." + cDel 
				cQuery += " AND ( " + cTpcQry + " ) "  
		        cQuery += "ORDER BY " + cOrdem
			   	
			  
		     Else
		     	cQuery := "SELECT DISTINCT "  
		       	cQuery += "RI_FILIAL, RI_CC,RI_MAT, RA_NOME, RA_ADMISSA, RA_CATFUNC, RA_SALARIO, RA_DEPIR,  "   	       	
		       	cQuery += "RA_DEPSF, RA_PERCADT, RA_HRSMES,RA_DEMISSA, RA_TPCONTR,' ' AS RA_NOMECOM, RA_CODFUNC "
		       	If lTemItemRI .AND. lTemClVlRI
					cQuery += ",RI_ITEM, RI_CLVL "
				Endif
				cQuery += ",RA_PERCSAT "
		       	cQuery += "FROM " + cArqSRC + " SRI, " + RetSqlName("SRA") + " SRA "
		        cQuery += "WHERE SRI.RI_FILIAL = SRA.RA_FILIAL AND SRI.RI_MAT = SRA.RA_MAT AND "
		        cQuery += "SRI.RI_FILIAL BETWEEN '" + cFilDe + "' AND '" + cFilAte + "' AND "
		        cQuery += "SRI.RI_MAT    BETWEEN '" + cMatDe + "' AND '" + cMatAte + "' AND "
		        cQuery += "SRI.RI_CC     BETWEEN '" + cCcDe  + "' AND '" + cCcAte + "' AND " 
				cQuery += "SRI." + cDel + " AND "
				cQuery += "SRA." + cDel
			   	cQuery += " AND ( " + cTpcQry + " ) "
		        
		        cQuery += "UNION "
	        
		        cQuery += "SELECT RA_FILIAL AS RI_FILIAL, RA_CC AS RI_CC,RA_MAT AS RI_MAT,RA_NOME, RA_ADMISSA, RA_CATFUNC, RA_SALARIO, RA_DEPIR, "  
		       	cQuery += "RA_DEPSF, RA_PERCADT, RA_HRSMES, RA_DEMISSA,RA_TPCONTR, "
		       	cQuery += If(Type("SRA->RA_NOMECOM") # "U" ,"RA_NOMECOM,","' ' AS RA_NOMECOM,")+ " RA_CODFUNC " 
		       	If lTemItemRA .AND. lTemClVlRA
					cQuery += ",RA_ITEM AS RI_ITEM, RA_CLVL AS RI_CLVL "
				Endif
				cQuery += ",RA_PERCSAT "
		   		cQuery += "FROM " +  RetSqlName("SR8") + " SR8, " + RetSqlName("SRA") + " SRA "
				cQuery += "WHERE SR8.R8_FILIAL = SRA.RA_FILIAL AND " 
				cQuery += "SR8.R8_MAT = SRA.RA_MAT AND " 
			    cQuery += "SRA.RA_FILIAL BETWEEN '" + cFilDe + "' AND '" + cFilAte + "' AND "
		        cQuery += "SRA.RA_MAT    BETWEEN '" + cMatDe + "' AND '" + cMatAte + "' AND "
		        cQuery += "SRA.RA_CC     BETWEEN '" + cCcDe  + "' AND '" + cCcAte + "' AND " 
		   		cQuery += "(R8_DATAINI <= '" + DtoS(dDtaLimite) + "' AND (R8_DATAFIM >= '" + DtoS(dtIni) + "' OR R8_DATAFIM = '" + Space(Len(DtoS(SR8->R8_DATAINI))) + "') ) AND " 
				cQuery += "SR8." + cDel + " AND "
				cQuery += "SRA." + cDel
				cQuery += " AND ( " + cTpcQry + " ) "  
		        cQuery += "ORDER BY " + cOrdem
		     Endif
	    Endif 
    			cQuery := ChangeQuery(cQuery)

        dbUseArea(.T., "TOPCONN", TCGenQry(,,cQuery), cAliasQSRA, .F., .T.)
        For nX := 1 To Len(aStruSRA)
			If aStruSRA[nX][2]<>"C"
				TcSetField(cAliasQSRA,aStruSRA[nX][1],aStruSRA[nX][2],aStruSRA[nX][3],aStruSRA[nX][4])
			EndIf
		Next nX
   
#ENDIF
cFilAnterior := Space(02)
cCcAnt  	 := Space(09)

nEnor := nEafa := nEdem := nEfer := nEexc := nEtot := nEadm := 0  // Totalizadores Empresa
nFnor := nFafa := nFdem := nFfer := nFexc := nFtot := nFadm := 0  //               Filial
nCnor := nCafa := nCdem := nCfer := nCexc := nCtot := nCadm := 0			 //               Centro Custo
nCinss := nFinss := nEinss := 0      //-Totalizador dos func. con ret. Inss
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Estas variaveis nao devem, se declaradas, pois devem ser     ³
//³ declaradas na funcao chamadora.(pode ser externa).           ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
nFuncs 		:= 0
aFuncsBSE	:=	{}

While (cAliasQSRA)-> (!EOF()) .And. (cAliasQSRA)->(&cInicio) <= cFim 
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Movimenta Regua de Processamento                             ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If lGeraSRZ
		IncProc()
	Else
		IncRegua()
	EndIf
	
	If lEnd
		@Prow()+1,0 PSAY cCancel
		Exit
	Endif
	
	If nOrdem # 4  .AND. nOrdem # 6 
		cFil	:= ( cAliasQSRA )->RA_FILIAL
		cRelMat := ( cAliasQSRA )->RA_MAT 
		cRelCC  := ( cAliasQSRA )->RA_CC
	Else
		If nrelat # 4
			cFil	:= ( cAliasQSRA )->RC_FILIAL
			cRelMat := ( cAliasQSRA )->RC_MAT
			cRelCC  := ( cAliasQSRA )->RC_CC
		Else
			cFil	:= ( cAliasQSRA )->RI_FILIAL
			cRelMat := ( cAliasQSRA )->RI_MAT
			cRelCC  := ( cAliasQSRA )->RI_CC
		Endif
	Endif 
	If nOrdem == 4      // Encargos por C.Custo

		cItCt := " "
		cClVl := " "

		If nrelat ==4.or. If(cPaisLoc $ "URU|ARG|PAR",nRelat==3,.F.)
			cCcto :=  ( cAliasQSRA )->RI_CC
			If lTemItemRI .AND.lTemClVlRI
				cItCt := ( cAliasQSRA )->RI_ITEM
				cClVl := ( cAliasQSRA )->RI_CLVL
			Endif				
		else
			cCcto :=  cRelCC
			If lTemItemRC .AND.lTemClVlRC
				cItCt :=  ( cAliasQSRA )->RC_ITEM
				cClVl :=  ( cAliasQSRA )->RC_CLVL
			Endif	
		endif
		
		//-------------
	  //	If Eof()
		If  (cAliasQSRA)-> (EOF()) 
			cCcto := " "     
			dbSelectArea(cAliasQSRA)
			dbSkip()
			
			fTestaTotal()
			Loop
		Endif
		//-------------

	ElseIf nOrdem == 6      // Encargos por C.Custo + Item + Classe

		If nRelat == 4 .Or. If(cPaisLoc $ "URU|ARG|PAR",nRelat==3,.F.)
			dbSeek(SRI->RI_FILIAL + SRI->RI_MAT)
			cCcto :=  SRI->RI_CC
			cItCt :=  SRI->RI_ITEM
			cClVl :=  SRI->RI_CLVL
		else
			//dbSeek( SRC->RC_FILIAL + SRC->RC_MAT )
			cCcto :=  (cAliasQSRA )->RC_CC
			cItCt :=  (cAliasQSRA )->RC_ITEM
			cClVl :=  (cAliasQSRA )->RC_CLVL
		endif
		
		//-------------
   	 //	If Eof()  
   		If  (cAliasQSRA)-> (EOF()) 
			cCcto := " "     
			cItCt := " "
			cClVl := " "
			If nRelat == 4 .or. If(cPaisLoc $ "URU|ARG|PAR",nRelat==3,.F.)
				dbSelectArea("SRI")
			Else
				dbSelectArea("SRC")
			EndIf
			dbSelectArea(cAliasQSRA)
			dbSkip()
			
			fTestaTotal()
			Loop
		Endif
		//-------------

	Else
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Movimenta Regua de Processamento                             ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		#IFDEF TOP 
	    	SRA->( DbSetOrder( RetOrder( "SRA", "RA_FILIAL+RA_MAT" )) )
			SRA->( DbSeek( cFil+cRelMat,.F.) ) 
		#ENDIF
	  	cCcto :=  cRelCC
		cItCt :=  ' '
		cClVl :=  ' '

	Endif
	
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Verifica Quebra de Filial                                    ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If cFil # cFilAnterior  
		If cPaisloc == "BRA"
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Resgata Valores utilizados na GPS que estao armazenados no Parametro 15 ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ	
	        fGPSVal(cFil,If(nRelat == 4,Left(cAnoMesRef,4)+"13",cAnoMesRef),@aGPSVal,cTpC)
	
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Resgata os percentuais de terceiros armazenados no parametro 15			³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ	
			fGPSVal(cFil,"999999",@aGPSPer,cTpC)
		Endif
		aOldInfo := aClone( aInfo )
		If cFilAnterior # "  " //.And. ( nOrdem == 4 .or. nOrdem == 6 )
			fImpFil()    // Totaliza Filial
		Endif
		If !FP_CODFOL(@aCodFol,cFil) .Or. !fInfo(@aInfo,cFil)
			Exit
		Endif
		If cFilAnterior == "  " .Or. Empty( aOldInfo )
			aOldInfo := aClone( aInfo )
		EndIf
		If cFilAnterior # "  " .And. ( nOrdem # 4 .AND. nOrdem # 6 )
			fImpFil()    // Totaliza Filial
		Endif
		cFilAnterior := cFil
		
	  	If cPaisLoc == "BRA" .And. !fInssEmp(cFil,@aInssEmp)
			Exit
		Endif

		cContribuicao := aCodFol[013,1]+"x"+aCodFol[014,1]+"x"+aCodFol[19,1]+"x"+aCodFol[20,1]+"x"+aCodFol[338,1]+"x"+aCodFol[399,1]
		cContrProAuto := aCodFol[217,1]+"x"+aCodFol[218,1]+"x"+aCodFol[349,1]+"x"+aCodFol[352,1]

	Endif
	
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Consiste Parametrizacao do Intervalo de Impressao            ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	#IFNDEF TOP 
	 		dbSelectArea("SRA")
	 		If nOrdem == 1
				dbSetOrder(2)
		   		SRA->( DbSeek( cFil + cRelcc + cRelMat) )
		  	Elseif nOrdem == 2
		  		dbSetOrder(1)
		   		SRA->( DbSeek( cFil + cRelMat) )
		   	Elseif nOrdem ==3
		   		dbSetOrder(3)
		   	Elseif nOrdem == 4
		   		dbSetOrder(2)
		   		SRA->( DbSeek( cFil + cRelcc + cRelMat) )
		   	Elseif nOrdem == 5
		   		dbSetOrder( 8 )
		   	Elseif nOrdem == 6 
		   		If nRelat == 4 .or. If(cPaisLoc $ "URU|ARG|PAR",nRelat==3,.F.)
					dbSelectarea("SRI")
					dbOrderNickName("SRIITCL1  ")
				Else
		   			dbSelectArea("SRC")
					dbOrderNickName("SRCITCL1  ")
				Endif
			Endif
		   	
	   		
	#ENDIF
 
	   If  (if (ifDefTop() , ( (cAliasQSRA)->RA_NOME < cNomDe ) , SRA->RA_NOME < cNomDe )  .Or. If (ifDefTop (), ( (cAliasQSRA)->RA_NOME > cNomAte) , SRA->RA_NOME > cNomAte)) .Or. ;
		( cRelMat < cMatDe )   .Or. ( cRelMat > cMatAte )
		If nOrdem = 4 .or. nOrdem == 6  // Ordem do Arquivo Movimento "SRC".
			dbSelectArea(cAliasQSRA)
			dbSkip()
		Endif
		fTestaTotal()
		Loop
	Endif
	
	If (( nOrdem # 4 .AND. nOrdem # 6 ).And. ((cRelCC < cCcDe) .Or. (cRelCC > cCcAte))) .Or.;
		((nOrdem == 4 .OR. nOrdem == 6) .And. nRelat  # 4 .And. ((cRelCC < cCcDe) .Or. (cRelCC > cCcAte))).Or.;
		((nOrdem == 4 .OR. nOrdem == 6) .And. nRelat == 4 .And. (((cAliasQSRA) -> (RI_CC ) < cCcDe) .Or. ((cAliasQSRA)->( RI_CC ) > cCcAte)))	
		If nOrdem == 4 .or. nOrdem == 6  // Ordem do Arquivo Movto.
			dbSelectArea(cAliasQSRA)
			dbSkip()
		Endif
		fTestaTotal()
		Loop
	Endif
	
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Verifica o tipo de Afastamentono mes que esta sendo listado ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	cTipAfas := " "
	dDtAfas  := dDtRet := ctod("")
	dDtPesqAf:= CTOD("01/" + Right(cAnoMesRef,2) + "/" + Left(cAnoMesRef,4),"DDMMYY")
	fChkAfas(cFil,cRelMat,dDtPesqAf,@dDtAfas,@dDtRet,@cTipAfas)
	If cTipAfas $"HIJKLMNSU234" .Or.;
	   (!Empty( If (ifDefTop(), (cAliasQSRA)->RA_DEMISSA, SRA->RA_DEMISSA)) .And. MesAno( If (ifDefTop(), (cAliasQSRA)->RA_DEMISSA, SRA->RA_DEMISSA))<= MesAno(dDtPesqAf))	
		cTipAfas := "D"
	Elseif cTipAfas $"OPQRXYV8W1"
		cTipAfas := "A"
	ElseIf cTipAfas == "F"
		cTipAfas := "F"
	Else
		cTipAfas := " "
	EndIf
	If MesAno(dDtAfas) > MesAno(dDtPesqAf)
		cTipAfas := " "
	EndIf
	
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Verifica Situacao e Categoria do Funcionario                 ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

	If	!(cTipAfas $ cSit) .Or. !(If(ifDefTop(), (cAliasQSRA)->RA_CATFUNC $ cCat, SRA->RA_CATFUNC $ cCat)) .Or. !(If(ifDefTop(), (cAliasQSRA)->RA_TPCONTR$ cTpC1, SRA->RA_TPCONTR$ cTpC1 ))
		If nOrdem == 4 .OR. nOrdem == 6 // Ordem do Arquivo Movto.
			If nrelat == 4 .or. If(cPaisLoc $ "URU|ARG|PAR",nRelat==3,.F.)
				dbSelectArea("SRI")
			Else
				dbSelectArea("SRC")
			EndIf
			dbSkip()
		Endif
		fTestaTotal()
		Loop
	Endif
	
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Consiste controle de acessos e filiais validas				 |
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If !(cFil $ fValidFil()) .Or. !Eval(cAcessaSRA)
		If nOrdem == 4 .or. nOrdem == 6   // Ordem do Arquivo Movto.
			If nrelat == 4 .or. If(cPaisLoc $ "URU|ARG|PAR",nRelat==3,.F.)
				dbSelectArea("SRI")
			Else
				dbSelectArea( "SRC" )
			EndIf
			dbSkip()
		Endif
		fTestaTotal()
		Loop
	EndIf
	
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Verifica se e Adiantamento e Folha                           ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If nRelat == 1 .Or. nRelat == 2 .Or. If(!(cPaisLoc $ "URU|ARG|PAR"),nRelat == 3,.F.)
		lInssFun := .F.
		lCotFun := .F.
		dbSelectArea( "SRC" )
		If cCalcInf == "S"   //Verifica se deve listar so os Informados
		   If   ! DbSeek(cFil+cRelMat + aCodFol[64,1],.F.)  .And. ;
				! dbSeek(cFil+cRelMat + acodFol[65,1],.F. ) .And. ;
		 		! dbSeek(cFil+cRelMat + acodFol[70,1],.F. ) .And. ;
		 		! dbSeek(cFil+cRelMat + acodFol[125,1],.F.) 
				fTestaTotal()
				Loop
			Else
			   	DbSeek( cFil+cRelMat,.T.)
			Endif
		ElseIf nOrdem # 4 .AND. nOrdem # 6
			DbSeek( cFil+cRelMat,.T.) 
		Endif

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Busca os codigos de pensao definidos no cadastro beneficiario³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If nRelat == 3
			fBusCadBenef(@aCodBenef, "131", {aCodfol[172,1]})
		EndIf

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Carrega todas as verbas dos funcionarios					 ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ		
		//Query buscando todas as verbas do SRC	
		#IFDEF TOP
			cAliasQSRC := GetNextAlias()
			cAliasQSRV := cAliasQSRC
			aStruSRC  := SRC->(dbStruct())  
			lRelQuery := .T.
		   	cQuery := " SELECT " 
			cQuery += "RC_FILIAL, RC_MAT, RC_PD, RV_DESC, RC_TIPO1, RC_QTDSEM, RC_HORAS, RC_VALOR, RC_DATA, "
			cQuery += "RC_SEMANA, RC_CC, RC_PARCELA,  RC_TIPO2, RC_SEQ,"
			cQuery += If(Type("SRC->RC_VALORBA") # "U" ,"RC_VALORBA,","' ' AS RC_VALORBA,")
			cQuery += If(Type("SRC->RC_PLNUCO")  # "U" ,"RC_PLNUCO, ","' ' AS RC_PLNUCO,")
			cQuery += If(Type("SRC->RC_CODB1T")  # "U" ,"RC_CODB1T,","' ' AS RC_CODB1T,")
			cQuery += "RV_ADIANTA, RV_PERC, RV_PIS, RV_TIPOCOD, RV_CUSTO "
			If lTemItemRC .AND. lTemClVlRC
				cQuery += ",RC_ITEM, RC_CLVL "
			Endif
			cQuery += "FROM " + cArqSRC + " SRC, " + RetSqlName("SRV") + " SRV "
			cQuery += "WHERE SRC.RC_PD = SRV.RV_COD AND SRC." + cDel + " AND " 
			cQuery += "SRC.RC_FILIAL = '" + cFil + "' AND SRC.RC_MAT = '" + cRelMat + "' AND "        
			If Empty(xFilial("SRV"))
				cQuery	+=	" SRV.RV_FILIAL = ' ' "
			Else
				cQuery	+=	" SRC.RC_FILIAL = SRV.RV_FILIAL "
			EndIf
			cQuery += " ORDER BY " + cOrdem      
	    	cQuery := ChangeQuery(cQuery)
	
	        dbUseArea(.T., "TOPCONN", TCGenQry(,,cQuery), cAliasQSRC, .F., .T.)
			For nX := 1 To Len(aStruSRC)
				If aStruSRC[nX][2]<>"C"
					TcSetField(cAliasQSRC,aStruSRC[nX][1],aStruSRC[nX][2],aStruSRC[nX][3],aStruSRC[nX][4])
				EndIf
			Next nX
		#ENDIF
		While (cAliasQSRC)-> (!EOF()) .And. (nOrdem # 4 .and. nOrdem # 6 .And. (cAliasQSRC)->RC_FILIAL+(cAliasQSRC)->RC_MAT == cFil + cRelMat) .Or. ;
			((nOrdem = 4 .OR. nOrdem = 6) .And. (cAliasQSRC)->RC_FILIAL+(cAliasQSRC)->RC_CC+(cAliasQSRC)->RC_MAT == cFil+cCCto+cRelMat )
			If	(cAliasQSRC)->RC_SEMANA # Semana .And. Semana # "99"
				dbSkip()
				Loop
			Endif
			
			If !Eval(cAcessaSRC)
				dbSkip()
				Loop
			EndIf
			
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Desconto de Adto Gera um provento                            ³
			//³ Arredondamento do Adto gera um Provento                      ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			#IFNDEF TOP
			   PosSrv((cAliasQSRC)->RC_PD,cFil)
			#ENDIF
			If	(nRelat == 1) .And. ((cAliasQSRC)->RC_PD == aCodFol[7,1] .Or. (cAliasQSRC)->RC_PD == aCodFol[8,1])
				cCodInv := If((cAliasQSRC)->RC_PD == aCodFol[7,1],aCodfol[6,1],aCodFol[8,1])
				fSoma(@aFunP,"C",cCodInv)
				fSoma(@aCcP ,"C",cCodInv)
				fSoma(@aFilP,"C",cCodInv)
				fSoma(@aEmpP,"C",cCodInv)
				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³ I.R. do Adto. Codigo de Base gera IR do Adto.                ³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			ElseIf (nRelat == 1) .And. ((cAliasQSRC)->RC_PD == aCodFol[12,1])
				cCodInv := aCodFol[9,1]
				fSoma(@aFunD,"C",cCodInv)
				fSoma(@aCcD ,"C",cCodInv)
				fSoma(@aFilD,"C",cCodInv)
				fSoma(@aEmpD,"C",cCodInv)
			ElseIf (cAliasQSRV)->RV_TIPOCOD== "1"
				If nRelat == 2 .Or. (nRelat == 1 .And. (cAliasQSRV)->RV_ADIANTA  == "S")
					fSoma(@aFunP,"C")
					fSoma(@aCcP ,"C")
					fSoma(@aFilP,"C")
					fSoma(@aEmpP,"C")
				Endif
				If (nRelat == 3) .And. ((cAliasQSRC)->RC_PD == aCodFol[022,1])
					fSoma(@aFunP,"C")
					fSoma(@aCcP ,"C")
					fSoma(@aFilP,"C")
					fSoma(@aEmpP,"C")
				Endif 
			ElseIf (cAliasQSRV)->RV_TIPOCOD == "2"
				If	nRelat == 2 .Or. (nRelat == 1 .And. (cAliasQSRV)->RV_ADIANTA  == "S")
					fSoma(@aFunD,"C")
					fSoma(@aCcD ,"C")
					fSoma(@aFilD,"C")
					fSoma(@aEmpD,"C")
					//--Verifica se Funcionario teve Retencao de Inss
					If (cAliasQSRC)->RC_PD$ aCodFol[064,1]+'*'+aCodFol[065,1]+'*'+;
								             aCodFol[351,1]+'*'+aCodFol[354,1]
						lInssFun := .T.
					Endif
					If cPaisLoc == "URU" .And. (cAliasQSRC)->RC_PD$ aCodFol[309,1]
						lCotFun := .T.
					Endif
				Endif
				If	nRelat == 3 .And. Ascan(aCodBenef, { |x| x[1] == (cAliasQSRC)->RC_PD }) > 0
					fSoma(@aFunD,"C")
					fSoma(@aCcD ,"C")
					fSoma(@aFilD,"C")
					fSoma(@aEmpD,"C")
				Endif
			ElseIf (cAliasQSRV)->RV_TIPOCOD == "3"
				If	nRelat == 2 .Or. (nRelat == 1 .And. (cAliasQSRV)->RV_ADIANTA  == "S")
					fSoma(@aFunB,"C")
					fSoma(@aCcB ,"C")
					fSoma(@aFilB,"C")
					fSoma(@aEmpB,"C")
				Endif
				If	nRelat == 3 .And. ( (cAliasQSRC)->RC_PD == aCodFol[108,1] .Or. (cAliasQSRC)->RC_PD == aCodFol[109,1] .Or. (cAliasQSRC)->RC_PD == aCodFol[173,1] )
					fSoma(@aFunB,"C")
					fSoma(@aCcB ,"C")
					fSoma(@aFilB,"C")
					fSoma(@aEmpB,"C")
				Endif
			Endif
			(cAliasQSRC)-> (dbSkip())   
		Enddo 
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ 2§ Parcela 13§ Salario                                       ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	Elseif nRelat == 4 .or. If(cPaisLoc $ "URU|ARG|PAR",nRelat==3,.F.)
		lInssFun := .F.
	   
			//Query buscando todas as verbas do SRI	
		#IFDEF TOP
			cAliasQSRI := GetNextAlias()
			cAliasQSRV := cAliasQSRI
			aStruSRI  := SRI->(dbStruct())  
			lRelQuery := .T.
		   	cQuery := " SELECT "
		   	aEval( aStruSRI, { |x| cQuery	+= x[1] + ", " } ) 
			cQuery += "RV_ADIANTA, RV_PERC, RV_PIS, RV_TIPOCOD, RV_CUSTO "
			cQuery += "FROM " + cArqSRC + " SRI, " + RetSqlName("SRV") + " SRV "
			cQuery += "WHERE SRI.RI_PD = SRV.RV_COD AND SRI." + cDel + " AND " 
			cQuery += "SRI.RI_FILIAL = '" + cFil + "' AND SRI.RI_MAT = '" + cRelMat + "' AND "        
			If Empty(xFilial("SRV"))
				cQuery	+=	" SRV.RV_FILIAL = ' ' "
			Else
				cQuery	+=	" SRI.RI_FILIAL = SRV.RV_FILIAL "
			EndIf
			cQuery += " ORDER BY " + cOrdem
	    	cQuery := ChangeQuery(cQuery)
	
	        dbUseArea(.T., "TOPCONN", TCGenQry(,,cQuery), cAliasQSRI, .F., .T.)
			For nX := 1 To Len(aStruSRI)
				If aStruSRI[nX][2]<>"C"
					TcSetField(cAliasQSRI,aStruSRI[nX][1],aStruSRI[nX][2],aStruSRI[nX][3],aStruSRI[nX][4])
				EndIf
			Next nX
		#ENDIF

			dbSelectArea( cAliasQSRI )
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Se ordem for por CC do Movimento, imprimir baseado na chave  ³
		//³ de busca do SRI, caso contrario na chave de busca do SRA.    ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If nOrdem == 4 .or. nOrdem == 6
			cBuscaSRA := cFil + cRelCC + cRelMat //SRI->RI_FILIAL + SRI->RI_CC + SRI->RI_MAT
			cBuscaSRI := "cFil + cRelCC + cRelMat" //"SRI->RI_FILIAL + SRI->RI_CC + SRI->RI_MAT"
		Else
		   	cBuscaSRA := cFil + cRelMat
			cBuscaSRI := "cFil + cRelMat" //"SRI->RI_FILIAL + SRI->RI_MAT"
		EndIf
		While (cAliasQSRI)-> (!EOF()) .And. (&cBuscaSRI == cBuscaSRA)
			If !Eval(cAcessaSRI)
				(cAliasQSRI)->( dbSkip() )
				Loop
			EndIf
			If (cAliasQSRV)->RV_TIPOCOD== "1"
				fSoma(@aFunP,"I")
				fSoma(@aCcP ,"I")
				fSoma(@aFilP,"I")
				fSoma(@aEmpP,"I")
			ElseIf (cAliasQSRV)->RV_TIPOCOD== "2"
				fSoma(@aFunD,"I")
				fSoma(@aCcD ,"I")
				fSoma(@aFilD,"I")
				fSoma(@aEmpD,"I")
				//--Verifica se Funcionario teve Retencao de Inss
				If (cAliasQSRI)->RI_PD$ aCodFol[070,1]
					lInssFun := .T.
				Endif
			ElseIf (cAliasQSRV)->RV_TIPOCOD== "3"
				fSoma(@aFunB,"I")
				fSoma(@aCcB ,"I")
				fSoma(@aFilB,"I")
				fSoma(@aEmpB,"I")
			Endif
			(cAliasQSRI)->	( dbSkip() )
		Enddo
		(cAliasQSRI)->(dbCloseArea())
	Endif
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Nao considera funcionarios admitidos apos o periodo do movimento ³
	//³ e nem os demitidos anterior ao periodo.						     ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If MesAno(If(ifDefTop(), (cAliasQSRA)->RA_ADMISSA, SRA->RA_ADMISSA)) <= MesAno(dDtPesqAf) .and.;
		(Empty(If(ifDefTop(), (cAliasQSRA)->RA_DEMISSA, SRA->RA_DEMISSA)) .or. MesAno(If(ifDefTop(), (cAliasQSRA)->RA_DEMISSA, SRA->RA_DEMISSA)) >= MesAno(dDtPesqAf))
		
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Somatorias de Situacoes dos Funcionarios                     ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If cRelCC = cCcto
			If lInssFun
				nEinss ++ ; nFinss++ ; nCinss ++  //-- Total de Func. Ret. Inss
			Endif
         If cPaisLoc == "URU" 
				If lCotFun
	         	nFuncs++
				Endif
				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³ Conta funcionarios por centro de custo                       ³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				//So calcular se teve lanzada verba de salario mensal ou horista 13salario (se trabalhou)
				If nRelat <> 4 .or. nRelat <> 5
					If CTT->(FieldPos('CTT_POLIZA')) > 0				
						CTT->(DbSetOrder(1))
						If CTT->(MsSeek(xFilial()+cRelCC)) .And. !Empty(CTT->CTT_POLIZA)
							If (nPosBSE	:=	AScan(aFuncsBSE,{|x| x[1] == CTT->CTT_POLIZA})) == 0
								AAdd(aFuncsBSE,{CTT->CTT_POLIZA,1})
							Else
								aFuncsBSE[nPosBSE][2] ++ 
							Endif
						Endif
	   			Endif
	         Endif
			Endif
            If mesano(if(ifDefTop(), (cAliasQSRA)->RA_ADMISSA, SRA->RA_ADMISSA)) = MesAno(dDtPesqAf)
				nEadm ++ ; nFadm ++ ; nCadm ++  //-- Total Admitidos      
            Endif
 			If cTipAfas == " "
				nEnor ++ ; nFnor ++ ; nCnor ++  //-- Total Situacao Normal
				nEtot ++ ; nFtot ++ ; nCtot ++  //-- Total de Funcionarios
 
			Elseif cTipAfas == "A"
				nEafa ++ ; nFafa ++ ; nCafa ++  //-- Total Afastados
				nEtot ++ ; nFtot ++ ; nCtot ++  //-- Total de Funcionarios
				
			Elseif cTipAfas == "D"
				If Len(aFunP) > 0 .Or. Len(aFunD) > 0 .Or. Len(aFunB) > 0
					nEdem ++ ; nFdem ++ ; nCdem ++  // Demitidos
					nEtot ++ ; nFtot ++ ; nCtot ++  // Total de Funcionarios
				Endif
				
			Elseif cTipAfas == "F"
				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³ Procura No Arquivo de Ferias o Periodo a Ser Listado         ³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				dbSelectArea( "SRH" )
				If dbSeek( cFil + cRelMat )
				  	While !Eof() .And. cFil+cRelMat == SRH->RH_FILIAL + SRH->RH_MAT
						dbSkip()
					Enddo
					dbSkip(-1)
					
					//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
					//³ Verifica Se Esta Dentro Das Datas Selecionadas               ³
					//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
					If MesAno(SRH->RH_DATAINI) > cAnoMesRef
						nEnor ++ ; nFnor ++ ; nCnor ++  //-- Total Situacao Normal
					Else
						nEfer ++ ; nFfer ++ ; nCfer ++  //-- Ferias
					Endif
					nEtot ++ ; nFtot ++ ; nCtot ++  //-- Total de Funcionarios
				Endif
				dbSelectArea( "SRA" )
				
			Endif
		Else
			If lInssFun
				nCinss ++
			Endif
			nEexc ++ ; nFexc ++ ; nCexc ++  //-- Outro C.Custo
			nEtot ++ ; nFtot ++ ; nCtot ++  //-- Outro C.Custo
		Endif
		
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Testa Verbas de Provento / Descontos / Base                  ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If	Len(aFunP) == 0 .And. Len(aFunD) == 0 .And. Len(aFunB) == 0
			fTestaTotal()
			Loop
		Endif
	EndIf
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Imprime Funcionarios                                         ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	fImpFun(@aFunP,@aFunD,@aFunB)
	fTestaTotal()
	//FECHA A EXECUCAO DA QUERY ATRIBUIDA AO SRC	
	IF ( lRelQuery )
		(cAliasQSRC)-> (dbCloseArea())   
	ENDIF
Enddo   

//FECHA A EXECUCAO DA QUERY ATRIBUIDA AO SRA  		
IF ( lQuery )
	(cAliasQSRA)-> (dbCloseArea())   
	DbSelectArea("SRA")
ENDIF
Return Nil

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³fCalcComplºAutor  ³Andreia dos Santos  º Data ³  07/03/02   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Calcula os Valores de Pro-Labore, Autonomo, Cooperativa e  º±±
±±º          ³ Vl. da Receita de acordo com as verbas cadastradas.        º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºParametros³ cExp1 => Tipo 1 - Filial                                   º±±
±±º          ³          Tipo 2 - Centro de Custo                          º±±
±±º          ³ cExp2 => Centro de Custo                                   º±±
±±º          ³ cExp3 => Se .T. nao foi informado o CC no cadastro de      º±±
±±º          ³          parametros e o valor so sera considerado na Filialº±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ SIGAGPE                                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
STATIC  Function fCalcCompl(cTipo,cCCusto,lFilial,nOrdem)
Local nX := 1
Local nValor
Local lSoma := .F.

For nX := 1 to len(aGpsVal)
    if lFilial  
    	If ( StrZero(nOrdem,1) $ "1/4/5/6" .And. empty(alltrim(aGpsVal[nX,1])) ) .Or.;
    		StrZero(nOrdem,1) $ "2/3"
	       lSoma := .T.
	    Endif   
    ElseIF StrZero(nOrdem,1) $ "1/4/5/6" .And. alltrim(aGpsVal[nX,1]) == alltrim(cCCusto)
    	lSoma := .T.
    Endif
    If lSoma	
		nValor := If(aGpsVal[nx,5] <> 0,aGpsVal[nx,5],round(aGpsVal[nx,3]*aGpsVal[nx,4]/100,2))
		if nValor <> 0
			fSomaInss(cTipo,aGpsVal[nx,2],nValor)  
		Endif
	EndIF	
    lSoma := .F.
Next
return



/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³GPER040   ºAutor  ³Microsiga           º Data ³  11/30/06   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Retorna a quebra de c.custo + item + Classe                º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function Quebra( nOrdem, nRelat, cTipo )

Local cRet := ''

If     nOrdem == 4
	
	If cTipo = 'CC'
		
		If nRelat == 4
			cRet := ( cAliasQSRA )->RI_CC
		Else
		  	cRet := ( cAliasQSRA )->RC_CC
		EndIf
		
	Else
		
		cRet := ' '
		
	EndIf
	
ElseIf nOrdem == 6
	
	If nRelat == 4 .or. If(cPaisLoc $ "URU|ARG|PAR",nRelat==3,.F.)
		cRet := IIf( cTipo == 'CC', ( cAliasQSRA )->RI_CC, IIf( cTipo == 'IT', ( cAliasQSRA )->RI_ITEM, IIf( cTipo == 'CL', ( cAliasQSRA )->RI_CLVL, ' ') ) )
	Else
		cRet := IIf( cTipo == 'CC', ( cAliasQSRA )->RC_CC, IIf( cTipo == 'IT', ( cAliasQSRA )->RC_ITEM, IIf( cTipo == 'CL', ( cAliasQSRA )->RC_CLVL, ' ') ) )
	EndIf
	
Else
	
	If cTipo = 'CC'
		cRet := (cAliasQSRA)->RA_CC
	Else
		cRet := ' '
	EndIf
	
EndIf

Return cRet

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFunction  ³AjustaSX1 ºAutor  ³Microsiga           º Data ³  23/10/06   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Ajusta o grupo de perguntas                                º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static function AjustaSX1()
Local aArea := GetArea()
Local aRegs	:=	{}
Local aHelp	:= 	{}  
Local aHelpE:= 	{}  
Local aHelpI:= 	{}  
Local cHelp	:= ""          

aHelp := {""}
aHelpE:= {""}  
aHelpI:= {""}  
cHelp := ""
			                                                                                           
//            cPerg	Ordem	PergPort                      cPerSpa                  cPerEng               cVar     Tipo nTam/Dec   Presel  cGSC	cValid		    cVar01	    cDef01    cDefSpa1    cDefEng1    cCont01	        cVar02	   cDef02           cDefSpa2         cDefEng2   cCnt02 cVar03 cDef03   cDefSpa3  cDefEng3  	cCnt03	cVar04	  	    cDef04              cDefSpa4  cDefEng4  cCnt04 	cVar05 	 cDef05	 cDefSpa5  cDefEng5	 cCnt05	 cF3	cGrpSxg cPyme	 aHelpPor aHelpEng	aHelpSpa  cHelp
Aadd(aRegs,{"GPR040","21","Imprime C. Custo?"         ,"¿Imprime C.Costo?"        ,"Print Cost Center?"  ,"MV_CHL","C" ,1 ,0      ,1      ,"C" ,"naovazio"   ,"mv_par21"  ,"Codigo"  ,"Codigo"  ,"Code"        ,""             ,""      ,"Descricao"   ,"Descripcion"  ,"Description"  ,""   ,""   ,"Ambos"  ,"Ambos"  ,"Both"     ,""    ,""      ,"Dados Tomador"       ,""       ,""      ,""       ,""      ,""     ,""     ,""       ,""     ,""     ,""    ,"S"     ,""      , ""      ,""     ,""})
ValidPerg(aRegs,"GPR040",.T.)
RestArea( aArea )

Return nil


/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡ao	 ³DescCc 	³ Autor ³ Marcelo Silveira      ³ Data ³ 15/09/08 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Retorna a Descricao do Centro de Custo					  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ AP                                                         ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß/*/
STATIC Function DescCc( cCodigo, cFil, nBytes )

//Local cAlias := Alias()
Local aArea:=GetArea()//RRP - 17/12/2013 - Ajuste no alias.

If nBytes = Nil
	nBytes := 40
Endif

dbSelectArea( "CTT" ) //-->Prioriza a utilizacao da tabela CTT
If !EOF()
	If ( cFil # Nil .And. cFilial == "  " ) .Or. cFil == Nil
		cFil := cFilial
	Endif
	If dbSeek( cFil + cCodigo )
		cRet := Left( CTT_DESC01 + Space( nBytes ), nBytes )
	Else
		cRet := Left( STR0011 + Space( nBytes ), nBytes )  //"** Nao Cadastrado **"
	Endif
Else
	dbSelectArea( "SI3" ) //-->Utiliza a tabela SI3 caso a tabela CTT esteja vazia
		If ( cFil # Nil .And. cFilial == "  " ) .Or. cFil == Nil
			cFil := cFilial
		Endif
		If dbSeek( cFil + cCodigo )
			cRet := Left( I3_DESC + Space( nBytes ), nBytes )
		Else
			cRet := Left( STR0011 + Space( nBytes ), nBytes )  //"** Nao Cadastrado **"
		Endif
Endif

//dbSelectArea( cAlias )
RestArea(aArea)//RRP - 17/12/2013 - Ajuste no alias.

Return( cRet )
/* 
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³fProcGravaSRZºAutor  ³Luciana Silveira    º Data ³  05/05/2008 º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava registros na tabela SRZ   	 							 º±±
±±º          ³           													 º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºParametros³ nRelat => Adto / Folha / 1¦ Parc. / 2¦ Parc.                  º±±
±±º          ³ cEncInss => S (Sim) / N(Nao)                                  º±±
±±º          ³ cMesAnoRefProc => mesAno Referencia                           º±±
±±º          ³ lGerouSRZ =>  True ou False Indica se a procedure foi criada  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ GPEM110                                                     	 º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

STATIC Function fProcGravaSRZ(nRelat, cEncInss,cMesAnoRefProc,lGerouSRZ, cArqSRC, nTpContr)
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Define Variaveis utilizadas na Procedure                     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ   
Local cDeclare 		:= ""
Local cDelete  		:= ""
Local cDel			:= "" 
Local cIni			:= ""
Local cFim			:= ""
Local cFlFun 		:= "" 
Local c13Fun 		:= ""
Local cFlCc  		:= ""
Local c13Cc  		:= ""
Local cFlFil 		:= ""
Local c13Fil 		:= ""
Local cFlEmp		:= "" 
Local c13Emp		:= ""
Local cFlFunCc 		:= "" 
Local c13FunCc 		:= ""
Local cParam15		:= ""
Local cRetProc		:= ""
Local cQryTipo		:= ""
Local nRegRx		:= 0
Local cQueryExec	:= ""
Local cAliasTMP		:= ""
Local cProcName		:= "SPGERASRZ"
Local cTableTmp 	:= "TBLRXTMP"
Local nRegProc 		:= 0
Local cString		:=""
Local cMesRef		:= Substr(cMesAnoRefProc,5,2) + Substr(cMesAnoRefProc,1,2)
Local cAnoMesProc	:= Substr(cMesAnoRefProc,3,4) + Substr(cMesAnoRefProc,1,2)
Local cAliasSRZ		:= InitSqlName( "SRZ" )
Local cAliasSRA		:= InitSqlName( "SRA" )
Local cAliasSRC		:= If(ValType(cArqSRC) == "C", cArqSRC, InitSqlName( "SRC" ))
Local cAliasSRI		:= InitSqlName( "SRI" )
Local aCampos   	:= {}
Local aResult   	:= {}  
Local aGPSVal   	:= {}
Local nx			:= 0
Local n				:= 0
Local nLastRec		:= 0
Local cParam        := ""
Local cTpFL			:= ""
Local cTp13			:= ""
Local cProcErr		:= ""
Local cDescErr		:= ""
Local nSbsErr		:= 0
Local nCnt			:= 0
Local nPos			:= 0
Local nMinRec		:= 0
Local nMaxRec		:= 0  
Local nz			:= 0
Local nCont			:= 0
Local nTot			:= 0 
Local cRetSqlName := InitSqlName( "SRZ" )

cTPFL				:= "'FL" + " "+ cMesAnoRefProc+ "'"
cTp13				:= "'13" + " "+ cMesAnoRefProc+ "'"
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Busca o tamanho do campo Centro de Custo no SX3 para declaracao³
//³ da variavel que guardará o Centro de Custo                     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ 

Private nTamSx3		:= Alltrim(str(TamSx3( "RZ_CC     " )[1]))
If Type("SRZ->RZ_ITEM") # "U"   .And. Type("SRZ->RZ_CLVL") # "U"
	Private nTamRZItem	:= Alltrim(str(TamSx3( "RZ_ITEM     " )[1]))
	Private nTamRZClas	:= Alltrim(str(TamSx3( "RZ_CLVL     " )[1]))
Endif

Private lExInAs400

lExInAs400 := ExeInAs400() 
If TcSrvType() == "AS/400"
	cRecno	:=  "RRN("+cRetSqlName+")"
	cDel	:=  "@DELETED@  = ' '"
Else
	cRecno	:= "R_E_C_N_O_" 
	cDel	:= "D_E_L_E_T_ = ' '"
EndIf


If Type("aErrProc") == "U"
	Private aErrProc := {}
EndIf
If !nTpContr == 2
	If nRelat==4
		cQryTipo:= "13"
	Else
		cQryTipo:= "FL"
	Endif      
    

	
/*
ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³ Apaga os registros da SRZ 							         ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ*/ 

MsMinMaxRec( "SRZ" , @nMinRec , @nMaxRec  )
nTot	:= ( nMaxrec - nMinRec )

	If nTot # 0
		If nTot < 1024
			cDelete := "Delete from " + RetSqlName("SRZ") +CRLF
			cDelete += "Where " + cRecno + ">=" + allTrim(str(nMinRec)) + " AND " + cRecno + "<=" + allTrim(str(nMaxRec)) 
			TcSqlExec ( cDelete )
		Else
			nTot := Ceiling(nTot / 1024) //Arredonda para cima em caso de numero quebrado
			nCont := nMinRec + 1024
			For nz = 1 to nTot
				cDelete := "Delete from " + RetSqlName("SRZ") +CRLF
				cDelete += "Where " + cRecno + ">=" + allTrim(str(nMinRec)) + " AND " + cRecno + "<=" + allTrim(str(nCont)) 
				TcSqlExec ( cDelete )
				nMinRec := nCont
				nCont	:= nMinRec + 1024
			Next nz
			If nCont <= nMaxRec
				cDelete += "Delete from " + RetSqlName("SRZ") +CRLF
				cDelete += "Where " + cRecno + ">=" + allTrim(str(nCont)) + " AND " + cRecno + "<=" + allTrim(str(nMaxRec)) 
		   		TcSqlExec ( cDelete )
			Endif
		Endif 
	Endif	  


	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Resgata valores do Parametro 15                              ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ  
	nRegRx		:= 0
	cAliasTMP	:= GetNextAlias()
   	If ("MSSQL"$tcGetDB())
		BeginSql alias cAliasTMP
			SELECT RX_COD AS NRORX, SUBSTRING(RX_COD, 1,2) AS cFil
		 	FROM %table:SRX% SRX
			WHERE   SRX.%notDel%
			AND SRX.RX_TIP="15"
			AND SUBSTRING(SRX.RX_COD,3,4) =%exp:cMesRef%
			AND EXISTS (SELECT RC_FILIAL FROM %table:SRC% SRC WHERE RC_FILIAL = SUBSTRING(RX_COD, 1,2) )
		EndSql 
	Else
		BeginSql alias cAliasTMP
			SELECT RX_COD AS NRORX, SUBSTR(RX_COD, 1,2) AS cFil
			FROM %table:SRX% SRX
			WHERE   SRX.%notDel%  
			AND SRX.RX_TIP="15"
			AND SUBSTR(SRX.RX_COD,3,4) =%exp:cMesRef%
			AND EXISTS (SELECT RC_FILIAL FROM %table:SRC% SRC WHERE RC_FILIAL = SUBSTR(RX_COD, 1,2) )
		EndSql
	Endif     
		         
	dbSelectArea(cAliasTMP)
	nRegRx := Alltrim((cAliasTMP)->(NRORX))
	nRegRx := Len(nRegRx)
 
	If nRegRx > 0
		cQuery	:= "SELECT COUNT(*) NLASTREC "
		cQuery	+= "FROM " + RetSqlName("SRX") + " SRX "
		If TcSrvType() != "AS/400"
			cQuery	+= "WHERE SRX.D_E_L_E_T_ = ' ' "
		Else
			cQuery	+= "WHERE SRX.@DELETED@  = ' ' "
		Endif
	
		cQuery	+= "AND SRX.RX_TIP='15' "
		If ("MSSQL"$tcGetDB())	     
			cQuery	+= "AND SUBSTRING(SRX.RX_COD, 3,4) = '" + cMesRef + "'" 
			cQuery	+= " AND EXISTS (SELECT RC_FILIAL FROM " + RetSqlName("SRC") + " WHERE RC_FILIAL = SUBSTRING(RX_COD, 1,2) )
		   	cQuery	+= "AND	SUBSTRING(RX_COD," + alltrim(str(nRegRx)) + ",1) = '1'"  
		Else
			cQuery	+= "AND SUBSTR(RX_COD, 3,4) = '" + cMesRef + "'" 
			cQuery	+= " AND EXISTS (SELECT RC_FILIAL FROM " + RetSqlName("SRC") + " WHERE RC_FILIAL = SUBSTR(RX_COD, 1,2) )
			cQuery	+= "AND	SUBSTR(RX_COD," + alltrim(str(nRegRx)) + ",1) = '1'"
		Endif
		cQuery	:= ChangeQuery( cQuery )
		IF ( MsOpenDbf(.T.,"TOPCONN",TcGenQry(,,cQuery),"__QRYCOUNT",.T.,.T.) )
			nLastRec := __QRYCOUNT->NLASTREC
						__QRYCOUNT->( dbCloseArea() )
		Endif 
		For n := 1 to nLastRec
			fGPSVal((cAliasTMP)->(cFil),If(nRelat == 4,Left(cAnoMesProc,4)+"13",cAnoMesProc),@aGPSVal,str(nTpContr))
		Next n
		cString:= ""
		If len(aGPSVal) > 0
			If TCCanOpen(cTableTmp)
				TCDelFile(cTableTmp) 
			EndIf
			
			AAdd( aCampos, { "tmpFILIAL"	, "C",       02, 0 } )	
			AAdd( aCampos, { "tmpCC"		, "C",val(nTamSx3), 0 } )	
			AAdd( aCampos, { "tmpMAT"		, "C",	     06, 0 } )	
			AAdd( aCampos, { "tmpPD" 		, "C",       03, 0 } ) 	
			AAdd( aCampos, { "tmpHRS"		, "N",       17, 2 } ) 
			AAdd( aCampos, { "tmpBASE"		, "N",       17, 2 } )
			AAdd( aCampos, { "tmpPERC"		, "N",       17, 2 } ) 
			AAdd( aCampos, { "tmpVAL"		, "N",       17, 2 } ) 	
			AAdd( aCampos, { "tmpOCORREN"	, "N",       17, 2 } )              
			AAdd( aCampos, { "tmpTIPO"		, "C",       02, 0 } )          
			AAdd( aCampos, { "tmpTPC"		, "C",       01, 0 } )
		    MsCreate(cTableTmp,aCampos,"TOPCONN") 
		    
		        
			MsOpenDbf( .T. , __cRdd , cTableTmp , "QTMP" , .F. )
						
			For nx := 1 to Len(aGPSVal)
				Reclock ("QTMP",.T.)
				tmpFILIAL	:= 	(cAliasTMP)->(cFil)
				tmpCC		:= 	aGPSVal[nx,1]
				tmpMAT		:= 	"zzzzzz"
				tmpPD		:= 	aGPSVal[nx,2]
				tmpHRS		:= 	0
				tmpBASE		:= 	aGPSVal[nx,3]
				tmpPERC		:= 	aGPSVal[nx,4]
				tmpVAL		:= 	If(aGpsVal[nx,5] <> 0,aGpsVal[nx,5],round(aGpsVal[nx,3]*aGpsVal[nx,4]/100,2))
				tmpOCORREN	:= 	1
				tmpTIPO     := 	cQryTipo
				tmpTPC		:= 	AllTrim(str(nTpContr))
				QTMP-> (msUnlock())
			Next nx    
		
			QTMP->( dbCloseArea() )
		Endif	    
	Endif
	( cAliasTMP )->( dbCloseArea())  

	cQuery	:= "SELECT COUNT(RA_TPCONTR) NLASTREC "
	cQuery	+= "FROM " + RetSqlName("SRA") + " SRA "
	cQuery	+= "WHERE RA_TPCONTR = ' '  AND  SRA." + cDel
	cQuery	:= ChangeQuery( cQuery )  
	IF ( MsOpenDbf(.T.,"TOPCONN",TcGenQry(,,cQuery),"__QRYCOUNT",.T.,.T.) )
		nTpCtr := 	__QRYCOUNT->NLASTREC
					__QRYCOUNT->( dbCloseArea() )
	Endif 
	If nTpCtr > 0 
		cQuery := "UPDATE "+RetSqlName("SRA")+ " SET RA_TPCONTR = '1'  WHERE RA_TPCONTR = ' '" +CRLF
		TcSqlExec(cQuery) 
	Endif 
		
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Declaracao de variaveis da procedure                         ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	cDeclare := "Declare @RZ_FILIAL char(2)" +CRLF
	cDeclare += "Declare @RZ_CC char(" + nTamSx3 + ")"  +CRLF
	cDeclare += "Declare @RZ_MAT char(6)"  +CRLF
	cDeclare += "Declare @RZ_PD char(3)" +CRLF
	cDeclare += "Declare @RZ_HRS float" +CRLF
	cDeclare += "Declare @RZ_VAL float" +CRLF
	cDeclare += "Declare @RZ_OCORREN float" +CRLF
	cDeclare += "Declare @RZ_TIPO char(2)" +CRLF
	cDeclare += "Declare @RZ_TPC char(1)" +CRLF
	cDeclare += "Declare @MaxRecno integer "  +CRLF 
	cDeclare += "Declare @Desc15 varchar(100)"  +CRLF
	cDeclare += "Declare @RxCod varchar(20)"  +CRLF
	cDeclare += "Declare @vcCC char(" +  nTamSx3 + ")"  +CRLF  
	cDeclare += "Declare @vcFil char(2)"  +CRLF 
	cDeclare += "Declare @vcPD char(3)"  +CRLF 
	cDeclare += "Declare @vcTPC char(1)"  +CRLF 
	cDeclare += "Declare @vvVal Float"  +CRLF 
	cDeclare += "Declare @vcPerc Float"  +CRLF 
	cDeclare += "Declare @vvValFim Float"  +CRLF
	cDeclare += "Declare @Recno15 integer "  +CRLF 
    cDeclare += "Declare @Compr integer "  +CRLF 
    cDeclare += "Declare @iNroRegs integer "  +CRLF
    cDeclare += "Declare @iTranCount Integer"+CRLF 
    If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	    cDeclare += "Declare @lTemItemRC char(" + nTamRZItem + ")"  +CRLF
	    cDeclare += "Declare @lTemClVlRC char(" + nTamRZClas + ")"  +CRLF
	    cDeclare += "Declare @lTemItemRZ char(" + nTamRZItem + ")"  +CRLF
	    cDeclare += "Declare @lTemClVlRZ char(" + nTamRZClas + ")"  +CRLF
    Endif  
    cIni	:= "begin "  +CRLF 
    cDelete	:= "	SELECT @OUT_RESULTADO = '0'" +CRLF 
    cDelete	+= "	Select @iNroRegs = 0"+CRLF
    
  
       
	//CURSOR PARA INSERIR TODOS OS FUNCIONARIOS	
	If cEncInss == "S"
		If lFolPgto
			cFlFun := "declare curFun insensitive cursor for"  +CRLF
			cFlFun += "select " +CRLF
			cFlFun += "RC_FILIAL , " +CRLF
			cFlFun += "RC_CC , " +CRLF
			cFlFun += "RC_MAT , " +CRLF
			cFlFun += "RC_PD , " +CRLF
			cFlFun += "SUM(RC_HORAS) as RC_HORAS, " +CRLF 
			cFlFun += "SUM(RC_VALOR) as RC_VALOR, "  +CRLF
			cFlFun += "COUNT( RC_PD ) RZ_OCORREN," +CRLF  
			cFlFun += "'FL' as RZ_TIPO, "  +CRLF
			cFlFun += "RA_TPCONTR "  
			
			If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
				cFlFun += ", RC_ITEM,RC_CLVL " +CRLF
			Endif 
			
			cFlFun += "from " + cAliasSRA + " SRA," + cAliasSRC + " SRC "  +CRLF
			cFlFun += "where " +CRLF
			cFlFun += "RC_FILIAL   >='"+ cFilDe +"'" + " and" +CRLF      
			cFlFun += "RC_FILIAL   <='"+ cFilAte+"'" + " and" +CRLF
			cFlFun += "SRC." + cDel + " AND " +CRLF   
			cFlFun += "SRA." + cDel + " AND "  +CRLF
			cFlFun += "RC_FILIAL = RA_FILIAL and " +CRLF  
			cFlFun += "RC_MAT = RA_MAT" +CRLF 
			If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
				cFlFun += "GROUP BY RC_FILIAL, RC_MAT, RC_CC, RC_PD,RA_TPCONTR,RC_ITEM,RC_CLVL" +CRLF
			Else
				cFlFun += "GROUP BY RC_FILIAL, RC_MAT, RC_CC, RC_PD,RA_TPCONTR" +CRLF
			Endif
			cFlFun += "ORDER BY 1, 2, 4, 9 " +CRLF
		    cFlFun += "for read only"  +CRLF   
			cFlFun += "open curFun"  +CRLF 
			
			If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
				cFlFun += "fetch curFun into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
			Else
				cFlFun += "fetch curFun into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
			Endif 
			
			cFlFun += "while (@@fetch_Status = 0) begin "  +CRLF 
			
			/* ------------- Tratamento para executar Commit a cada  registros --------------- */
			cFlFun += "      select @iNroRegs = @iNroRegs + 1"+CRLF
			cFlFun += "		If @iNroRegs = 1"+CRLF  
			cFlFun += "			begin"+CRLF 
			If !("MSSQL"$tcGetDB())
				cFlFun += "         Begin Transaction"+CRLF 
		   	Endif		
		   	cFlFun += "         	Select @iNroRegs = @iNroRegs"+CRLF
			cFlFun += "			End"+CRLF
			cFlFun += "					select @MaxRecno = isnull( max( R_E_C_N_O_ ), 1) from " + RetSqlName("SRZ") +CRLF 	
			cFlFun += "					Select  @MaxRecno =  @MaxRecno + 1" +CRLF
			If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
				cFlFun += "		insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, RZ_ITEM,RZ_CLVL, " + cRecno + ")" +CRLF
				cFlFun += "		values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ,@MaxRecno )" +CRLF
			Else
				cFlFun += "		insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, " + cRecno + ")" +CRLF
			   	cFlFun += "		values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @MaxRecno )" +CRLF  
			Endif          
			
//Commit a cada 1024 linhas

			cFlFun += "			If @iNroRegs = 1024 "+CRLF 
			cFlFun += "				begin"+CRLF 
			If !("MSSQL"$tcGetDB())
		   		cFlFun += "         	Commit Transaction "+CRLF
		   	Endif
			cFlFun += "					Select @iNroRegs = 0"+CRLF
  
			cFlFun += "				End"+CRLF
			If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
				cFlFun += "fetch curFun into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
			Else
				cFlFun += "fetch curFun into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
			Endif
			cFlFun += "end"  +CRLF 
			cFlFun += "	If @iNroRegs > 0 "+CRLF
			cFlFun += "		begin"+CRLF
			cFlFun += "			select @iNroRegs = 0"+CRLF
			cFlFun += "			Select @iTranCount  = 0"+CRLF 
   			If !("MSSQL"$tcGetDB())
   				cFlFun += "		Commit Transaction"+CRLF 
			Endif
			cFlFun += "     End"+CRLF
			cFlFun += "close curFun"  +CRLF   
			cFlFun += "deallocate curFun" +CRLF
		Endif
		
		If lFol13Sl
			c13Fun := "declare curFun13 insensitive cursor for"  +CRLF
			c13Fun += "select " +CRLF
			c13Fun += "RI_FILIAL , " +CRLF
			c13Fun += "RI_CC , " +CRLF
			c13Fun += "RI_MAT , " +CRLF
			c13Fun += "RI_PD , " +CRLF
			c13Fun += "SUM(RI_HORAS) as RI_HORAS, " +CRLF 
			c13Fun += "SUM(RI_VALOR) as RI_VALOR, "  +CRLF
			c13Fun += "COUNT(RI_PD) RZ_OCORREN," +CRLF  
			c13Fun += "'13' as RZ_TIPO, "  +CRLF
			c13Fun+= " RA_TPCONTR  " 
			
			If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
				c13Fun += ", RI_ITEM,RI_CLVL " +CRLF
			Endif
			
			c13Fun += "from " + cAliasSRA + " SRA," + cAliasSRI + " SRI "  +CRLF
			c13Fun += "where " +CRLF
			c13Fun += "RI_FILIAL   >='"+ cFilDe +"'" + " and" +CRLF      
			c13Fun += "RI_FILIAL   <='"+ cFilAte+"'" + " and" +CRLF
			c13Fun += "SRI." + cDel + " and " +CRLF   
			c13Fun += "SRA." + cDel + " AND "  +CRLF
			c13Fun += "RI_FILIAL = RA_FILIAL and " +CRLF  
			c13Fun += "RI_MAT = RA_MAT" +CRLF 
			If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
				c13Fun += "group by RI_FILIAL, RI_MAT, RI_CC, RI_PD,RA_TPCONTR, RI_ITEM,RI_CLVL " +CRLF
			Else 
				c13Fun += "group by RI_FILIAL, RI_MAT, RI_CC, RI_PD,RA_TPCONTR " +CRLF
			Endif
			c13Fun += "ORDER BY 1, 2, 4, 9 " +CRLF 
			c13Fun += "for read only"  +CRLF   
			c13Fun += "open curFun13"  +CRLF
			
			If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
				c13Fun += "fetch curFun13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
			Else
				c13Fun += "fetch curFun13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
			Endif
			
			c13Fun += "while (@@fetch_Status = 0) begin "  +CRLF
			c13Fun += "      select @iNroRegs = @iNroRegs + 1"+CRLF
			c13Fun += "      If @iNroRegs = 1 begin"+CRLF
			
			If !("MSSQL"$tcGetDB())
				c13Fun += "         Begin Transaction"+CRLF
		   	Endif 
			
			c13Fun += "         Select @iNroRegs = @iNroRegs"+CRLF
			c13Fun += "      End"+CRLF
			c13Fun += "					select @MaxRecno = isnull( max( R_E_C_N_O_ ), 1) from " + RetSqlName("SRZ") +CRLF 	
			c13Fun += "					Select  @MaxRecno =  @MaxRecno + 1" +CRLF
			
			If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
				c13Fun += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, RZ_ITEM,RZ_CLVL, " + cRecno + ")" +CRLF
			   	c13Fun += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC,@lTemItemRZ, @lTemClVlRZ, @MaxRecno )" +CRLF  
			Else
				c13Fun += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, " + cRecno + ")" +CRLF
			   	c13Fun += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @MaxRecno )" +CRLF  
			Endif
			
//Commit a cada 1024 linhas

			c13Fun += "      If @iNroRegs = 1024 begin"+CRLF 
		   	If !("MSSQL"$tcGetDB())
				c13Fun += "      Commit Transaction"+CRLF      
		 	Endif
			c13Fun += "      select @iNroRegs = 0"+CRLF
			c13Fun += "      End"+CRLF
			If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
		   		c13Fun += "fetch curFun13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
			Else
				c13Fun += "fetch curFun13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
			Endif
			c13Fun += "end"  +CRLF 
			c13Fun += "	If @iNroRegs > 0 begin"+CRLF
			c13Fun +=	"		select @iNroRegs = 0"+CRLF
			c13Fun += "       Select @iTranCount  = 0"+CRLF 
			If !("MSSQL"$tcGetDB())
   				c13Fun += "		Commit Transaction"+CRLF 
		   	Endif
			c13Fun += "      End"+CRLF
			c13Fun += "close curFun13"  +CRLF   
			c13Fun += "deallocate curFun13" +CRLF
		Endif
	
	  	cFim := "end "  +CRLF 		
	Endif
   		
	//CURSOR PARA INSERIR QUEBRA POR FILIAL 
	cIni := "begin "  +CRLF 
	If lFolPgto
		cFlFil += "declare curFil insensitive cursor for"  +CRLF
		cFlFil += "select DISTINCT RC_FILIAL as RZ_FILIAL, "  +CRLF 
		cFlFil += "'zzzzzzzzz' as RZ_CC, "  +CRLF  
		cFlFil += "'zzzzzz' as RZ_MAT, "  +CRLF
		cFlFil += "RC_PD as RZ_PD, "  +CRLF 
		cFlFil += "SUM(RC_HORAS) as RZ_HRS, "  +CRLF 
		cFlFil += "SUM(RC_VALOR) as RZ_VAL, "  +CRLF 
		cFlFil += "COUNT( RC_PD ) RZ_OCORREN, "  +CRLF
		cFlFil += "'FL' as RZ_TIPO, " +CRLF    
		cFlFil += "RA_TPCONTR as RZ_TPC " 
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cFlFil += ", RC_ITEM,RC_CLVL " +CRLF
		Endif
	  	cFlFil += "from " + cAliasSRA + " SRA," + cAliasSRC + " SRC " +CRLF 
		cFlFil += "where RC_FILIAL   >='"+ cFilDe +"'" + " AND"  +CRLF       
		cFlFil += "RC_FILIAL   <='"+ cFilAte +"'" + " AND"  +CRLF       
		cFlFil += "SRC." + cDel + " AND "  +CRLF  
		cFlFil += "SRA." + cDel + " AND "  +CRLF
		cFlFil += "RC_FILIAL = RA_FILIAL AND "  +CRLF   
		cFlFil += "RC_MAT = RA_MAT "  +CRLF   
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC   
			cFlFil += "GROUP BY RC_FILIAL, RC_PD, RA_TPCONTR, RC_ITEM, RC_CLVL "  +CRLF 
		Else
			cFlFil += "GROUP BY RC_FILIAL, RC_PD, RA_TPCONTR "  +CRLF 
		Endif
		cFlFil += "ORDER BY 1, 2, 4, 9 " +CRLF 
		cFlFil += "OPEN curFil"  +CRLF  
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	   		cFlFil += "fetch curFil into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
		Else
			cFlFil += "fetch curFil into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
		Endif
		cFlFil += "while (@@fetch_Status = 0) begin "  +CRLF
		cFlFil += "      select @iNroRegs = @iNroRegs + 1"+CRLF
		cFlFil += "		If @iNroRegs = 1 begin"+CRLF
		If !("MSSQL"$tcGetDB())
			cFlFil += "         Begin Transaction"+CRLF
		Endif
		cFlFil += "         Select @iNroRegs = @iNroRegs"+CRLF
		cFlFil += "		End"+CRLF
		cFlFil += "					select @MaxRecno = isnull( max( R_E_C_N_O_ ), 1) from " + RetSqlName("SRZ") +CRLF 	
		cFlFil += "					Select  @MaxRecno =  @MaxRecno + 1" +CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cFlFil += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, RZ_ITEM,RZ_CLVL, " + cRecno + ")" +CRLF
			cFlFil += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ, @MaxRecno )" +CRLF  
		Else
			cFlFil += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, " + cRecno + ")" +CRLF
			cFlFil += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @MaxRecno )" +CRLF  
		Endif  

//Commit a cada 1024 linhas

		cFlFil += "      If @iNroRegs = 1024 begin"+CRLF
		If !("MSSQL"$tcGetDB())
	   		cFlFil += "         Commit Transaction "+CRLF  
	   	Endif
		cFlFil += "         select @iNroRegs = 0"+CRLF
		cFlFil += "      End"+CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	   		cFlFil += "fetch curFil into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
		Else
			cFlFil += "fetch curFil into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
		Endif
		cFlFil += "End"  +CRLF  
		cFlFil += "   If @iNroRegs > 0  begin"+CRLF 
		cFlFil +=	"		select @iNroRegs = 0"+CRLF 
		cFlFil += "      Select @iTranCount  = 0"+CRLF  
		If !("MSSQL"$tcGetDB())
			cFlFil += "      Commit Transaction"+CRLF 
		Endif
		cFlFil += "   End"+CRLF 
		cFlFil += "Close curFil"  +CRLF  
		cFlFil += "Deallocate curFil"  +CRLF
	Endif
	If lFol13Sl 
		c13Fil += "Declare curFil13 insensitive cursor for"  +CRLF
		c13Fil += "SELECT DISTINCT RI_FILIAL as RZ_FILIAL, "  +CRLF 
		c13Fil += "'zzzzzzzzz' as RZ_CC, "  +CRLF  
		c13Fil += "'zzzzzz' as RZ_MAT, "  +CRLF
		c13Fil += "RI_PD as RZ_PD, "  +CRLF 
		c13Fil += "SUM(RI_HORAS) as RZ_HRS, "  +CRLF 
		c13Fil += "SUM(RI_VALOR) as RZ_VAL, "  +CRLF 
		c13Fil += "COUNT(RI_PD) RZ_OCORREN, "  +CRLF
		c13Fil += "'13' as RZ_TIPO, " +CRLF
		c13Fil += "RA_TPCONTR as RZ_TPC " 
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			c13Fil += ", RI_ITEM,RI_CLVL " +CRLF
		Endif
		c13Fil += "FROM " + cAliasSRA + " SRA," + cAliasSRI + " SRI " +CRLF 
		c13Fil += "WHERE RI_FILIAL   >='"+ cFilDe +"'" + " AND"  +CRLF       
		c13Fil += "RI_FILIAL   <='"+ cFilAte+"'" + " AND"  +CRLF       
		c13Fil += "SRI." + cDel + " AND "  +CRLF      
		c13Fil += "SRA." + cDel + " AND "  +CRLF
		c13Fil += "RI_FILIAL = RA_FILIAL AND "  +CRLF   
		c13Fil += "RI_MAT = RA_MAT "  +CRLF   
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC   
			c13Fil += "GROUP BY RI_FILIAL, RI_PD, RA_TPCONTR, RI_ITEM,RI_CLVL "  +CRLF
		Else
			c13Fil += "GROUP BY RI_FILIAL, RI_PD, RA_TPCONTR "  +CRLF
		Endif
		c13Fil += "ORDER BY 1, 2, 4, 9 " +CRLF  
		c13Fil += "OPEN curFil13"  +CRLF  
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	   		c13Fil += "fetch curFil13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
		Else
			c13Fil += "fetch curFil13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
		Endif
		c13Fil += "while (@@fetch_Status = 0) begin "  +CRLF
		c13Fil += "      select @iNroRegs = @iNroRegs + 1"+CRLF
		c13Fil += "      If @iNroRegs = 1 begin"+CRLF 
		If !("MSSQL"$tcGetDB())
	   		c13Fil += "         Begin Transaction"+CRLF 
	 	Endif
		c13Fil += "         Select @iNroRegs = @iNroRegs"+CRLF
		c13Fil += "      End"+CRLF
		c13Fil += "					select @MaxRecno = isnull( max( R_E_C_N_O_ ), 1) from " + RetSqlName("SRZ") +CRLF 	
		c13Fil += "					Select  @MaxRecno =  @MaxRecno + 1" +CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			c13Fil += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, RZ_ITEM,RZ_CLVL, " + cRecno + ")" +CRLF
			c13Fil += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ, @MaxRecno )" +CRLF  
		Else
			c13Fil += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, " + cRecno + ")" +CRLF
		   	c13Fil += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @MaxRecno )" +CRLF  
		Endif   
		c13Fil += "      If @iNroRegs = 1024 begin"+CRLF
		If !("MSSQL"$tcGetDB())
	   		c13Fil += "         Commit Transaction"+CRLF
	   	Endif
		c13Fil += "         select @iNroRegs = 0"+CRLF
		c13Fil += "      End"+CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	   		c13Fil += "fetch curFil13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
		Else
			c13Fil += "fetch curFil13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
		Endif
		c13Fil += "End"  +CRLF  
		c13Fil += "   If @iNroRegs > 0  begin"+CRLF  
		c13Fil +=	"		select @iNroRegs = 0"+CRLF
	 	c13Fil += "      Select @iTranCount  = 0"+CRLF 
		If !("MSSQL"$tcGetDB())
			c13Fil += "      Commit Transaction "+CRLF 
		Endif
		c13Fil += "   End"+CRLF
		c13Fil += "Close curFil13"  +CRLF  
		c13Fil += "Deallocate curFil13"  +CRLF
	Endif
		
	cFim := "End "  +CRLF 
		 
	//SOMATORIA POR CENTRO DE CUSTO 
	cIni := "Begin "  +CRLF

	If lFolPgto
		cFlCc += "Declare curCC insensitive cursor for"  +CRLF 
		cFlCc += "SELECT DISTINCT RC_FILIAL as RZ_FILIAL,"  +CRLF 
		cFlCc += "RC_CC as RZ_CC,"  +CRLF  
		cFlCc += "'zzzzzz' as RZ_MAT, "  +CRLF 
		cFlCc += "RC_PD as RZ_PD, "  +CRLF 
		cFlCc += "SUM(RC_HORAS) as RZ_HRS, "  +CRLF 
		cFlCc += "SUM(RC_VALOR) as RZ_VAL,"  +CRLF  
		cFlCc += "COUNT( RC_PD ) RZ_OCORREN, "  +CRLF 
		cFlCc += "'FL' as RZ_TIPO, " +CRLF
		cFlCc += "RA_TPCONTR as RZ_TPC "  
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cFlCc += ", RC_ITEM,RC_CLVL " +CRLF
		Endif
		cFlCc += "FROM " + cAliasSRA + " SRA," + cAliasSRC + " SRC " +CRLF  
		cFlCc += "WHERE RC_FILIAL   >='"+ cFilDe +"'" + " AND"  +CRLF       
		cFlCc += "RC_FILIAL   <='"+ cFilAte+"'" + " AND"  +CRLF       
		cFlCc += "SRC." + cDel + " AND "  +CRLF     
		cFlCc += "SRA." + cDel + " AND "  +CRLF
		cFlCc += "RC_FILIAL = RA_FILIAL AND RC_MAT = RA_MAT "  +CRLF 
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC 
		  	cFlCc += "GROUP BY RC_FILIAL, RC_CC, RC_PD, RA_TPCONTR, RC_ITEM,RC_CLVL"  +CRLF
		Else
	   		cFlCc += "GROUP BY RC_FILIAL, RC_CC, RC_PD, RA_TPCONTR"  +CRLF
		Endif
		cFlCc += "ORDER BY 1, 2, 4, 9 " +CRLF  
		cFlCc += "OPEN curCC"  +CRLF 
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	   		cFlCc += "fetch curCC into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
		Else
			cFlCc += "fetch curCC into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
		Endif
		cFlCc += "while (@@fetch_Status = 0) begin "  +CRLF
	    cFlCc += "      select @iNroRegs = @iNroRegs + 1"+CRLF
		cFlCc += "      If @iNroRegs = 1 begin"+CRLF
		If !("MSSQL"$tcGetDB())
	   		cFlCc += "         Begin Transaction"+CRLF
		Endif
		cFlCc += "         Select @iNroRegs = @iNroRegs"+CRLF
		cFlCc += "      End"+CRLF
		cFlCc += "					select @MaxRecno = isnull( max( R_E_C_N_O_ ), 1) from " + RetSqlName("SRZ") +CRLF 	
		cFlCc += "					Select  @MaxRecno =  @MaxRecno + 1" +CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cFlCc += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, RZ_ITEM,RZ_CLVL, " + cRecno + ")" +CRLF
			cFlCc += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ, @MaxRecno )" +CRLF  
		Else
			cFlCc += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, " + cRecno + ")" +CRLF
		   	cFlCc += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @MaxRecno )" +CRLF  
		Endif  

//Commit a cada 1024 linhas

		cFlCc += "      If @iNroRegs = 1024 begin"+CRLF 
		If !("MSSQL"$tcGetDB())
			cFlCc += "         Commit Transaction"+CRLF 
	    Endif
		cFlCc += "         select @iNroRegs = 0"+CRLF
		cFlCc += "      End"+CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	   		cFlCc += "fetch curCC into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
		Else
			cFlCc += "fetch curCC into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
		Endif
		cFlCc += "End"  +CRLF  
		cFlCc += "   If @iNroRegs > 0  begin"+CRLF 
		cFlCc += "		select @iNroRegs = 0"+CRLF
		cFlCc += "      select @iTranCount = 0"+CRLF 
		If !("MSSQL"$tcGetDB())
	    	cFlCc += "      Commit Transaction"+CRLF  
	 	Endif
		cFlCc += "   End"+CRLF 
		cFlCc += "Close curCC"  +CRLF 
		cFlCc += "Deallocate curCC"  +CRLF  
		
	Endif

	If lFol13Sl
		c13cc += "Declare curCC13 insensitive cursor for"  +CRLF 
		c13cc += "SELECT DISTINCT RI_FILIAL as RZ_FILIAL,"  +CRLF 
		c13cc += "RI_CC as RZ_CC,"  +CRLF  
		c13cc += "'zzzzzz' as RZ_MAT, "  +CRLF 
		c13cc += "RI_PD as RZ_PD, "  +CRLF 
		c13cc += "SUM(RI_HORAS) as RZ_HRS, "  +CRLF 
		c13cc += "SUM(RI_VALOR) as RZ_VAL,"  +CRLF  
		c13cc += "COUNT( RI_PD ) RZ_OCORREN, "  +CRLF 
		c13cc += "'13' as RZ_TIPO, " +CRLF
		c13cc += "RA_TPCONTR as RZ_TPC " 
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			c13cc += ", RI_ITEM,RI_CLVL " +CRLF
		Endif
		c13cc += "FROM " + cAliasSRA + " SRA," + cAliasSRI + " SRI " +CRLF  
		c13cc += "WHERE RI_FILIAL   >='"+ cFilDe +"'" + " AND"  +CRLF       
		c13cc += "RI_FILIAL   <='"+ cFilAte+"'" + " AND"  +CRLF       
		c13cc += "SRI." + cDel + " AND "  +CRLF  
		c13cc += "SRA." + cDel + " AND "  +CRLF
		c13cc += "RI_FILIAL = RA_FILIAL AND RI_MAT = RA_MAT "  +CRLF 
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC 
			c13cc += "GROUP BY RI_FILIAL, RI_CC, RI_PD, RA_TPCONTR, RI_ITEM,RI_CLVL "  +CRLF
		Else
			c13cc += "GROUP BY RI_FILIAL, RI_CC, RI_PD, RA_TPCONTR"+CRLF
		Endif
		c13cc += "ORDER BY 1, 2, 4, 9 " +CRLF  
		c13cc += "OPEN curCC13"  +CRLF 
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	   		c13cc += "fetch curCC13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
		Else
			c13cc += "fetch curCC13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
		Endif
		c13cc += "while (@@fetch_Status = 0) begin "  +CRLF
   		c13cc += "      select @iNroRegs = @iNroRegs + 1"+CRLF
		c13cc += "      If @iNroRegs = 1 begin"+CRLF
		If !("MSSQL"$tcGetDB())
	   		c13cc += "         Begin Transaction"+CRLF   
	   	Endif
		c13cc += "         Select @iNroRegs = @iNroRegs"+CRLF
		c13cc += "      End"+CRLF
		c13cc += "					select @MaxRecno = isnull( max( R_E_C_N_O_ ), 1) from " + RetSqlName("SRZ") +CRLF 	
		c13cc += "					Select  @MaxRecno =  @MaxRecno + 1" +CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			c13cc += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, RZ_ITEM,RZ_CLVL, " + cRecno + ")" +CRLF
			c13cc += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC,  @lTemItemRZ, @lTemClVlRZ, @MaxRecno )" +CRLF  
		Else
			c13cc += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, " + cRecno + ")" +CRLF
		   	c13cc += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @MaxRecno )" +CRLF  
		Endif

//Commit a cada 1024 linhas

		c13cc += "      If @iNroRegs = 1024 begin"+CRLF
		If !("MSSQL"$tcGetDB())
			c13cc += "         Commit Transaction"+CRLF    
		Endif
		c13cc += "         select @iNroRegs = 0"+CRLF
		c13cc += "      End"+CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	   		c13cc += "fetch curCC13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
		Else
			c13cc += "fetch curCC13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
		Endif
		c13cc += "End"  +CRLF  
		c13cc += "   If @iNroRegs > 0  begin"+CRLF  
		c13cc += "		select @iNroRegs = 0"+CRLF
		c13cc += "      select @iTranCount = 0"+CRLF
	   	If !("MSSQL"$tcGetDB())
			c13cc += "      Commit Transaction"+CRLF        
		Endif
		c13cc += "   End"+CRLF 
		c13cc += "Close curCC13"  +CRLF 
		c13cc += "Deallocate curCC13"  +CRLF
	Endif 
	
	cFim := "End "  +CRLF 
	
	//SOMATORIO POR EMPRESA
	cIni := "Begin "  +CRLF
	
	If lFolPgto
		cFlEmp := "Declare curEmp insensitive cursor for"  +CRLF
		cFlEmp += "SELECT DISTINCT "  +CRLF 
		cFlEmp += "'zz' as RZ_FILIAL,"  +CRLF 
		cFlEmp += "'zzzzzzzzz' as RZ_CC,"  +CRLF   
		cFlEmp += "'zzzzzz' as RZ_MAT, "  +CRLF 
		cFlEmp += "RC_PD as RZ_PD, "  +CRLF 
		cFlEmp += "SUM(RC_HORAS) as RZ_HRS, "  +CRLF 
		cFlEmp += "SUM(RC_VALOR) as RZ_VAL, "  +CRLF 
		cFlEmp += "COUNT( RC_PD ) RZ_OCORREN, "  +CRLF 
		cFlEmp += "'FL' as RZ_TIPO, " +CRLF
		cFlEmp += "RA_TPCONTR as RZ_TPC " 
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
				cFlEmp += ", RC_ITEM,RC_CLVL " +CRLF
		Endif
		cFlEmp += "FROM " + cAliasSRA + " SRA," + cAliasSRC + " SRC" +CRLF  
		cFlEmp += "WHERE "+CRLF  
		cFlEmp += "RC_FILIAL   >='"+ cFilDe +"'" + " AND"  +CRLF       
		cFlEmp += "RC_FILIAL   <='"+ cFilAte+"'" + " AND"  +CRLF       
		cFlEmp += "SRC." + cDel + " AND"  +CRLF 
		cFlEmp += "SRA." + cDel + " AND "  +CRLF 
		cFlEmp += "RC_FILIAL = RA_FILIAL AND "  +CRLF
		cFlEmp += "RC_MAT = RA_MAT "  +CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cFlEmp += "GROUP BY RC_PD, RA_TPCONTR, RC_ITEM, RC_CLVL "  +CRLF
		Else
			cFlEmp += "GROUP BY RC_PD, RA_TPCONTR "  +CRLF
		Endif
		cFlEmp += "ORDER BY 1, 2, 4, 9 " +CRLF
		cFlEmp += "OPEN curEmp"  +CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	   		cFlEmp += "fetch curEmp into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
		Else
			cFlEmp += "fetch curEmp into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
		Endif
		cFlEmp += "while (@@fetch_Status = 0) begin "  +CRLF
		cFlEmp += "      select @iNroRegs = @iNroRegs + 1"+CRLF
		cFlEmp += "      If @iNroRegs = 1 begin"+CRLF
		If !("MSSQL"$tcGetDB())
			cFlEmp += "         Begin Transaction"+CRLF   
		Endif
		cFlEmp += "         Select @iNroRegs = @iNroRegs"+CRLF
		cFlEmp += "      End"+CRLF
		cFlEmp += "					select @MaxRecno = isnull( max( R_E_C_N_O_ ), 1) from " + RetSqlName("SRZ") +CRLF 	
		cFlEmp += "					Select  @MaxRecno =  @MaxRecno + 1" +CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cFlEmp += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, RZ_ITEM,RZ_CLVL, " + cRecno + ")" +CRLF
		   	cFlEmp += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ, @MaxRecno )" +CRLF  
		Else
			cFlEmp += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, " + cRecno + ")" +CRLF
		   	cFlEmp += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @MaxRecno )" +CRLF  
		Endif	   

//Commit a cada 1024 linhas

		cFlEmp += "      If @iNroRegs = 1024 begin"+CRLF
		If !("MSSQL"$tcGetDB())
			cFlEmp += "         Commit Transaction"+CRLF
		Endif
		cFlEmp += "         select @iNroRegs = 0"+CRLF
		cFlEmp += "      End"+CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	   		cFlEmp += "fetch curEmp into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
		Else
			cFlEmp += "fetch curEmp into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
		Endif
		cFlEmp += "End"  +CRLF  
		cFlEmp += "   If @iNroRegs > 0  begin"+CRLF
	   	cFlEmp +=	"		select @iNroRegs = 0"+CRLF
	   	cFlEmp += "      select @iTranCount = 0"+CRLF
	   	If !("MSSQL"$tcGetDB()) 
	   		cFlEmp += "      Commit Transaction"+CRLF       
	   	Endif
	   	cFlEmp += "   End"+CRLF 
		cFlEmp += "Close curEmp"  +CRLF
		cFlEmp += "Deallocate curEmp"  +CRLF
	Endif
	
	If lFol13Sl
   		c13Emp := "Declare curEmp13 insensitive cursor for"  +CRLF
		c13Emp += "SELECT "  +CRLF 
		c13Emp += "'zz' as RZ_FILIAL,"  +CRLF 
		c13Emp += "'zzzzzzzzz' as RZ_CC,"  +CRLF   
		c13Emp += "'zzzzzz' as RZ_MAT, "  +CRLF 
		c13Emp += "RI_PD as RZ_PD, "  +CRLF 
		c13Emp += "SUM(RI_HORAS) as RZ_HRS, "  +CRLF 
		c13Emp += "SUM(RI_VALOR) as RZ_VAL, "  +CRLF 
		c13Emp += "COUNT( RI_PD ) RZ_OCORREN, "  +CRLF 
		c13Emp += "'13' as RZ_TIPO, " +CRLF
		c13Emp += "RA_TPCONTR as RZ_TPC "   
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			c13Emp += ", RI_ITEM,RI_CLVL " +CRLF
		Endif
		c13Emp += "FROM " + cAliasSRA + " SRA," + cAliasSRI + " SRI" +CRLF  
		c13Emp += "WHERE "
		c13Emp += "RI_FILIAL   >='"+ cFilDe +"'" + " AND"  +CRLF       
		c13Emp += "RI_FILIAL   <='"+ cFilAte+"'" + " AND"  +CRLF       
		c13Emp += "SRI." + cDel + " AND"  +CRLF  
		c13Emp += "SRA." + cDel + " AND "  +CRLF
		c13Emp += "RI_FILIAL = RA_FILIAL AND "  +CRLF
		c13Emp += "RI_MAT = RA_MAT "  +CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			c13Emp += "GROUP BY RI_PD, RA_TPCONTR, RI_ITEM,RI_CLVL "  +CRLF
		Else
			c13Emp += "GROUP BY RI_PD, RA_TPCONTR "  +CRLF
		Endif 
		c13Emp += "ORDER BY 1, 2, 4, 9 " +CRLF
		c13Emp += "OPEN curEmp13"  +CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	   		c13Emp += "fetch curEmp13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
		Else
			c13Emp += "fetch curEmp13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
		Endif
		c13Emp += "while (@@fetch_Status = 0) begin "  +CRLF
   		c13Emp += "      select @iNroRegs = @iNroRegs + 1"+CRLF
		c13Emp += "      If @iNroRegs = 1 begin"+CRLF
		If !("MSSQL"$tcGetDB())
			c13Emp += "         Begin Transaction"+CRLF
		Endif
		c13Emp += "         Select @iNroRegs = @iNroRegs"+CRLF
		c13Emp += "      End"+CRLF
		c13Emp += "					select @MaxRecno = isnull( max( R_E_C_N_O_ ), 1) from " + RetSqlName("SRZ") +CRLF 	
		c13Emp += "					Select  @MaxRecno =  @MaxRecno + 1" +CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			c13Emp += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, RZ_ITEM,RZ_CLVL, " + cRecno + ")" +CRLF
		   	c13Emp += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ, @MaxRecno )" +CRLF  
		Else
			c13Emp += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, " + cRecno + ")" +CRLF
		   	c13Emp += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @MaxRecno )" +CRLF  
		Endif	   

//Commit a cada 1024 linhas

		c13Emp += "      If @iNroRegs = 1024 begin"+CRLF
		If !("MSSQL"$tcGetDB())
	   		c13Emp += "         Commit Transaction"+CRLF 
		Endif
		c13Emp += "         select @iNroRegs = 0"+CRLF
		c13Emp += "      End"+CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	   		c13Emp += "fetch curEmp13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
		Else
			c13Emp += "fetch curEmp13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
		Endif
		c13Emp += "End"  +CRLF  
		c13Emp += "   If @iNroRegs > 0  begin"+CRLF 
	   	c13Emp +=	"		select @iNroRegs = 0"+CRLF
		c13Emp += "      select @iTranCount = 0"+CRLF
	   	If !("MSSQL"$tcGetDB())
			c13Emp += "      Commit Transaction"+CRLF 
		Endif
		c13Emp += "   End"+CRLF 
		c13Emp += "Close curEmp13"  +CRLF
		c13Emp += "Deallocate curEmp13"  +CRLF 
	Endif
	
	cFim := "End "  +CRLF
		
	//TOTAL DE FUNCIONARIOS POR CENTRO DE CUSTO
	cIni := "Begin "  +CRLF
	If lFolPgto
		cFlFunCc += "Declare curFunCDC insensitive cursor for"  +CRLF
		cFlFunCc += "SELECT DISTINCT "  +CRLF 
		cFlFunCc += "RC_FILIAL RZ_FILIAL,"  +CRLF 
		cFlFunCc += "RC_CC RZ_CC,"  +CRLF 
		cFlFunCc += "'zzzzzz' as RZ_MAT,"  +CRLF 
		cFlFunCc += "'zzz' as RZ_PD,"  +CRLF 
		cFlFunCc += "0 RZ_HRS,"  +CRLF 
		cFlFunCc += "0 RZ_VAL,"  +CRLF 
		cFlFunCc += "COUNT(DISTINCT  RC_MAT) RZ_OCORREN,"  +CRLF 
		cFlFunCc += "'FL' as RZ_TIPO, " +CRLF
		cFlFunCc +="RA_TPCONTR as RZ_TPC " 
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cFlFunCc += ", RC_ITEM,RC_CLVL " +CRLF
		Endif
		cFlFunCc += "FROM " + cAliasSRA + " SRA," + cAliasSRC + " SRC" +CRLF 
		cFlFunCc += "WHERE RC_FILIAL   >='"+ cFilDe +"'" + " AND"  +CRLF       
		cFlFunCc += "RC_FILIAL   <='"+ cFilAte+"'" + " AND"  +CRLF       
		cFlFunCc += "SRC." + cDel + " AND "  +CRLF
		cFlFunCc += "SRA." + cDel + " AND "  +CRLF 
		cFlFunCc += "RC_FILIAL = RA_FILIAL AND "  +CRLF
		cFlFunCc += "RC_MAT = RA_MAT "  +CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cFlFunCc += "GROUP BY RC_FILIAL, RC_CC, RA_TPCONTR, RC_ITEM, RC_CLVL "  +CRLF
		Else
			cFlFunCc += "GROUP BY RC_FILIAL, RC_CC, RA_TPCONTR "  +CRLF
		Endif  
		cFlFunCc += "ORDER BY 1, 2, 4, 9 " +CRLF
		cFlFunCc += "OPEN curFunCDC"  +CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	   		cFlFunCc += "fetch curFunCDC into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
		Else
			cFlFunCc += "fetch curFunCDC into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
		Endif
		cFlFunCc += "while (@@fetch_Status = 0) begin "  +CRLF 
		cFlFunCc += "      select @iNroRegs = @iNroRegs + 1"+CRLF
		cFlFunCc += "      If @iNroRegs = 1 begin"+CRLF 
		If !("MSSQL"$tcGetDB())
			cFlFunCc += "         Begin Transaction"+CRLF
	   	Endif
		cFlFunCc += "         Select @iNroRegs = @iNroRegs"+CRLF
		cFlFunCc += "      End"+CRLF
		cFlFunCc += "					select @MaxRecno = isnull( max( R_E_C_N_O_ ), 1) from " + RetSqlName("SRZ") +CRLF 	
		cFlFunCc += "					Select  @MaxRecno =  @MaxRecno + 1" +CRLF   
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cFlFunCc += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, RZ_ITEM,RZ_CLVL, " + cRecno + ")" +CRLF
		   	cFlFunCc += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC,  @lTemItemRZ, @lTemClVlRZ, @MaxRecno )" +CRLF  
		Else
			cFlFunCc += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, " + cRecno + ")" +CRLF
		   	cFlFunCc += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @MaxRecno )" +CRLF  
		Endif	   

//Commit a cada 1024 linhas

		cFlFunCc += "      If @iNroRegs = 1024 begin"+CRLF
	   	If !("MSSQL"$tcGetDB())
			cFlFunCc += "         Commit Transaction"+CRLF  
	   	Endif
		cFlFunCc += "         select @iNroRegs = 0"+CRLF
		cFlFunCc += "      End"+CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	   		cFlFunCc += "fetch curFunCDC into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
		Else
			cFlFunCc += "fetch curFunCDC into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
		Endif
		cFlFunCc += "End"  +CRLF
		cFlFunCc += "   If @iNroRegs > 0  begin"+CRLF 
		cFlFunCc +=	"	 select @iNroRegs = 0"+CRLF
		cFlFunCc += "      select @iTranCount = 0"+CRLF
		If !("MSSQL"$tcGetDB()) 
			cFlFunCc += "      Commit Transaction"+CRLF     
		Endif
		cFlFunCc += "   End"+CRLF 
		cFlFunCc += "Close curFunCDC"  +CRLF
		cFlFunCc += "Deallocate curFunCDC"  +CRLF
	Endif
	
	If lFol13Sl
   		c13FunCc += "Declare curFunCDC13 insensitive cursor for"  +CRLF
		c13FunCc += "SELECT DISTINCT "  +CRLF 
		c13FunCc += "RI_FILIAL RZ_FILIAL,"  +CRLF 
		c13FunCc += "RI_CC RZ_CC,"  +CRLF 
		c13FunCc += "'zzzzzz' as RZ_MAT,"  +CRLF 
		c13FunCc += "'zzz' as RZ_PD,"  +CRLF 
		c13FunCc += "0 RZ_HRS,"  +CRLF 
		c13FunCc += "0 RZ_VAL,"  +CRLF 
		c13FunCc += "COUNT(DISTINCT  RI_MAT) RZ_OCORREN,"  +CRLF 
		c13FunCc += "'13' as RZ_TIPO," +CRLF
		c13FunCc += "RA_TPCONTR as RZ_TPC " 
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			c13FunCc += ", RI_ITEM,RI_CLVL " +CRLF
		Endif
		c13FunCc += "FROM " + cAliasSRA + " SRA," + cAliasSRI + " SRI" +CRLF 
		c13FunCc += "WHERE RI_FILIAL   >='"+ cFilDe +"'" + " AND"  +CRLF       
		c13FunCc += "RI_FILIAL   <='"+ cFilAte+"'" + " AND"  +CRLF       
		c13FunCc += "SRI." + cDel + " AND "  +CRLF 
		c13FunCc += "SRA." + cDel + " AND "  +CRLF
		c13FunCc += "RI_FILIAL = RA_FILIAL AND "  +CRLF
		c13FunCc += "RI_MAT = RA_MAT "  +CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			c13FunCc += "GROUP BY RI_FILIAL, RI_CC, RA_TPCONTR, RI_ITEM,RI_CLVL "  +CRLF
		Else
			c13FunCc += "GROUP BY RI_FILIAL, RI_CC, RA_TPCONTR "  +CRLF
		Endif 
		c13FunCc += "ORDER BY 1, 2, 4, 9 " +CRLF
		c13FunCc += "OPEN curFunCDC13"  +CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	   		c13FunCc += "fetch curFunCDC13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
		Else
			c13FunCc += "fetch curFunCDC13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
		Endif
		c13FunCc += "while (@@fetch_Status = 0) "  +CRLF
		c13FunCc += "	begin "+CRLF
		c13FunCc += "		select @iNroRegs = @iNroRegs + 1"+CRLF
		c13FunCc += "      	If @iNroRegs = 1 begin"+CRLF 
		If !("MSSQL"$tcGetDB())
			c13FunCc += "		Begin Transaction"+CRLF   
	   	Endif
		c13FunCc += "		Select @iNroRegs = @iNroRegs"+CRLF
		c13FunCc += "		End"+CRLF
		c13FunCc += "					select @MaxRecno = isnull( max( R_E_C_N_O_ ), 1) from " + RetSqlName("SRZ") +CRLF 	
		c13FunCc += "					Select  @MaxRecno =  @MaxRecno + 1" +CRLF     
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			c13FunCc += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, RZ_ITEM,RZ_CLVL, " + cRecno + ")" +CRLF
		   	c13FunCc += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ, @MaxRecno )" +CRLF  
		Else
			c13FunCc += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, " + cRecno + ")" +CRLF
		   	c13FunCc += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @MaxRecno )" +CRLF  
		Endif		
		c13FunCc += "      If @iNroRegs = 1024 begin"+CRLF
		If !("MSSQL"$tcGetDB())
			c13FunCc += "         Commit Transaction"+CRLF  
	   	Endif
		c13FunCc += "         select @iNroRegs = 0"+CRLF
		c13FunCc += "      End"+CRLF
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	   		c13FunCc += "fetch curFunCDC13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
		Else
			c13FunCc += "fetch curFunCDC13 into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
		Endif
		c13FunCc += "End"  +CRLF
		c13FunCc += "   If @iNroRegs > 0  begin"+CRLF
		c13FunCc +=	"		select @iNroRegs = 0"+CRLF  
		c13FunCc += "      select @iTranCount = 0"+CRLF
		If !("MSSQL"$tcGetDB())
			c13FunCc += "      Commit Transaction"+CRLF   
		Endif
  		c13FunCc += "   End"+CRLF 
		c13FunCc += "Close curFunCDC13"  +CRLF
		c13FunCc += "Deallocate curFunCDC13"  +CRLF     
	Endif 

   	cFim := "End "  +CRLF
   	
   	If len(aGPSVal) > 0 
		cParam15 := "begin"  +CRLF  
		cParam15 += "Declare curParam insensitive cursor for"  +CRLF  
		cParam15 += "SELECT"  +CRLF 
		cParam15 += "TMPFILIAL RZ_FILIAL,"  +CRLF 
		cParam15 += "TMPCC RZ_CC,"  +CRLF 
		cParam15 += "TMPMAT as RZ_MAT,"  +CRLF 
		cParam15 += "TMPPD as RZ_PD,"  +CRLF 
		cParam15 += "TMPHRS RZ_HRS,"  +CRLF 
		cParam15 += "TMPVAL RZ_VAL,"  +CRLF 
		cParam15 += "TMPOCORREN RZ_OCORREN,"  +CRLF 
		cParam15 += "TMPTIPO as RZ_TIPO, " +CRLF
		cParam15 += "TMPTPC as RZ_TPC " 
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cParam15 += ", ' ' RC_ITEM,' ' RC_CLVL " +CRLF
		Endif
		cParam15 += "FROM " +  ctableTmp  +CRLF 
		cParam15 += "	WHERE TMPFILIAL   >='"+ cFilDe +"'" + " AND "  +CRLF       
		cParam15 += "	TMPFILIAL   <='"+ cFilAte+"'" + " AND "  +CRLF       
		cParam15 += 	cDel  +CRLF 
		cParam15 += "ORDER BY 1, 2, 4, 9 " +CRLF
		cParam15 += "open curParam"  +CRLF  
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
   					cParam15 += "fetch curParam into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
		Else
			cParam15 += "fetch curParam into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
		Endif
		cParam15 += "   while (@@fetch_Status = 0) begin "  +CRLF
		cParam15 += "	Select  @MaxRecno =  Isnull(Max(" + cRecno + "),1) from " +  cAliasSRZ +CRLF   
		cParam15 += "	Select  @MaxRecno =  @MaxRecno + 1" +CRLF 
		If !("MSSQL"$tcGetDB())
			cParam15 += "		Begin Transaction"  +CRLF     
		Endif
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cParam15 += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, RZ_ITEM,RZ_CLVL, " + cRecno + ")" +CRLF
   			cParam15 += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC,  @lTemItemRZ, @lTemClVlRZ, @MaxRecno )" +CRLF  
   		If !("MSSQL"$tcGetDB())
			cParam15 += "		Commit Transaction"  +CRLF    
		Endif
   			cParam15 += "Fetch  curParam into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ"  +CRLF  
   		Else
	   		cParam15 += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, " + cRecno + ")" +CRLF
   			cParam15 += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @MaxRecno )" +CRLF
		If !("MSSQL"$tcGetDB())
			cParam15 += "		Commit Transaction"  +CRLF    
		Endif
   			cParam15 += "Fetch  curParam into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC"  +CRLF    
		Endif					
		cParam15 += "End"  +CRLF
		cParam15 += "close curParam"  +CRLF
		cParam15 += "deallocate curParam"  +CRLF   
		cParam15 += "end"  +CRLF
		
		cParam15 += "begin"  +CRLF  
		cParam15 += "declare curTotParam insensitive cursor for"  +CRLF  
		cParam15 += "select	tmpFILIAL, "  +CRLF
		cParam15 += "'zzzzzzzzz' as tmpCC,"  +CRLF
		cParam15 += "'zzzzzz' as tmpMAT,"  +CRLF
		cParam15 += "tmpPD,"  +CRLF
		cParam15 += "0 AS tmpHRS,"  +CRLF
		cParam15 += "Sum(tmpVal) as tmpVal,"  +CRLF
		cParam15 += "1 AS tmpOCORREN,"  +CRLF
		cParam15 += "'FL' AS tmpTIPO,"  +CRLF
		cParam15 += "tmpTpc AS tmpTPC"   +CRLF
		cParam15 += "from TBLRXTMP"  +CRLF
		cParam15 += "group by tmpFILIAL, tmpPD,tmpHRS,tmpOCORREN,tmpTIPO,tmpTPC"  +CRLF
		cParam15 += "union "+CRLF
		cParam15 += "Select 'zz' as tmpFILIAL, "  +CRLF
		cParam15 += "'zzzzzzzzz' as tmpCC,"  +CRLF
		cParam15 += "'zzzzzz' as tmpMAT,"  +CRLF
		cParam15 += "tmpPD,"  +CRLF
		cParam15 += "0 AS tmpHRS,"  +CRLF
		cParam15 += "Sum(tmpVal) as tmpVal,"  +CRLF
		cParam15 += "1 AS tmpOCORREN,"  +CRLF
		cParam15 += "'FL' AS tmpTIPO,"  +CRLF
		cParam15 += "tmpTpc AS tmpTPC"   +CRLF
		cParam15 += "from TBLRXTMP"  +CRLF
		cParam15 += "group by tmpPD,tmpHRS,tmpOCORREN,tmpTIPO,tmpTPC"  +CRLF  
		cParam15 += "ORDER BY 1, 2, 4, 9 " +CRLF
		cParam15 += "open curTotParam"  +CRLF  
		cParam15 += "fetch curTotParam into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
		cParam15 += "while (@@fetch_Status = 0) begin "  +CRLF
		cParam15 += "Select  @MaxRecno =  @MaxRecno + 1" +CRLF     
		If !("MSSQL"$tcGetDB())
			cParam15 += "		Begin Transaction"  +CRLF
		Endif
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cParam15 += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, RZ_ITEM,RZ_CLVL, " + cRecno + ")" +CRLF
   			cParam15 += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC,  ' ' , ' ', @MaxRecno )" +CRLF  
   		If !("MSSQL"$tcGetDB())
			cParam15 += "		Commit Transaction"  +CRLF    
		Endif
   			cParam15 += "Fetch  curTotParam into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC"  +CRLF  
   		Else
	   		cParam15 += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, " + cRecno + ")" +CRLF
   			cParam15 += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @MaxRecno )" +CRLF
   		If !("MSSQL"$tcGetDB())
			cParam15 += "		Commit Transaction"  +CRLF    
		Endif
   			cParam15 += "Fetch  curTotParam into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC"  +CRLF    
		Endif

		cParam15 += "End"  +CRLF
		cParam15 += "close curTotParam"  +CRLF
		cParam15 += "deallocate curTotParam"  +CRLF   
		cParam15 += "end"  +CRLF
	Endif 
	


	//TOTAL GERAL DE FUNCIONARIOS 
	cProcTotFun := "begin "  +CRLF
	cProcTotFun += "declare curFunGer insensitive cursor for"  +CRLF
	cProcTotFun += "Select distinct "  +CRLF 
	cProcTotFun += "RZ_FILIAL,"  +CRLF
	cProcTotFun += "'zzzzzzzzz' as RZ_CC,"  +CRLF  
	cProcTotFun += "'zzzzzz' as RZ_MAT,"  +CRLF
	cProcTotFun += "'zzz' as RZ_PD, "  +CRLF 
	cProcTotFun += "0 RZ_HRS, "  +CRLF
	cProcTotFun += "0 RZ_VAL,"  +CRLF 
	cProcTotFun += "SUM(RZ_OCORREN) RZ_OCORREN,"  +CRLF
	cProcTotFun += "RZ_TIPO, " +CRLF
	cProcTotFun += "'"+AllTrim(str(nTpContr))+"'" + "  as RZ_TPC " 
	If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
		cProcTotFun += ", ' ' RZ_ITEM,' ' RZ_CLVL " +CRLF
	Endif
	cProcTotFun += "from " + cAliasSRZ + " SRZ" +CRLF
	cProcTotFun += "where RZ_PD = 'zzz' AND"  +CRLF
	cProcTotFun += "RZ_FILIAL <> 'zz'"  +CRLF
	cProcTotFun += "group by RZ_FILIAL, RZ_TIPO"  +CRLF


	//	ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//	³ Verifica se existem funcionarios com    							  ³
	//	³ mais de um tipo de contrato no SRZ.  								  ³
	//	³ Caso existir, adiciona um registro com tipo de contrato 2 no SRZ,  -³
	//	ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ     
	
	cQuery	:= "SELECT COUNT(DISTINCT RA_TPCONTR) NLASTREC " 
	cQuery	+= "FROM " + RetSqlName("SRA") + " SRA "
	cQuery	+= "WHERE RA_TPCONTR IN('1','2')  AND  SRA." + cDel
	cQuery	:= ChangeQuery( cQuery )  
	IF ( MsOpenDbf(.T.,"TOPCONN",TcGenQry(,,cQuery),"__QRYCOUNT",.T.,.T.) )
		nRegProc := __QRYCOUNT->NLASTREC
		__QRYCOUNT->( dbCloseArea() )
	Endif 	  
	
	If nRegProc > 1
		cProcTotFun += "union "  +CRLF 
		cProcTotFun += "Select distinct "  +CRLF 
		cProcTotFun += "RZ_FILIAL,"  +CRLF
		cProcTotFun += "'zzzzzzzzz'  as RZ_CC,"  +CRLF  
		cProcTotFun += "'zzzzzz' as RZ_MAT,"  +CRLF
		cProcTotFun += "'zzz' as RZ_PD, "  +CRLF 
		cProcTotFun += "0 RZ_HRS, "  +CRLF
		cProcTotFun += "0 RZ_VAL,"  +CRLF 
		cProcTotFun += "COUNT(DISTINCT RZ_OCORREN) RZ_OCORREN,"  +CRLF
		cProcTotFun += "RZ_TIPO, " +CRLF
		cProcTotFun +="'2' as RZ_TPC " 
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cProcTotFun += ", ' ' RZ_ITEM,' ' RZ_CLVL " +CRLF
		Endif
		cProcTotFun += "from " + cAliasSRZ + " SRZ" +CRLF
		cProcTotFun += "where RZ_PD = 'zzz' AND"  +CRLF
		cProcTotFun += "RZ_FILIAL <> 'zz'"  +CRLF
		cProcTotFun += "group by RZ_FILIAL, RZ_TIPO"  +CRLF 
	Endif
	
	
	cProcTotFun += "union "  +CRLF
	cProcTotFun += "Select distinct "  +CRLF 
	cProcTotFun += "'zz' as RZ_FILIAL,"  +CRLF
 	cProcTotFun += "RZ_TIPO  RZ_CC, " +CRLF
	cProcTotFun += "'      ' as RZ_MAT,"  +CRLF  
	cProcTotFun += "'   ' as RZ_PD,"  +CRLF 
	cProcTotFun += "0 RZ_HRS, "  +CRLF
	cProcTotFun += "0 RZ_VAL, "  +CRLF
	cProcTotFun += "0 RZ_OCORREN,"  +CRLF
	cProcTotFun += "RZ_TIPO, " +CRLF
	cProcTotFun += "'"+AllTrim(str(nTpContr))+"'" + " as RZ_TPC " 
	If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
		cProcTotFun += ", ' ' RZ_ITEM,' ' RZ_CLVL " +CRLF
	Endif
	cProcTotFun += "from " + cAliasSRZ + " SRZ " +CRLF
	cProcTotFun += "where RZ_PD = 'zzz' AND "  +CRLF
	cProcTotFun += "RZ_FILIAL <> 'zz'"  +CRLF
	cProcTotFun += "group by RZ_FILIAL, RZ_TIPO"  +CRLF
	cProcTotFun += "union "  +CRLF
	cProcTotFun += "Select distinct "  +CRLF 
	cProcTotFun += "'zz' as RZ_FILIAL,"  +CRLF 
 	cProcTotFun += "RZ_TIPO  RZ_CC, " +CRLF
	cProcTotFun += "'      ' as RZ_MAT,"  +CRLF  
	cProcTotFun += "'   ' as RZ_PD,"  +CRLF 
	cProcTotFun += "0 RZ_HRS, "  +CRLF
	cProcTotFun += "0 RZ_VAL, "  +CRLF
	cProcTotFun += "0 RZ_OCORREN,"  +CRLF
	cProcTotFun += "RZ_TIPO, " +CRLF
	cProcTotFun += "'2' as RZ_TPC " 
	If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
		cProcTotFun += ", ' ' RZ_ITEM,' ' RZ_CLVL " +CRLF
	Endif
	cProcTotFun += "from " + cAliasSRZ + " SRZ " +CRLF
	cProcTotFun += "where RZ_PD = 'zzz' AND "  +CRLF
	cProcTotFun += "RZ_FILIAL <> 'zz'"  +CRLF
	cProcTotFun += "group by RZ_FILIAL, RZ_TIPO"  +CRLF 
	cProcTotFun += "ORDER BY 1, 2, 4, 9 " +CRLF 
	cProcTotFun += "open curFunGer"  +CRLF
	If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
		cProcTotFun += "fetch curFunGer into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
	Else
		cProcTotFun += "fetch curFunGer into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
	Endif
	cProcTotFun += "while (@@fetch_Status = 0) begin "  +CRLF
	cProcTotFun += "					select @MaxRecno = isnull( max( R_E_C_N_O_ ), 1) from " + RetSqlName("SRZ") +CRLF 	
	cProcTotFun += "					Select  @MaxRecno =  @MaxRecno + 1" +CRLF
	If !("MSSQL"$tcGetDB())
		cProcTotFun += "		Begin Transaction"  +CRLF
	Endif
	cProcTotFun += "If @RZ_TIPO = 'FL'"+CRLF
	cProcTotFun += "	Begin" +CRLF
	cProcTotFun += "		Select @RZ_CC = " + cTPFL
	cProcTotFun += "	End" +CRLF
	cProcTotFun += "	Else" +CRLF
	cProcTotFun += "	Begin" +CRLF
	cProcTotFun += "		Select @RZ_CC = " + cTP13
	cProcTotFun += "	End" +CRLF
 
	If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
		cProcTotFun += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, RZ_ITEM,RZ_CLVL, " + cRecno + ")" +CRLF
   		cProcTotFun += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC,@lTemItemRZ, @lTemClVlRZ, @MaxRecno )" +CRLF  
   	Else
   		cProcTotFun += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, " + cRecno + ")" +CRLF
   		cProcTotFun += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @MaxRecno )" +CRLF
   	Endif  
	
	If !("MSSQL"$tcGetDB())
		cProcTotFun += "		Commit Transaction"  +CRLF
	Endif
	
	If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
		cProcTotFun += "fetch curFunGer into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF
	Else
		cProcTotFun += "fetch curFunGer into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF
	Endif
	
	cProcTotFun += "end"  +CRLF
	cProcTotFun += "close curFunGer"  +CRLF
	cProcTotFun += "deallocate curFunGer"  +CRLF  
	cProcTotFun += "select @OUT_RESULTADO = '1'"  +CRLF
	cProcTotFun += "end"+CRLF
	cFim := "End "  +CRLF

		
	//EXECUTA A PROCEDURE QUE GERA O SRZ
	cParam := "CREATE PROCEDURE SPGERASRZ_"+cEmpAnt+"("+CRLF 
	cParam += " @OUT_RESULTADO CHAR(01) OutPut " +CRLF 
	cParam += " )"+CRLF
	cParam += " AS "+CRLF
	cQueryExec := cParam+ cDeclare
	cQueryExec += cIni + cDelete
	cQueryExec += cFlFun	+	c13Fun
	cQueryExec += cIni		+	cFlFil		+	c13Fil		+	cFim  
   	cQueryExec += cIni		+	cFlCC		+	c13CC		+	cFim
	cQueryExec += cIni		+	cFlEmp		+	c13Emp		+	cFim 
	cQueryExec += cIni		+	cFlFunCc	+	c13Funcc	+	cFim
	cQueryExec += cParam15	+	cProcTotFun	+	cFim 
	cQueryExec := MsParse(cQueryExec,Alltrim(TcGetDB()))
	If ( AllTrim( Upper( TcGetDb() ) ) == 'INFORMIX' )
		cQueryExec := StrTran(cQueryExec, "LET viTranCount  = 0 ;" , "LET viTranCount  = 0 ;" +CRLF+ "	COMMIT WORK ;") 
	Endif
  
	//Verifica se a procedure existe no Banco       
	
	If TCSPExist(cProcName+"_"+cEmpAnt)
		TcSqlExec("DROP PROCEDURE " + cProcName+"_"+cEmpAnt)  
	EndIf 
		
	//Cria a Procedure para a geracao do SRZ
	cRetProc:= TcSqlExec(cQueryExec)  
	 
	//Executa a procedure 
	If cRetProc <> 0

		cProcErr := TCSQLError()
		MsgStop("TCSQLError() " + cProcErr)
	
		nSbsErr := 1
		For nCnt := 1 To ( nPos := MlCount(cProcErr,100) )
			If nCnt < nPos
				cDescErr += Substr( cProcErr, nSbsErr, 100 ) + CRLF
			Else
				cDescErr += Substr( cProcErr, nSbsErr, Len(cProcErr) - nSbsErr + 1 )
			EndIf
			
			nSbsErr += 100
		Next nCnt
		
		aAdd( aErrProc[1], "TCSQLError() " + cDescErr )
		lGerouSRZ := .F.
	Else
		aResult := TCSPExec( xProcedures(cProcName))
		If Empty(aResult)
			cProcErr := TCSQLError()
			MsgStop("TCSQLError() " + cProcErr)
			
			nSbsErr := 1
			For nCnt := 1 To ( nPos := MlCount(cProcErr,100) )
				If nCnt < nPos
					cDescErr += Substr( cProcErr, nSbsErr, 100 ) + CRLF
				Else
					cDescErr += Substr( cProcErr, nSbsErr, Len(cProcErr) - nSbsErr + 1 )
				EndIf
				
				nSbsErr += 100
			Next nCnt
	
			aAdd( aErrProc[2], "TCSQLError() " + cDescErr )
			lGerouSRZ := .F.
		EndIf
	Endif
Endif 

// Exclui tabela temporaria
If TCCanOpen(cTableTmp)
   	TcDelFile(cTableTmp) 
EndIf    

If cEncInss == "N"  .AND. lGerouSRZ
	fGeraEncInss (nRelat, nTpContr)
Endif
	
// Identifica que o SRZ ja foi gerado
lPrimeira := !lGerouSRZ

Return( lGerouSRZ )

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³fGerEncInssºAutor  ³Luciana Silveira    º Data ³  12/08/08  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³  Gerar encargos de INSS atraves da chamada da              º±±
±±º          ³  funcao fProcGravaSRZ  quando o parametro   	  			  º±±
±±º          ³ cEncInss estiver com "N"                                   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ GPER040													  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function fGeraEncInss  (nRelat, nTpContr) 
 
Local cAliasSRZ		:= InitSqlName( "SRZ" )
Local cAliasSRV		:= InitSqlName( "SRV" ) 
Local cAliasTMP		:= ""
Local cQuery		:= "" 
Local cFil 			:= ""
Local cCusto 		:= ""
Local cPD			:= ""	  
Local cDescPd		:= "" 
Local cVal			:= ""	
Local cTipCod		:= ""
Local cParPis		:= ""
Local cParCusto		:= ""
Local cSRZFil		:= ""
Local cString		:= ""
Local cQueryExec	:= ""
Local cTipo			:= "1"
Local cTableInss	:= "TBLENCINSS"
Local nValBas		:= 0
Local x				:= 0 
Local nRegProc		:= 0
Local nVal			:= 0 
Local nHrs			:= 0
Local nMaxRecno 	:= 0  
Local nPD			:= 0 
local nx			:= 0                
Local nMaximo		:= 0 
Local nConta,nCon	:= 0 
Local cRecno	
Local cDel 
Local cRetProc		:= 0
Local cAciFil 		:= ""
Local cAciCusto 	:= ""
Local cRvCod 		:= ""
Local nSal 			:= 0
Local nPercSat		:= 0
Local nPercI3Aci	:= 0
Local nAciVal	   	:= 0 
Local cParam		:= ""
Local cCorpo		:= ""
Local cDeclare		:= ""
Local cDelete		:= "" 
Local cProcInss		:= "SPGERAENCINSS"
Local aResult   	:= {}
Local aFilProc		:= {} 
Local cFilSRV		:= ""
Local cFilSi3		:= "" 
Local cOrdAci		:= ""
Local cTipoAci		:= ""
Local cTipoBas		:= ""
Local cPisAci		:= ""
Local cRzItem		:= ""
Local cRzCLVL		:= ""

Private aInfo   	:= {} 
Private aGPSPer		:= {} 
Private aCampos		:= {}
Private	aFunB		:= {}
Private	aFunP		:= {}
Private aArray		:= Array(3,3)  // Controlador de Arrays
Private cAliasINSS		:= "" 
Private cFilAnterior	:= "" 
Private cContribuicao 	:= ""
Private cContrProAuto 	:= ""  
Private cCCto			:= ""
Private cTpc			:= ""
If nRelat==4  
	cQryTipo:= "13"
Else
	cQryTipo:= "FL"
Endif 
     
cAliasTMP := GetNextAlias()
BeginSql alias cAliasTMP
		SELECT  RZ_FILIAL 
		FROM %table:SRZ% SRZ
		WHERE   SRZ.%notDel% 
		AND RZ_FILIAL NOT IN('zz')
		GROUP BY RZ_FILIAL
EndSql                
		
( cAliasTMP )->( dbEval( { || Aadd( aFilProc, RZ_FILIAL ) }, { || .T.} ) )
( cAliasTMP )->( dbCloseArea() )
	 
// Exclui tabela temporaria
If TCCanOpen(cTableInss)
	TcDelFile( cTableInss )
EndIf      

AAdd( aCampos, { "tmpFILIAL"	, "C",       02, 0 } )	
AAdd( aCampos, { "tmpCC"		, "C",val(nTamSx3), 0 } )	
AAdd( aCampos, { "tmpMAT"		, "C",	     06, 0 } )	
AAdd( aCampos, { "tmpPD" 		, "C",       03, 0 } ) 	
AAdd( aCampos, { "tmpHRS"		, "N",       17, 2 } )
AAdd( aCampos, { "tmpVAL"		, "N",       17, 2 } )
AAdd( aCampos, { "tmpOCORREN"	, "N",       17, 2 } )              
AAdd( aCampos, { "tmpTIPO"		, "C",       02, 0 } )          
AAdd( aCampos, { "tmpTPC"		, "C",       01, 0 } )	
AAdd( aCampos, { "tmpPIS"		, "C",       01, 0 } )	
If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC	
	AAdd( aCampos, { "tmpRZITEM"		, "C",val(nTamRZItem), 0 } )	
	AAdd( aCampos, { "tmpRZCLVL"		, "C",val(nTamRZClas), 0 } )	
Endif 
		                     
IF MsCreate( cTableInss , aCampos , __cRdd )
	IF !MsOpenDbf( .T. , __cRdd , cTableInss , "QTMC" , .F. )
//		MsgInfo( OemToAnsi( STR0079 )  , OemToAnsi( STR0078 ) )	//"N„o foi possivel abrir o arquivo Temporario para gerar os encargos" 
		MsgInfo( OemToAnsi( "Not Able to open temporary file" )  , OemToAnsi( "Warning" ) )	//"N„o foi possivel abrir o arquivo Temporario para gerar os encargos" 
		lPack := .F.
		Return( NIL )
	EndIF
Endif

For x = 1 to Len( aFilProc )
	If x == 1 .Or. !Empty( xFilial( "SRV", aFilProc[x] ) )
		If !FP_CODFOL(@aCodFol,aFilProc[x]) .Or. !fInfo(@aInfo,aFilProc[x])
			Loop
		Endif
		If cPaisLoc == "BRA" .And. !fInssEmp(aFilProc[x],@aInssEmp)
			Loop
		Endif
		fGPSVal(aFilProc[x],"999999",@aGPSPer,cTpC)
		If  !Empty( xFilial( "SRV", aFilProc[x] ))
			cFilSrv := aFilProc[x]
		Else
			cFilSRV:= Space(2)
		Endif
		If  !Empty( xFilial( "SI3", aFilProc[x] ))
			cFilSi3 := aFilProc[x]
		Else
			cFilSi3:= Space(2)
		Endif

	EndIf
		
	//RESGATA AS VERBAS QUE COMPOEM A BASE DE INSS
	cContribuicao := aCodFol[013,1]+"x"+aCodFol[014,1]+"x"+aCodFol[19,1]+"x"+aCodFol[20,1]+"x"+aCodFol[338,1]+"x"+aCodFol[399,1]
   	cContrProAuto := aCodFol[217,1]+"x"+aCodFol[218,1]+"x"+aCodFol[349,1]+"x"+aCodFol[352,1]
	
   	cSRZFil := aFilProc[x]
	
	cAliasINSS := GetNextAlias() 
	
	lQuery := .T.
		
	cQuery := "SELECT DISTINCT RZ_FILIAL, RZ_CC, RV_COD, RV_DESC, RV_TIPOCOD, RV_PIS, RV_CUSTO,  RZ_TPC,SUM(RZ_HRS) RZ_HRS, Round(SUM(RZ_VAL),2) RZ_VAL, RZ_TIPO " 
	If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
		cQuery += ", RZ_ITEM,RZ_CLVL " +CRLF
	Endif
	cQuery += "FROM " + RetSqlName("SRZ") + " SRZ, " + RetSqlName("SRV") + " SRV " +CRLF
	cQuery += "WHERE RZ_PD = RV_COD AND  RV_COD IN('"+aCodFol[013,1]+"','"+aCodFol[014,1]+"','"  
	cQuery += aCodFol[19,1]+"','"+aCodFol[20,1]+"','"+aCodFol[338,1]+"','"+aCodFol[399,1]+"','"
	cQuery += aCodFol[221,1]+"','"+aCodFol[225,1]+"','"+aCodFol[229,1]+"','"+aCodFol[223,1]+"','"
	cQuery += aCodFol[217,1]+"','"+aCodFol[218,1]+"','"+aCodFol[349,1]+"','"+aCodFol[352,1] //Verbas de Autonomos
	cQuery += "') AND "+CRLF
	cQuery += "RZ_CC <> 'zzzzzzzzz' "+CRLF                       
	cQuery += "AND RZ_FILIAL = '" + cSRZFil + "'" +CRLF
	cQuery += "AND RV_FILIAL = '" + cFilSRV + "'" +CRLF
	cQuery += "GROUP BY RZ_FILIAL, RZ_CC, RV_COD, RV_DESC, RV_TIPOCOD, RV_PIS, RV_CUSTO,RZ_TPC,RZ_TIPO " 
	If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
		cQuery += ", RZ_ITEM,RZ_CLVL " +CRLF
	Endif
	cQuery += "UNION "+CRLF
	cQuery += "SELECT DISTINCT RZ_FILIAL, RZ_CC, RV_COD, RV_DESC, RV_TIPOCOD, RV_PIS, RV_CUSTO,  RZ_TPC, SUM(RZ_HRS) RZ_HRS, Round(SUM(RZ_VAL),2) RZ_VAL, RZ_TIPO " 
	If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
		cQuery += ", RZ_ITEM,RZ_CLVL " +CRLF
	Endif
	cQuery += "FROM " + RetSqlName("SRZ") + " SRZ, " + RetSqlName("SRV") + " SRV "+CRLF
	cQuery += "WHERE RZ_PD = RV_COD AND RV_PIS= 'S' " +CRLF
	cQuery += "AND RZ_FILIAL = '" + cSRZFil + "'" +CRLF
  	cQuery += "AND RV_FILIAL = '" + cFilSRV + "'" +CRLF
	cQuery += "AND RZ_CC <> 'zzzzzzzzz' "+CRLF 
	cQuery += "GROUP BY RZ_FILIAL, RZ_CC, RV_COD, RV_DESC, RV_TIPOCOD, RV_PIS, RV_CUSTO,RZ_TPC, RZ_TIPO " 
	If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
		cQuery += ", RZ_ITEM,RZ_CLVL " +CRLF
	Endif
   	cQuery += "UNION "+CRLF
	cQuery += "SELECT DISTINCT RZ_FILIAL, RZ_CC, RV_COD, RV_DESC, RV_TIPOCOD, RV_PIS, RV_CUSTO,  RZ_TPC, SUM(RZ_HRS) RZ_HRS, Round(SUM(RZ_VAL),2) RZ_VAL, RZ_TIPO " 
	If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
		cQuery += ", RZ_ITEM,RZ_CLVL " +CRLF
	Endif
	cQuery += "FROM " + RetSqlName("SRZ") + " SRZ, " + RetSqlName("SRV") + " SRV "+CRLF
	cQuery += "WHERE RZ_PD = RV_COD AND RV_CUSTO= 'S' "+CRLF
	cQuery += "AND RZ_FILIAL = '" + cSRZFil + "'" +CRLF
  	cQuery += "AND RV_FILIAL = '" + cFilSRV + "'" +CRLF
	cQuery += "AND RZ_CC <> 'zzzzzzzzz' "+CRLF
	cQuery += "GROUP BY RZ_FILIAL, RZ_CC, RV_COD, RV_DESC, RV_TIPOCOD, RV_PIS, RV_CUSTO,RZ_TPC, RZ_TIPO "  
	If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
		cQuery += ", RZ_ITEM,RZ_CLVL " +CRLF
	Endif
	cQuery += "ORDER BY 1, 2, 3,8 " +CRLF 
	cQuery := ChangeQuery(cQuery)

    dbUseArea(.T., "TOPCONN", TCGenQry(,,cQuery), cAliasINSS, .F., .T.) 

	//-- Montar a Base Total de Inss 
	While (cAliasINSS)-> (!EOF()) 
		cCCto		 :=cCusto 
 		 
 		// monta o array
		cFil 				:= ( cAliasINSS ) 		-> ( RZ_FILIAL )
		cCusto 				:= ( cAliasINSS ) 		-> ( RZ_CC )
		cPD	  		   		:= ( cAliasINSS ) 		-> ( RV_COD )
		nHrs		   		:= Round(( cAliasINSS )	-> ( RZ_HRS ),2)
		nVal		   		:= Round(( cAliasINSS )	-> ( RZ_VAL ),2)
		cTipCod				:= ( cAliasINSS ) 		-> ( RV_TIPOCOD )
		cParPis				:= ( cAliasINSS ) 		-> ( RV_PIS )
		cParCusto  			:= ( cAliasINSS ) 		-> ( RV_CUSTO )                                                                                          
		cTPC				:= ( cAliasINSS ) 		-> ( RZ_TPC )
		cTipoBas			:= ( cAliasINSS ) 		-> ( RZ_TIPO )
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cRzItem				:= ( cAliasINSS ) 		-> ( RZ_ITEM )
			cRzCLVL				:= ( cAliasINSS ) 		-> ( RZ_CLVL )
		Endif
		aCcP		   		:= {}
		aCcD		   		:= {}
		aCcB				:= {}
        
		If cTipCod == "1"
			Aadd (aCcP,{cPD,nHrs,nVal,0,1,"",""})  // se nao cria elemento  
		Elseif cTipCod == "2" 
			Aadd (aCcD,{cPD,nHrs,nVal,0,1,"",""})  // se nao cria elemento
		Elseif cTipCod == "3"
			Aadd (aCcB,{cPD,nHrs,nVal,0,1,"",""})  // se nao cria elemento
		Endif 
	    
	   
		// calcula o encargo
		fCalcInss("2",cFil,cCusto)

		aArray[1] := aClone(aCcP)
		aArray[2] := aClone(aCcD)
		aArray[3] := aClone(aCcB)
		
		nMaximo:= MAX(MAX(Len(aArray[1]),Len(aArray[2])),Len(aArray[3]))

		For nConta :=1 TO nMaximo   
			For nCon := 1 To 3 
				If nConta <= Len(aArray[nCon])
					//If !(aArray[nCon,nConta,1] $ cContribuicao + "x" + cContrProAuto+ "x" + aCodFol[221,1]+ "x" + aCodFol[031,1])
					If (aArray[nCon,nConta,1] $ aCodFol[148,1]+ "x" + aCodFol[149,1] + "x" + aCodFol[204,1] ;
					    + "x" + aCodFol[184,1] + "x" + aCodFol[185,1] + "x" + aCodFol[186,1] + "x" + aCodFol[187,1] + "x" + aCodFol[188,1] ;
					    + "x" + aCodFol[189,1] + "x" + aCodFol[190,1] + "x" + aCodFol[191,1] + "x" + aCodFol[192,1] + "x" + aCodFol[193,1] ;
					    + "x" + aCodFol[200,1] + "x" + aCodFol[201,1] + "x" + aCodFol[782,1] + "x" + aCodFol[223,1] + "x" + aCodFol[229,1] ;
					    + "x" + aCodFol[194,1] + "x" + aCodFol[195,1] + "x" + aCodFol[196,1])
                   		Reclock ("QTMC",.T.)
						   	tmpFILIAL	:= cFil
						   	tmpCC		:= cCusto
						   	tmpMAT		:= "zzzzzz"
						   	tmpPD		:= aArray[nCon,nConta,1]
						   	tmpHRS		:= aArray[nCon,nConta,2]
						   	tmpVAL		:= aArray[nCon,nConta,3]
						   	tmpOCORREN	:= 1 
						   	tmpTIPO     := cTipoBas
				   			tmpTPC		:= cTPC
				   			tmpPIS		:= If (tmpPD $ aCodFol[223,1] + "*" + aCodFol[229,1],"N", cParPis)
				   			If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
					   			tmpRZITEM	:= " " 
								tmpRZCLVL	:= " " 
				   			Endif
					    QTMC-> (msUnlock()) 
					Endif
				EndIf		   
	 		Next nCon
	    Next nConta

        (cAliasINSS)-> (dbSkip())
	Enddo	 
	cFilAnterior := cFil
	(cAliasINSS)-> (dbCloseArea())
		
	//Calcula % Acidente de Trabalho
	cAliasAci 	:= GetNextAlias() 

	If lFolPgto
		cQueryAci := "SELECT RA_FILIAL RC_FILIAL, RA_CC RC_CC, 'zzz' RC_PD, RA_MAT RC_MAT, '3' RV_TIPOCOD, RA_SALARIO, RA_PERCSAT, 0 I3_PERCACI , RA_TPCONTR, 0 RC_HORAS, 0 RC_VALOR, 'FL' RZ_TIPO, 'N' RV_PIS " 
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cQueryAci += ",RA_ITEM RC_ITEM, RA_CLVL RC_CLVL " +CRLF 
		Endif
		cQueryAci += "FROM " +  RetSqlName("SRA") + " SRA " +CRLF 
		cQueryAci += "WHERE RA_PERCSAT > 0 AND " +CRLF 
		cQueryAci += "RA_FILIAL = '" + cSRZFil + "' AND " +CRLF
		cQueryAci += "SRA.D_E_L_E_T_ = ' ' "	+CRLF
		cQueryAci += "UNION " +CRLF
		cQueryAci += "SELECT DISTINCT RC_FILIAL, RC_CC, RC_PD, RC_MAT, RV_TIPOCOD, 0 RA_SALARIO,0 RA_PERCSAT, 0 I3_PERCACI , RA_TPCONTR, RC_HORAS , RC_VALOR, 'FL' RZ_TIPO, RV_PIS "
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cQueryAci += ",RC_ITEM, RC_CLVL " +CRLF 
		Endif 
		cQueryAci += "FROM "  + RetSqlName("SRV") + " SRV, " + RetSqlName("SRC") + " SRC , " + RetSqlName("SRA") + " SRA" +CRLF
		cQueryAci += "WHERE SRV.RV_COD = SRC.RC_PD AND "+CRLF
		cQueryAci += "SRA.RA_FILIAL = SRC.RC_FILIAL AND "+CRLF
		cQueryAci += "SRA.RA_MAT = SRC.RC_MAT AND "+CRLF		
		cQueryAci += "SRC.D_E_L_E_T_ = ' '  AND "+CRLF
		cQueryAci += "SRA.D_E_L_E_T_ = ' '  AND "	+CRLF
		cQueryAci += "RC_MAT NOT IN(SELECT RA_MAT FROM "  +  RetSqlName("SRA") + " WHERE RA_PERCSAT > 0) AND " +CRLF
	   	cQueryAci += "RC_CC NOT IN(SELECT I3_CUSTO FROM "  +  RetSqlName("SI3") + ") AND "+CRLF 
	   	cQueryAci += "RV_COD IN('"+aCodFol[013,1]+"','"+aCodFol[014,1]+"','"  
		cQueryAci += aCodFol[19,1]+"','"+aCodFol[20,1]+"','"+aCodFol[338,1]+"','"+aCodFol[399,1]+"','"
		cQueryAci += aCodFol[221,1]+"','"+aCodFol[225,1]+"','"+aCodFol[229,1]+"','"+aCodFol[223,1]+"','"
		cQueryAci += aCodFol[217,1]+"','"+aCodFol[218,1]+"','"+aCodFol[349,1]+"','"+aCodFol[352,1] //Verbas de Autonomos
		cQueryAci += "') AND "+CRLF
		cQueryAci += "RC_FILIAL = '" + cSRZFil + "'" +CRLF
	  	cQueryAci += "AND RV_FILIAL = '" + cFilSRV + "'" +CRLF
		cQueryAci += "UNION " +CRLF
		cQueryAci += "SELECT DISTINCT RC_FILIAL, RC_CC, RC_PD,  RC_MAT, '3' RV_TIPOCOD, 0 RA_SALARIO, 0 RA_PERCSAT, I3_PERCACI , RA_TPCONTR, RC_HORAS , RC_VALOR, 'FL' RZ_TIPO, RV_PIS "
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cQueryAci += ",RC_ITEM, RC_CLVL " +CRLF 
		Endif
		cQueryAci += "FROM " +  RetSqlName("SI3") + " SI3, " + RetSqlName("SRC") + " SRC, " + RetSqlName("SRA") + " SRA, " + RetSqlName("SRV") + " SRV" +CRLF
		cQueryAci += "WHERE SI3.I3_CUSTO = SRC.RC_CC AND " +CRLF
		cQueryAci += "SRV.RV_COD = SRC.RC_PD AND "+CRLF
		cQueryAci += "SI3.I3_FILIAL  = '" + cFilSI3 + "' AND " +CRLF
		cQueryAci += "SI3.D_E_L_E_T_ = ' '  AND "+CRLF
		cQueryAci += "SRA.RA_FILIAL = SRC.RC_FILIAL AND "+CRLF
		cQueryAci += "SRA.RA_MAT = SRC.RC_MAT AND "+CRLF		
		cQueryAci += "RC_FILIAL = '" + cSRZFil + "' AND " +CRLF
		cQueryAci += "SRC.D_E_L_E_T_ = ' '  AND "+CRLF	
		cQueryAci += "SRA.D_E_L_E_T_ = ' '  AND "+CRLF	
		cQueryAci += "RC_MAT NOT IN(SELECT RA_MAT FROM " +  RetSqlName("SRA") + " WHERE RA_CATFUNC IN('P','A')) AND " 
		cQueryAci += "RC_PD IN('"+aCodFol[013,1]+"','"+aCodFol[014,1]+"','"  
		cQueryAci += aCodFol[19,1]+"','"+aCodFol[20,1]+"','"+aCodFol[338,1]+"','"+aCodFol[399,1]+"','"
		cQueryAci += aCodFol[221,1]+"','"+aCodFol[225,1]+"','"+aCodFol[229,1]+"','"+aCodFol[223,1]  
		cQueryAci += "')"+CRLF
	Endif
		
	// Query devera ser executada quando for 13o. salario 
	If lFol13Sl		
		cQueryAci13 := "SELECT RA_FILIAL RC_FILIAL, RA_CC RC_CC, 'zzz' RC_PD, RA_MAT RC_MAT, '3' RV_TIPOCOD, RA_SALARIO, RA_PERCSAT, 0 I3_PERCACI , RA_TPCONTR, 0 RC_HORAS, 0 RC_VALOR, '13' RZ_TIPO, 'N' RV_PIS "
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cQueryAci13 += ",RA_ITEM RC_ITEM, RA_CLVL RC_CLVL " +CRLF 
		Endif
		cQueryAci13 += "FROM " +  RetSqlName("SRA") + " SRA " +CRLF 
		cQueryAci13 += "WHERE RA_PERCSAT > 0 AND " +CRLF 
		cQueryAci13 += "RA_FILIAL = '" + cSRZFil + "' AND " +CRLF
		cQueryAci13 += "SRA.D_E_L_E_T_ = ' ' "	+CRLF
		cQueryAci13 += "UNION " +CRLF
		cQueryAci13 += "SELECT DISTINCT RI_FILIAL RC_FILIAL, RI_CC RC_CC, RI_PD RC_PD, RI_MAT RC_MAT, RV_TIPOCOD, 0 RA_SALARIO,0 RA_PERCSAT, 0 I3_PERCACI , RA_TPCONTR, RI_HORAS RC_HORAS , RI_VALOR RC_VALOR, '13' RZ_TIPO, RV_PIS " 
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cQueryAci13 += ",RI_ITEM RC_ITEM, RI_CLVL RC_CLVL " +CRLF 
		Endif
		cQueryAci13 += "FROM "  + RetSqlName("SRV") + " SRV, " + RetSqlName("SRI") + " SRI , " + RetSqlName("SRA") + " SRA" +CRLF
		cQueryAci13 += "WHERE SRV.RV_COD = SRI.RI_PD AND "+CRLF
		cQueryAci13 += "SRA.RA_FILIAL = SRI.RI_FILIAL AND "+CRLF
		cQueryAci13 += "SRA.RA_MAT = SRI.RI_MAT AND "+CRLF		
		cQueryAci13 += "SRI.D_E_L_E_T_ = ' '  AND "+CRLF
		cQueryAci13 += "SRA.D_E_L_E_T_ = ' '  AND "	+CRLF
		cQueryAci13 += "RI_MAT NOT IN(SELECT RA_MAT FROM "  +  RetSqlName("SRA") + " WHERE RA_PERCSAT > 0) AND " +CRLF
	   	cQueryAci13 += "RI_CC NOT IN(SELECT I3_CUSTO FROM "  +  RetSqlName("SI3") + ") AND "+CRLF 
	   	cQueryAci13 += "RV_COD IN('"+aCodFol[013,1]+"','"+aCodFol[014,1]+"','"  
		cQueryAci13 += aCodFol[19,1]+"','"+aCodFol[20,1]+"','"+aCodFol[338,1]+"','"+aCodFol[399,1]+"','"
		cQueryAci13 += aCodFol[221,1]+"','"+aCodFol[225,1]+"','"+aCodFol[229,1]+"','"+aCodFol[223,1]+"','"
		cQueryAci13 += aCodFol[217,1]+"','"+aCodFol[218,1]+"','"+aCodFol[349,1]+"','"+aCodFol[352,1] //Verbas de Autonomos
		cQueryAci13 += "') AND "+CRLF
		cQueryAci13 += "RI_FILIAL = '" + cSRZFil + "'" +CRLF
	  	cQueryAci13 += "AND RV_FILIAL = '" + cFilSRV + "'" +CRLF
		cQueryAci13 += "UNION " +CRLF
		cQueryAci13 += "SELECT DISTINCT RI_FILIAL RC_FILIAL, RI_CC RC_CC, RI_PD RC_PD,  RI_MAT RC_MAT, '3' RV_TIPOCOD, 0 RA_SALARIO, 0 RA_PERCSAT, I3_PERCACI , RA_TPCONTR, RI_HORAS RC_HORAS, RI_VALOR RC_VALOR, '13' RZ_TIPO, RV_PIS "
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cQueryAci13 += ",RI_ITEM RC_ITEM, RI_CLVL RC_CLVL " +CRLF 
		Endif
		cQueryAci13 += "FROM " +  RetSqlName("SI3") + " SI3, " + RetSqlName("SRI") + " SRI, " + RetSqlName("SRA") + " SRA, " + RetSqlName("SRV") + " SRV" +CRLF
		cQueryAci13 += "WHERE SI3.I3_CUSTO = SRI.RI_CC AND " +CRLF
		cQueryAci13 += "SRV.RV_COD = SRI.RI_PD AND "+CRLF
		cQueryAci13 += "SI3.I3_FILIAL  = '" + cFilSI3 + "' AND " +CRLF
		cQueryAci13 += "SI3.D_E_L_E_T_ = ' '  AND "+CRLF
		cQueryAci13 += "SRA.RA_FILIAL = SRI.RI_FILIAL AND "+CRLF
		cQueryAci13 += "SRA.RA_MAT = SRI.RI_MAT AND "+CRLF		
		cQueryAci13 += "RI_FILIAL = '" + cSRZFil + "' AND " +CRLF
		cQueryAci13 += "SRI.D_E_L_E_T_ = ' '  AND "+CRLF	
		cQueryAci13 += "SRA.D_E_L_E_T_ = ' '  AND "+CRLF	
		cQueryAci13 += "RI_MAT NOT IN(SELECT RA_MAT FROM " +  RetSqlName("SRA") + " WHERE RA_CATFUNC IN('P','A')) AND " 
		cQueryAci13 += "RI_PD IN('"+aCodFol[013,1]+"','"+aCodFol[014,1]+"','"  
		cQueryAci13 += aCodFol[19,1]+"','"+aCodFol[20,1]+"','"+aCodFol[338,1]+"','"+aCodFol[399,1]+"','"
		cQueryAci13 += aCodFol[221,1]+"','"+aCodFol[225,1]+"','"+aCodFol[229,1]+"','"+aCodFol[223,1]  
		cQueryAci13 += "')"+CRLF 
	Endif

	cOrdAci := "ORDER BY 1,2,3,8" +CRLF
	
	If lFolPgto .AND. !lFol13Sl		
		cQueryAci  := ChangeQuery(cQueryAci + cOrdAci)  
	Elseif !lFolPgto .AND. lFol13Sl	
		cQueryAci  := ChangeQuery(cQueryAci13 + cOrdAci)
	Elseif lFolPgto .AND. lFol13Sl	
		cQueryAci  := ChangeQuery(cQueryAci + CRLF + "UNION " + CRLF + cQueryAci13 + cOrdAci)
	Endif
	
	dbUseArea(.T., "TOPCONN", TCGenQry(,,cQueryAci), cAliasAci, .F., .T.) 
	
	//-- Montar a Base Total de Inss 
	While (cAliasAci)-> (!EOF()) 
		cAciFil 		:= ""
		cAciCusto  		:= ""
		cRvCod 			:= ""
		nSal 			:= 0
		nPercSat   		:= 0
		nPercI3Aci 		:= 0
		nAciVal	   		:= 0
		cMat			:= ""
		cTipoAci		:= "" 
		cPisAci			:= ""
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cRzItem			:= ""
			cRzCLVL			:= ""
		Endif
 
 		cAciFil 		:= ( cAliasAci ) -> ( RC_FILIAL )
		cAciCusto 		:= ( cAliasAci ) -> ( RC_CC )
 		cMat			:= ( cAliasAci ) -> ( RC_MAT )
		cRvCod 			:= ( cAliasAci ) -> ( RV_TIPOCOD ) 
		nSal 			:= ( cAliasAci ) -> ( RA_SALARIO )
		nPercSat		:= ( cAliasAci ) -> ( RA_PERCSAT ) 
		nPercI3Aci		:= ( cAliasAci ) -> ( I3_PERCACI )  
		cTPC			:= ( cAliasAci ) -> ( RA_TPCONTR )
		nAciHrs			:= ( cAliasAci ) -> ( RC_HORAS ) 
		nAciVal	   		:= ( cAliasAci ) -> ( RC_VALOR )
		cTipoAci		:= ( cAliasAci ) -> ( RZ_TIPO )
		cPisAci			:= ( cAliasAci ) -> ( RV_PIS )
		If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
			cRzItem			:= ( cAliasAci ) -> ( RC_ITEM )
			cRzCLVL			:= ( cAliasAci ) -> ( RC_CLVL )
		Endif
		        
   		nPercAci := aInssEmp[3,Val(cTpc)]
 		
 		If nPercSat > 0 
 			nPercSat := nPercSat / 100
 			nValAci	:=	Round(nSal * nPercSat,2)
 		Elseif nPercI3Aci > 0
	 		nPercI3Aci := nPercI3Aci / 100
	 		nValAci	:=	Round(nAciVal * nPercI3Aci,2)
 		Else
   			nValAci	:=	Round(nAciVal  * nPercAci,2)  
   		Endif 
   		
   		If nValAci > 0  
	  		Reclock ("QTMC",.T.)
				tmpFILIAL				:= cAciFil
			   	tmpCC					:= cAciCusto
			   	tmpMAT					:= cMat
			   	tmpPD					:= aCodFol[150,1]
			   	tmpTIPO			   		:= cTipoAci
			   	tmpOCORREN				:= 1 
			   	tmpTPC					:= cTPC
			   	TmpHRS			   		:= Round(nAciHrs,2)		
			   	tmpVAL					:= Round(nValAci,2) 
			   	tmpPIS					:= cPisAci
			   	If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
					tmpRZITEM	:= cRzItem
					tmpRZCLVL	:= cRzCLVL
				Endif
		    	QTMC-> (msUnlock()) 
		Endif
		(cAliasAci)-> (dbSkip())
	Enddo	 

 	(cAliasAci)-> (dbCloseArea())
Next x 

QTMC->( dbCloseArea() )
    
If lFolPgto 
	cQryTipo:= "FL"
Elseif lFol13Sl	 
 	cQryTipo:= "13"
Endif      

#IFDEF TOP
	Private lExInAs400 
	lExInAs400 := ExeInAs400()   
#ENDIF	

If TcSrvType() == "AS/400"
	cRecno	:=  IF( lExInAs400 , "RRN("+cRetSqlName+")", "R_E_C_N_O_" )
	cDel	:=  "@DELETED@  = ' '"
Else
	cRecno	:= "R_E_C_N_O_" 
	cDel	:= "D_E_L_E_T_ = ' '"
EndIf
	
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Declaracao de variaveis da procedure                         ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
cDeclare := "Declare @RZ_FILIAL char(2)" +CRLF 
cDeclare += "Declare @RZ_CC char(" + nTamSx3 + ")"  +CRLF
cDeclare += "Declare @RZ_MAT char(6)"  +CRLF
cDeclare += "Declare @RZ_PD char(3)" +CRLF
cDeclare += "Declare @RZ_HRS float" +CRLF
cDeclare += "Declare @RZ_VAL float" +CRLF
cDeclare += "Declare @RZ_OCORREN float" +CRLF
cDeclare += "Declare @RZ_TIPO char(2)" +CRLF
cDeclare += "Declare @RZ_TPC char(1)" +CRLF 
cDeclare += "Declare @TMPPIS char(1)" +CRLF
cDeclare += "Declare @MaxRecno integer "  +CRLF 
cDeclare += "Declare @Desc15 varchar(100)"  +CRLF
cDeclare += "Declare @RxCod varchar(20)"  +CRLF
cDeclare += "Declare @vcCC char(" +  nTamSx3 + ")"  +CRLF  
cDeclare += "Declare @vcFil char(2)"  +CRLF 
cDeclare += "Declare @vcPD char(3)"  +CRLF 
cDeclare += "Declare @vcTPC char(1)"  +CRLF 
cDeclare += "Declare @vvVal Float"  +CRLF 
cDeclare += "Declare @vcPerc Float"  +CRLF 
cDeclare += "Declare @vvValFim Float"  +CRLF
cDeclare += "Declare @Recno15 integer "  +CRLF 
cDeclare += "Declare @Compr integer "  +CRLF 
cDeclare += "Declare @iNroRegs integer "  +CRLF
cDeclare += "Declare @iTranCount Integer"+CRLF  
If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	    cDeclare += "Declare @lTemItemRC char(" + nTamRZItem + ")"  +CRLF
	    cDeclare += "Declare @lTemClVlRC char(" + nTamRZClas + ")"  +CRLF
	    cDeclare += "Declare @lTemItemRZ char(" + nTamRZItem + ")"  +CRLF
	    cDeclare += "Declare @lTemClVlRZ char(" + nTamRZClas + ")"  +CRLF
Endif 
cCorpo	 := "begin "  +CRLF 
cCorpo   += "	SELECT @OUT_RESULTADO = '0'" +CRLF 
    
// RECUPERA O ULTIMO RECNO DO TOP   
cCorpo	+= "	select @iNroRegs = 0"+CRLF
cCorpo	+= "		begin"  +CRLF  
cCorpo 	+= "			declare curParam insensitive cursor for"  +CRLF  
cCorpo 	+= "			SELECT"  +CRLF 
cCorpo 	+= "			TMPFILIAL RZ_FILIAL,"  +CRLF 
cCorpo 	+= "			TMPCC RZ_CC,"  +CRLF 
cCorpo 	+= "			'zzzzzz' as tmpMAT,"  +CRLF
cCorpo 	+= "			TMPPD as RZ_PD,"  +CRLF 
cCorpo 	+= "			SUM(TMPHRS) RZ_HRS,"  +CRLF 
cCorpo 	+= "			ROUND(SUM(TMPVAL),2) RZ_VAL,"  +CRLF 
cCorpo 	+= "			TMPOCORREN RZ_OCORREN,"  +CRLF 
cCorpo 	+= "			TMPTIPO as RZ_TIPO, " +CRLF
cCorpo 	+= "			TMPTPC as RZ_TPC, " +CRLF
cCorpo 	+= "			TMPPIS " 
If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	cCorpo 	+= ",tmpRZITEM,tmpRZCLVL " +CRLF
Endif
cCorpo 	+= "			FROM " +  ctableInss  +CRLF 
cCorpo 	+= "			WHERE TMPFILIAL   >='"+ cFilDe +"'" + " AND "  +CRLF       
cCorpo 	+= "			TMPFILIAL   <='"+ cFilAte+"'" + " AND "  +CRLF
cCorpo 	+= "			TMPPIS = 'N' AND "  +CRLF
cCorpo 	+= 			    cDel  +CRLF 
If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	cCorpo 	+= "			GROUP BY TMPFILIAL, TMPCC, TMPPD, TMPOCORREN,TMPTIPO, TMPTPC, TMPPIS,tmpRZITEM, tmpRZCLVL " +CRLF 
Else 
	cCorpo 	+= "			GROUP BY TMPFILIAL, TMPCC, TMPPD, TMPOCORREN,TMPTIPO, TMPTPC, TMPPIS " +CRLF 
Endif
cCorpo 	+= "			ORDER BY 1, 2, 4, 9"  +CRLF  
cCorpo 	+= "		open curParam"  +CRLF
If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC  
	cCorpo 	+= "		Fetch  curParam into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @TMPPIS, @lTemItemRZ, @lTemClVlRZ"  +CRLF  
Else
	cCorpo 	+= "		Fetch  curParam into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @TMPPIS"  +CRLF  
Endif
cCorpo 	+= "		while (@@fetch_Status = 0) begin "  +CRLF
/* ------------- Tratamento para executar Commit a cada  registros --------------- */
cCorpo 	+= "		select @iNroRegs = @iNroRegs + 1"+CRLF
cCorpo 	+= "		If @iNroRegs = 1 begin"+CRLF

If !("MSSQL"$tcGetDB())
	cCorpo	+= "			Begin Transaction"+CRLF       
Endif

cCorpo += "         Select @iNroRegs = @iNroRegs"+CRLF
cCorpo += "      End"+CRLF
cCorpo += "					select @MaxRecno = isnull( max( R_E_C_N_O_ ), 1) from " + RetSqlName("SRZ") +CRLF 	
cCorpo += "					Select  @MaxRecno =  @MaxRecno + 1" +CRLF
If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	cCorpo += "					insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, RZ_ITEM, RZ_CLVL," + cRecno + ")" +CRLF
	cCorpo += "					values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ, @MaxRecno )" +CRLF  
Else
	cCorpo += "					insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, " + cRecno + ")" +CRLF
	cCorpo += "					values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @MaxRecno )" +CRLF  
Endif

//Commit a cada 1024 linhas

cCorpo += "      If @iNroRegs = 1024 begin"+CRLF

If !("MSSQL"$tcGetDB())
	cCorpo += "         Commit Transaction"+CRLF 
Endif

cCorpo += "         Select @iNroRegs = 0"+CRLF
cCorpo += "      End"+CRLF
If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC  
	cCorpo 	+= "		Fetch  curParam into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @TMPPIS, @lTemItemRZ, @lTemClVlRZ"  +CRLF  
Else
	cCorpo 	+= "		Fetch  curParam into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @TMPPIS"  +CRLF  
Endif
cCorpo += "	end"  +CRLF 
cCorpo += "	If @iNroRegs > 0 begin"+CRLF
cCorpo += "       Select @iTranCount  = 0"+CRLF

If !("MSSQL"$tcGetDB()) 
	cCorpo += "		Commit Transaction"+CRLF
Endif

cCorpo += "		select @iNroRegs = 0"+CRLF
cCorpo += "      End"+CRLF
cCorpo += "close curParam " +CRLF   
cCorpo += "deallocate curParam " +CRLF
cCorpo += "end "  +CRLF
cCorpo += "begin"  +CRLF  
cCorpo += "declare curTotParam insensitive cursor for"  +CRLF  
cCorpo += "select	tmpFILIAL, "  +CRLF
cCorpo += "'zzzzzzzzz' as tmpCC,"  +CRLF
cCorpo += "'zzzzzz' as tmpMAT,"  +CRLF
cCorpo += "tmpPD,"  +CRLF
cCorpo += "ROUND(Sum(TMPHRS),2) AS tmpHRS,"  +CRLF
cCorpo += "ROUND(Sum(tmpVal),2) as tmpVal,"  +CRLF
cCorpo += "Count(tmpOcorren) AS tmpOCORREN,"  +CRLF
cCorpo += "tmpTIPO,"  +CRLF
cCorpo += "tmpTpc AS tmpTPC "
If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	cCorpo 	+= ",tmpRZITEM, tmpRZCLVL " +CRLF
Endif
cCorpo += "from  "+cTableInss+CRLF 
cCorpo += "where TMPPIS = 'N' "  +CRLF
If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	cCorpo += "group by tmpFILIAL, tmpPD,tmpTIPO,tmpTPC,tmpRZITEM, tmpRZCLVL"  +CRLF 
Else
	cCorpo += "group by tmpFILIAL, tmpPD,tmpTIPO,tmpTPC"  +CRLF 
Endif
cCorpo += "union "+CRLF
cCorpo += "Select 'zz' as tmpFILIAL, "  +CRLF
cCorpo += "'zzzzzzzzz' as tmpCC,"  +CRLF
cCorpo += "'zzzzzz' as tmpMAT,"  +CRLF
cCorpo += "tmpPD,"  +CRLF
cCorpo += "Sum(tmpHRS) AS tmpHRS,"  +CRLF
cCorpo += "Sum(tmpVal) as tmpVal,"  +CRLF
cCorpo += "Count(TMPPD) AS tmpOCORREN,"  +CRLF
cCorpo += "tmpTIPO,"  +CRLF
cCorpo += "tmpTPC " +CRLF
If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	cCorpo 	+= ",tmpRZITEM, tmpRZCLVL" +CRLF
Endif
cCorpo += "from "+cTableInss +CRLF   
cCorpo += "where TMPPIS = 'N' "  +CRLF
If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	cCorpo += "group by tmpPD,tmpTIPO, TMPTPC,tmpRZITEM, tmpRZCLVL"  +CRLF
Else
	cCorpo += "group by tmpPD,tmpTIPO, TMPTPC"  +CRLF
Endif
cCorpo += "ORDER BY 1, 2, 4, 9"  +CRLF 
cCorpo += "open curTotParam"  +CRLF
If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	cCorpo += "fetch curTotParam into	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC,@lTemItemRZ, @lTemClVlRZ "  +CRLF 
Else  
	cCorpo += "fetch curTotParam into	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC "  +CRLF 
Endif
cCorpo += "while (@@fetch_Status = 0) begin "  +CRLF
cCorpo += "      select @iNroRegs = @iNroRegs + 1"+CRLF
cCorpo += "      If @iNroRegs = 1 begin"+CRLF

If !("MSSQL"$tcGetDB())
	cCorpo += "         Begin Transaction"+CRLF       
Endif

cCorpo += "         Select @iNroRegs = @iNroRegs"+CRLF
cCorpo += "      End"+CRLF
cCorpo += "			select @MaxRecno = isnull( max( R_E_C_N_O_ ), 1) from " + RetSqlName("SRZ") +CRLF 	
cCorpo += "			Select  @MaxRecno =  @MaxRecno + 1" +CRLF
If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	cCorpo += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, RZ_ITEM, RZ_CLVL," + cRecno + ")" +CRLF
	cCorpo += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ, @MaxRecno )" +CRLF
Else
cCorpo += "			insert into " + cAliasSRZ + " (RZ_FILIAL, RZ_CC, RZ_MAT, RZ_PD, RZ_HRS, RZ_VAL, RZ_OCORREN, RZ_TIPO, RZ_TPC, " + cRecno + ")" +CRLF
cCorpo += "			values(	@RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @MaxRecno )" +CRLF  
Endif
cCorpo += "      If @iNroRegs = 1024 begin"+CRLF
 
If !("MSSQL"$tcGetDB())
	cCorpo += "         Commit Transaction"+CRLF
Endif

cCorpo += "         Select @iNroRegs = 0"+CRLF
cCorpo += "      End"+CRLF
If lTemItemRA .AND. lTemClVlRA .AND. lTemItemRI .AND. lTemClVlRI .AND. lTemItemRC .AND. lTemClVlRC
	cCorpo += "fetch curTotParam into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC, @lTemItemRZ, @lTemClVlRZ" +CRLF  
Else
	cCorpo += "fetch curTotParam into @RZ_FILIAL,@RZ_CC,@RZ_MAT,@RZ_PD,@RZ_HRS, @RZ_VAL, @RZ_OCORREN ,@RZ_TIPO,@RZ_TPC" +CRLF  
Endif
cCorpo += "end"  +CRLF 
cCorpo += "	If @iNroRegs > 0 begin"+CRLF
cCorpo += "       Select @iTranCount  = 0"+CRLF
 
If !("MSSQL"$tcGetDB())
	cCorpo += "		Commit Transaction"+CRLF  
Endif

cCorpo += "		select @iNroRegs = 0"+CRLF
cCorpo += "      End"+CRLF
cCorpo += "close curTotParam " +CRLF   
cCorpo += "deallocate curTotParam "+CRLF
cCorpo += "end "  +CRLF 
cCorpo += "SELECT @OUT_RESULTADO = '1' "  +CRLF  
cCorpo += "end "  +CRLF

//criar a procedure para inserir no SRZ 
cParam := "CREATE PROCEDURE " + cProcInss + "_"+cEmpAnt+"("+CRLF 
cParam += " @OUT_RESULTADO CHAR(01) OutPut " +CRLF
cParam += " )"+CRLF
cParam += " AS "+CRLF 
cQueryExec := cParam+ cDeclare + cCorpo
cQueryExec := MsParse(cQueryExec,Alltrim(TcGetDB())) 
If ( AllTrim( Upper( TcGetDb() ) ) == 'INFORMIX' )
	cQueryExec := StrTran(cQueryExec, "LET viTranCount  = 0 ;" , "LET viTranCount  = 0 ;" +CRLF+ "	COMMIT WORK ;") 
Endif

//Verifica se a procedure existe no Banco       
If TCSPExist(cProcInss+"_"+cEmpAnt)
	TcSqlExec("DROP PROCEDURE " + cProcInss+"_"+cEmpAnt)  
EndIf 

//Cria a Procedure para a geracao do SRZ
cRetProc:= TcSqlExec(cQueryExec)  
 
 //Executa a procedure 
If cRetProc <> 0
	MsgStop("TCSQLError() " + TCSQLError())
Else 
	aResult := TCSPExec( xProcedures(cProcInss))
	If Empty(aResult)
		MsgStop("TCSQLError() " + TCSQLError())
	 	lGerouSRZ := .F. 
	Endif 
Endif 

// Exclui tabela temporaria
If TCCanOpen(cTableInss) 
	TcDelFile(cTableInss) 
EndIf      

Return ( lGerouSRZ ) 

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³Rst040Imp  ºAutor  ³Jonatas A. T. Alves º Data ³  22/10/08  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³  Restaura variavel estatica do GPER040.	                  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ GPEM110                            						  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
STATIC Function Rst040Imp()
Return( ( lPrimeira := .T. ) ) 

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³DescPd 	³ Autor ³ J. Ricardo 		    ³ Data ³ 23.02.95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Retorna a Descricao do Codigo de Provento / Desconto		  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Generico 												  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß/*/
STATIC Function DescPd(cCodigo,cFil,nBytes,ndESC)
//Local cAlias := Alias()
Local aArea:=GetArea() //RRP - 17/12/2013 - Ajuste no alias.
Local nOrdem := IndexOrd()
                                                
// Ndesc = 2 descicao portugues , 1 descricao ingles
// 
IF nDesc = NIL
	nDesc := 1
End

if SRV->(FieldPos("RV_XDESCIN")) = 0
	ndESC := 2
END

If nBytes = NIL
	nBytes := 20
Endif
If nBytes > 20
	nBytes := 20
Endif

dbSelectArea( "SRV" )
dbSetOrder(1)
If (cFil # Nil .And. cFilial == '  ' ) .Or. cFil == Nil
	cFil := cFilial
Endif
If dbSeek( cFil + cCodigo )
	cRet := Left(IF(nDesc=1,RV_XDESCIN,RV_DESC)+Space(nBytes),nBytes)
Else
	cRet := Left(STR0010+Space(nBytes),nBytes)  //"** Nao Cadastrado **"
Endif
//dbSelectArea( cAlias ) 
RestArea(aArea) //RRP - 17/12/2013 - Ajuste no alias.
dbSetOrder(nOrdem)
Return( cRet )